(function(){if(!this.specs){var e={},t={},n=function(s,o){var u=r(o,s),a=r(u,"./index"),f,l;f=t[u]||t[a];if(f)return f.exports;if(!(l=e[u]||e[u=a]))throw"module '"+s+"' not found";f={id:u,exports:{}};try{return t[u]=f,l(f.exports,function(e){return n(e,i(u))},f),f.exports}catch(c){throw delete t[u],c}},r=function(e,t){var n=[],r,i;/^\.\.?(\/|$)/.test(t)?r=[e,t].join("/").split("/"):r=t.split("/");for(var s=0,o=r.length;s<o;s++)i=r[s],i==".."?n.pop():i!="."&&i!=""&&n.push(i);return n.join("/")},i=function(e){return e.split("/").slice(0,-1).join("/")};this.specs=function(e){return n(e,"")},this.specs.define=function(t){for(var n in t)e[n]=t[n]},this.specs.modules=e,this.specs.cache=t}return this.specs.define}).call(this)({"controllers/node_tool":function(e,t,n){(function(){var e,t,n,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};n=window.require,e=function(){function e(){}return e.prototype.addNode=function(){},e}(),t=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return s(t,e),t.prototype.select=function(e){return this.selection=[e]},t.prototype.clearSelection=function(){return this.selection=[]},t}(e),describe("NodeTool",function(){var e,r;return r=n("controllers/node_tool"),e=n("models/commands/commander"),beforeEach(function(){return this.commander=new e,this.drawing=new t,this.tool=new r({commander:this.commander,drawing:this.drawing}),this.tool.setParameter("shape","a-shape")}),it("creates a new node",function(){return spyOn(this.drawing,"addNode"),this.tool.onMouseDown({point:"dummy-position"}),expect(this.drawing.addNode).toHaveBeenCalledWith({shape:"a-shape",position:"dummy-position"})})})}).call(this)},"controllers/notations/eugenia_notation":function(e,t,n){(function(){var e;e=window.require,describe("EugeniaNotation",function(){var t,n,r;return t=e("controllers/notations/eugenia_notation"),r=e("models/node_shape"),n=e("models/link_shape"),beforeEach(function(){return this.notation=new t}),it("can represent a minimal nodeshape",function(){var e;return e=new r({name:"Simple",label:{placement:"none"},elements:[{figure:"rectangle"}]}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON())}),it("sets label.placement to none when there is no label",function(){var e;return e=new r({name:"Simple",elements:[{figure:"rectangle"}]}),expect(this.notation.serialiseNode(e)).toMatch(/label.placement="none"/)}),it("can represent a nodeshape with properties",function(){var e;return e=new r({name:"Simple",label:{placement:"none"},elements:[{figure:"rectangle"}],properties:["name","id"]}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON())}),it("can represent additional properties of each element",function(){var e;return e=new r({name:"Simple",label:{placement:"none"},elements:[{figure:"rectangle",borderColor:"rgba(255, 0, 0, 1)",fillColor:"rgba(255, 0, 0, 1)",size:{width:10,height:40}}]}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON())}),it("can represent only the first element of a multielement node shape",function(){var e,t;return t=new r({name:"Simple",label:{placement:"none"},elements:[{figure:"rectangle",borderColor:"rgba(255, 0, 0, 1)",fillColor:"rgba(0, 255, 0, 1)",size:{width:10,height:40}},{figure:"ellipse",borderColor:"rgba(0, 0, 255, 1)",fillColor:"rgba(255, 255, 0, 1)",size:{width:5,height:5}}]}),e=t.toJSON(),e.elements=[e.elements[0]],expect(this.notation.reconstruct(t)).toEqual(e)}),it("can represent a minimal labelled nodeshape",function(){var e;return e=new r({name:"Simple",label:{"for":["name"],pattern:"{0}"}}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON()),expect(this.notation.serialiseNode(e)).not.toMatch(/label.placement="none"/)}),it("can represent additional properties of a labelled nodeshape",function(){var e;return e=new r({name:"Simple",label:{"for":["name","state"],pattern:"{1} --> {0}",placement:"external",color:"rgba(128, 0, 128, 1)",length:20}}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON())}),it("can represent a minimal linkshape",function(){var e;return e=new n({name:"Simple",color:"rgba(0, 0, 0, 1)",style:"solid"}),expect(this.notation.reconstruct(e)).toEqual(e.toJSON())}),it("includes properties for ends when serialising a link",function(){var e,t;return t=new n({name:"Simple",color:"rgba(0, 0, 0, 1)",style:"solid"}),e=this.notation.serialise(t),expect(e).toMatch('source="source"'),expect(e).toMatch('target="target"')}),it("includes references to ends when serialising a link",function(){var e,t;return t=new n({name:"Simple",color:"rgba(0, 0, 0, 1)",style:"solid"}),e=this.notation.serialise(t),expect(e).toMatch("ref .* source;"),expect(e).toMatch("ref .* target;")})})}).call(this)},"controllers/toolbox":function(e,t,n){(function(){var e;e=window.require,describe("Toolbox",function(){var t;return t=e("controllers/toolbox"),beforeEach(function(){return this.t=new t({commander:{}})}),it("switches to SelectTool when initialised",function(){return expect(this.t.currentTool).toBe(this.t.tools.select)}),it("activates specified tool after switching",function(){return this.t.switchTo("node"),expect(this.t.currentTool).toBe(this.t.tools.node)}),it("errors when switching to an unknown tool",function(){var e=this;return expect(function(){return e.t.switchTo("detonator")}).toThrow("There is no tool named 'detonator'")})})}).call(this)},"models/commands/change_property":function(e,t,n){(function(){var e;e=window.require,describe("ChangeProperty",function(){var t,n;return t=e("models/commands/change_property"),n=e("models/node"),beforeEach(function(){return this.node=new n,this.node.setPropertyValue("name","old"),this.command=new t(this.node,"name","new")}),it("changes the value of the node's property",function(){return this.command.run(),expect(this.node.getPropertyValue("name")).toBe("new")}),it("restores the value of the node's property when undone",function(){return this.command.run(),this.command.undo(),expect(this.node.getPropertyValue("name")).toBe("old")})})}).call(this)},"models/commands/commander":function(e,t,n){(function(){var e;e=window.require,describe("Commander",function(){var t;return t=e("models/commands/commander"),beforeEach(function(){return this.commander=new t,this.command=jasmine.createSpyObj("command",["run","undo"])}),it("runs by delegating to the command",function(){return this.commander.run(this.command),expect(this.command.run).toHaveBeenCalled()}),it("undoes by delegating to the last command to have been run",function(){return this.commander.run(this.command),this.commander.undo(),expect(this.command.undo).toHaveBeenCalled()}),it("undoes all commands to have been run, in reverse order",function(){var e,t,n;return e=jasmine.createSpyObj("command",["run","undo"]),t=jasmine.createSpyObj("command",["run","undo"]),n=jasmine.createSpyObj("command",["run","undo"]),this.commander.run(e),this.commander.run(t),this.commander.run(n),this.commander.undo(),expect(n.undo.callCount).toBe(1),this.commander.undo(),expect(t.undo.callCount).toBe(1),this.commander.undo(),expect(e.undo.callCount).toBe(1)}),it("does not undo when there are no commands left to undo",function(){return this.commander.run(this.command),this.commander.undo(),this.commander.undo(),expect(this.command.undo.callCount).toBe(1)}),describe("run with undoable set to false",function(){return it("does not undo commands",function(){return this.commander.run(this.command,{undoable:!1}),this.commander.undo(),expect(this.command.undo).not.toHaveBeenCalled()}),it("does undo the last undoable command",function(){var e,t;return t=jasmine.createSpyObj("command",["run","undo"]),e=jasmine.createSpyObj("command",["run","undo"]),this.commander.run(t,{undoable:!0}),this.commander.run(e,{undoable:!1}),this.commander.undo(),expect(t.undo).toHaveBeenCalled()})}),describe("add",function(){return it("does not run commands",function(){return this.commander.add(this.command),expect(this.command.run).not.toHaveBeenCalled()}),it("does prepare commands to be undone",function(){return this.commander.add(this.command),this.commander.undo(),expect(this.command.undo).toHaveBeenCalled()})})})}).call(this)},"models/commands/create_link":function(e,t,n){(function(){var e;e=window.require,describe("CreateLink",function(){var t,n;return t=e("models/commands/create_link"),n=e("models/drawing"),beforeEach(function(){return this.drawing=new n,this.parameters={shape:"Transition",sourceId:"c1",targetId:"c2",segments:[{point:{x:5,y:4},handleIn:{x:3,y:2},handleOut:{x:1,y:0}}]},this.command=new t(this.drawing,this.parameters)}),afterEach(function(){if(this.drawing)return this.drawing.destroy()}),it("creates a new link when executed",function(){var e;return this.command.run(),expect(this.drawing.links().all().length).toBe(1),e=this.drawing.links().first(),expect(e.shape).toEqual(this.parameters.shape),expect(e.sourceId).toEqual(this.parameters.sourceId),expect(e.targetId).toEqual(this.parameters.targetId),expect(e.segments).toEqual(this.parameters.segments)}),it("deletes the link when undone",function(){return this.command.run(),this.command.undo(),expect(this.drawing.links().all().length).toBe(0)})})}).call(this)},"models/commands/create_node":function(e,t,n){(function(){var e;e=window.require,describe("CreateNode",function(){var t,n;return t=e("models/commands/create_node"),n=e("models/drawing"),beforeEach(function(){return this.drawing=new n,this.parameters={shape:"State",position:{x:10,y:30}},this.command=new t(this.drawing,this.parameters)}),afterEach(function(){if(this.drawing)return this.drawing.destroy()}),it("creates a new node when executed",function(){return this.command.run(),expect(this.drawing.nodes().all().length).toBe(1),expect(this.drawing.nodes().first().shape).toEqual(this.parameters.shape),expect(this.drawing.nodes().first().position).toEqual(this.parameters.position)}),it("deletes the node when undone",function(){return this.command.run(),this.command.undo(),expect(this.drawing.nodes().all().length).toBe(0)})})}).call(this)},"models/commands/delete_element":function(e,t,n){(function(){var e;e=window.require,describe("DeleteElement",function(){var t,n;return t=e("models/commands/delete_element"),n=e("models/drawing"),beforeEach(function(){return this.drawing=new n,this.node=this.drawing.addNode({}),this.link=this.drawing.addLink({})}),afterEach(function(){if(this.drawing)return this.drawing.destroy()}),it("deletes the element when it is a node",function(){var e;return e=new t(this.drawing,this.node),e.run(),expect(this.drawing.nodes().all().length).toBe(0)}),it("deletes the element when it is a link",function(){var e;return e=new t(this.drawing,this.link),e.run(),expect(this.drawing.links().all().length).toBe(0)})})}).call(this)},"models/commands/delete_link":function(e,t,n){(function(){var e;e=window.require,describe("DeleteLink",function(){var t,n;return t=e("models/commands/delete_link"),n=e("models/drawing"),beforeEach(function(){var e;return this.drawing=new n,this.parameters={shape:"Transition",sourceId:"c1",targetId:"c2",segments:[{point:{x:5,y:4},handleIn:{x:3,y:2},handleOut:{x:1,y:0}}]},e=this.drawing.addLink(this.parameters),this.command=new t(this.drawing,e)}),afterEach(function(){if(this.drawing)return this.drawing.destroy()}),it("deletes the link when executed",function(){return this.command.run(),expect(this.drawing.links().all().length).toBe(0)}),it("recreates the link when undone",function(){var e;return this.command.run(),this.command.undo(),expect(this.drawing.links().all().length).toBe(1),e=this.drawing.links().first(),expect(e.shape).toEqual(this.parameters.shape),expect(e.sourceId).toEqual(this.parameters.sourceId),expect(e.targetId).toEqual(this.parameters.targetId),expect(e.segments).toEqual(this.parameters.segments)}),it("changes ids when rebased",function(){var e;return this.command.run(),this.command.rebase("c1","c3"),this.command.undo(),expect(this.drawing.links().all().length).toBe(1),e=this.drawing.links().first(),expect(e.shape).toEqual(this.parameters.shape),expect(e.sourceId).toEqual("c3"),expect(e.targetId).toEqual(this.parameters.targetId),expect(e.segments).toEqual(this.parameters.segments)})})}).call(this)},"models/commands/delete_node":function(e,t,n){(function(){var e;e=window.require,describe("DeleteNode",function(){var t,n;return t=e("models/commands/delete_node"),n=e("models/drawing"),beforeEach(function(){return this.drawing=new n,this.parameters={shape:"State",position:{x:10,y:30}},this.node=this.drawing.addNode(this.parameters),this.command=new t(this.drawing,this.node)}),afterEach(function(){if(this.drawing)return this.drawing.destroy()}),describe("when node has no links",function(){return it("deletes the node when executed",function(){return this.command.run(),expect(this.drawing.nodes().all().length).toBe(0)}),it("recreates the node when undone",function(){return this.command.run(),this.command.undo(),expect(this.drawing.nodes().all().length).toBe(1),expect(this.drawing.nodes().first().shape).toEqual(this.parameters.shape),expect(this.drawing.nodes().first().position).toEqual(this.parameters.position)})}),describe("when node has some links",function(){return beforeEach(function(){return this.linkParameters={sourceId:this.node.id,targetId:this.node.id},this.drawing.addLink(this.linkParameters)}),it("deletes the node and its links when executed",function(){return this.command.run(),expect(this.drawing.nodes().all().length).toBe(0),expect(this.drawing.links().all().length).toBe(0)}),it("recreates the node and its links when undone",function(){var e;return this.command.run(),this.command.undo(),expect(this.drawing.nodes().all().length).toBe(1),e=this.drawing.nodes().first(),expect(e.shape).toEqual(this.parameters.shape),expect(e.position).toEqual(this.parameters.position),expect(e.links().length).toBe(1)})})})}).call(this)},"models/commands/move_node":function(e,t,n){(function(){var e;e=window.require,describe("MoveNode",function(){var t,n;return t=e("models/commands/move_node"),n=e("models/node"),beforeEach(function(){return this.position={x:10,y:30},this.offset={x:5,y:-10},this.node=new n({position:this.position}),this.command=new t(this.node,this.offset)}),it("moves the node when executed",function(){return this.command.run(),expect(this.node.position.x).toBe(this.position.x+this.offset.x),expect(this.node.position.y).toBe(this.position.y+this.offset.y)}),it("recreates the node when undone",function(){return this.command.run(),this.command.undo(),expect(this.node.position.x).toBe(this.position.x),expect(this.node.position.y).toBe(this.position.y)})})}).call(this)},"models/drawing":function(e,t,n){(function(){var e;e=window.require,describe("Drawing",function(){var t,n;return t=e("models/drawing"),n=e("models/palette"),it("destroys nodes, links and palette when destroyed",function(){return this.drawing=t.create({name:"test"}),this.drawing.save(),this.drawing.nodes().create({}).save(),this.drawing.nodes().create({}).save(),this.drawing.links().create({}).save(),this.palette=n.create({drawing_id:this.drawing.id}).save(),this.drawing.destroy(),expect(this.drawing.nodes().all().length).toBe(0),expect(this.drawing.links().all().length).toBe(0),expect(this.drawing.palette()).toBeNull()})})}).call(this)},"models/moves_path":function(e,t,n){(function(){var e;e=window.require,describe("MovesPath",function(){var t;return t=e("models/moves_path"),beforeEach(function(){return paper.setup($("canvas")[0]),this.start=new paper.Point(10,20),this.middle=new paper.Point(20,30),this.end=new paper.Point(30,40),this.path=new paper.Path,this.path.add(this.start),this.path.add(this.middle),this.path.add(this.end),this.offset=new paper.Point(50,100),this.mover=new t(this.path,this.offset),this.addMatchers({toBeInTheSamePlaceAs:function(e){return this.message=function(){return"Expected ("+e.x+","+e.y+") but got ("+this.actual.x+","+this.actual.y+")"},this.actual.x===e.x&&this.actual.y===e.y}})}),it("can move the start of a path",function(){return this.mover.moveStart(),expect(this.path.firstSegment.point).toBeInTheSamePlaceAs(this.start.add(this.offset))}),it("can move the end of a path",function(){return this.mover.moveEnd(),expect(this.path.lastSegment.point).toBeInTheSamePlaceAs(this.end.add(this.offset))}),it("can move the start and end of a path without affecting the middle",function(){return this.mover.moveStart(),this.mover.moveEnd(),expect(this.path.segments[1].point).toBeInTheSamePlaceAs(this.middle)}),it("can remove the middle when finalising",function(){return expect(this.mover.finalise().length).toEqual(2)})})}).call(this)},"models/palette_specification":function(e,t,n){(function(){var e;e=window.require,describe("PaletteSpecification",function(){var t;return t=e("models/palette_specification"),beforeEach(function(){return this.palette=t.create({json:'{      "nodeShapes" : [        {          "name" : "singleton",          "elements" : [            {              "figure" : "rounded",              "size" : { "width" : 100, "height" : 50 }            }          ]        },        {          "name" : "multi",          "elements" : [            {              "figure": "ellipse"            },            {              "figure": "square"            }          ]        }      ],      "linkShapes" : [        {          "name": "transition",          "color": "black"        }      ]    }'}).instantiate()}),it("creates node shapes from JSON",function(){return expect(this.palette.nodeShapes().all().length).toBe(2)}),it("names first node shape from JSON",function(){return expect(this.palette.nodeShapes().all()[0].name).toBe("singleton")}),it("creates elements for first node shape from JSON",function(){var e;return e=this.palette.nodeShapes().all()[0].elements,expect(e.length).toBe(1),expect(e[0].figure).toBe("rounded"),expect(e[0].size.width).toBe(100),expect(e[0].size.height).toBe(50)}),it("names second node shape from JSON",function(){return expect(this.palette.nodeShapes().all()[1].name).toBe("multi")}),it("creates elements for second node shape from JSON",function(){var e;return e=this.palette.nodeShapes().all()[1].elements,expect(e.length).toBe(2),expect(e[0].figure).toBe("ellipse"),expect(e[1].figure).toBe("square")}),it("creates links shapes from JSON",function(){return expect(this.palette.linkShapes().all().length).toBe(1)}),it("creates values for first link shapes from JSON",function(){var e;return e=this.palette.linkShapes().all()[0],expect(e.name).toBe("transition"),expect(e.color).toBe("black")})})}).call(this)},"models/simplifies_segments":function(e,t,n){(function(){var e;e=window.require,describe("SimplifiesSegments",function(){var t;return t=e("models/simplifies_segments"),beforeEach(function(){return this.segments=[new paper.Segment(new paper.Point(10,5))]}),it("is necessary because Paper.js segments cannot be serialised",function(){var e=this;return expect(function(){return JSON.stringify(e.segments)}).toThrow("Converting circular structure to JSON")}),it("simplifies segments and allows serialisation",function(){var e,n=this;return e=(new t)["for"](this.segments),expect(function(){return JSON.stringify(e)}).not.toThrow()})})}).call(this)}}),require("lib/setup");for(var key in specs.modules)specs(key)