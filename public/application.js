jade=function(e){function t(e){return e!=null}return Array.isArray||(Array.isArray=function(e){return"[object Array]"==Object.prototype.toString.call(e)}),Object.keys||(Object.keys=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}),e.merge=function(n,r){var i=n["class"],s=r["class"];if(i||s)i=i||[],s=s||[],Array.isArray(i)||(i=[i]),Array.isArray(s)||(s=[s]),i=i.filter(t),s=s.filter(t),n["class"]=i.concat(s).join(" ");for(var o in r)o!="class"&&(n[o]=r[o]);return n},e.attrs=function(n,r){var i=[],s=n.terse;delete n.terse;var o=Object.keys(n),u=o.length;if(u){i.push("");for(var a=0;a<u;++a){var f=o[a],l=n[f];"boolean"==typeof l||null==l?l&&(s?i.push(f):i.push(f+'="'+f+'"')):0==f.indexOf("data")&&"string"!=typeof l?i.push(f+"='"+JSON.stringify(l)+"'"):"class"==f&&Array.isArray(l)?i.push(f+'="'+e.escape(l.join(" "))+'"'):r&&r[f]?i.push(f+'="'+e.escape(l)+'"'):i.push(f+'="'+l+'"')}}return i.join(" ")},e.escape=function(t){return String(t).replace(/&(?!(\w+|\#\d+);)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},e.rethrow=function(t,n,r){if(!n)throw t;var i=3,s=require("fs").readFileSync(n,"utf8"),o=s.split("\n"),u=Math.max(r-i,0),a=Math.min(o.length,r+i),i=o.slice(u,a).map(function(e,t){var n=t+u+1;return(n==r?"  > ":"    ")+n+"| "+e}).join("\n");throw t.path=n,t.message=(n||"Jade")+":"+r+"\n"+i+"\n\n"+t.message,t},e}({});var paper=new function(){var Base=new function(){function c(e,t,n){if(f)try{return delete e[t],f(e,t,n)}catch(r){}return(n.get||n.set)&&e.__defineGetter__?(n.get&&e.__defineGetter__(t,n.get),n.set&&e.__defineSetter__(t,n.set)):e[t]=n.value,e}function h(e,t){if(l)try{return l(e,t)}catch(n){}var i=e.__lookupGetter__&&e.__lookupGetter__(t);return i?{get:i,set:e.__lookupSetter__(t),enumerable:!0,configurable:!0}:r.call(e,t)?{value:e[t],enumerable:!0,configurable:!0,writable:!0}:null}function p(e,n,i,s,u,a){function p(t,a,p,d){var a=a||(a=h(n,t))&&(a.get?a:a.value),v=typeof a=="function",m=a,g=u||v?a&&a.get?t in e:e[t]:null;d&&v&&(!u||!d[t])&&(d[t]=function(n){return n&&e[t].apply(n,o.call(arguments,1))});if((p||a!==undefined&&r.call(n,t))&&(!u||!g)){if(v){if(g&&/\bthis\.base\b/.test(a)){var y=s&&s[t]==g;m=function(){var e=h(this,"base");c(this,"base",{value:y?s[t]:g,configurable:!0});try{return a.apply(this,arguments)}finally{e?c(this,"base",e):delete this.base}},m.toString=function(){return a.toString()},m.valueOf=function(){return a.valueOf()}}f&&a.length==0&&(l=t.match(/^(get|is)(([A-Z])(.*))$/))&&f.push([l[3].toLowerCase()+l[4],l[2]])}if(!m||v||!m.get&&!m.set)m={value:m,writable:!0};(h(e,t)||{configurable:!0}).configurable&&(m.configurable=!0,m.enumerable=i),c(e,t,m)}}var f,l;if(n){f=[];for(var d in n)r.call(n,d)&&!t.test(d)&&p(d,null,!0,a);p("toString"),p("valueOf");for(var v=0,m=f&&f.length;v<m;v++)try{var l=f[v],g=l[1];p(l[0],{get:e["get"+g]||e["is"+g],set:e["set"+g]},!0)}catch(y){}}return e}function d(t){var n=function(r){e&&c(this,"__proto__",{value:t});if(this.initialize&&r!==n.dont)return this.initialize.apply(this,arguments)};return n.prototype=t,n.toString=function(){return(this.prototype.initialize||function(){}).toString()},n}function v(e){return e?typeof e!="function"?function(t){return t==e}:e:function(e){return e}}function m(e,t,n,r){try{e&&(r||r===undefined&&s(e)?u:a).call(e,v(t),n=n||e)}catch(i){if(i!==Base.stop)throw i}return n}function g(e){return m(e,function(e,t){this[t]=e},new e.constructor)}var e=!this.__proto__,t=/^(statics|generics|preserve|enumerable|prototype|__proto__|toString|valueOf)$/,n=Object.prototype,r=e?function(e){return e!=="__proto__"&&this.hasOwnProperty(e)}:n.hasOwnProperty,i=n.toString,n=Array.prototype,s=Array.isArray=Array.isArray||function(e){return i.call(e)==="[object Array]"},o=n.slice,u=n.forEach=n.forEach||function(e,t){for(var n=0,r=this.length;n<r;n++)e.call(t,this[n],n,this)},a=function(e,t){for(var n in this)this.hasOwnProperty(n)&&e.call(t,this[n],n,this)},f=Object.defineProperty,l=Object.getOwnPropertyDescriptor;return p(function(){},{inject:function(e){if(e){var t=this.prototype,n=t.__proto__&&t.__proto__.constructor,r=e.statics==1?e:e.statics;r!=e&&p(t,e,e.enumerable,n&&n.prototype,e.preserve,e.generics&&this),p(this,r,!0,n,e.preserve)}for(var i=1,s=arguments.length;i<s;i++)this.inject(arguments[i]);return this},extend:function(e){var t=new this(this.dont),n=d(t);return c(t,"constructor",{value:n,writable:!0,configurable:!0}),n.dont={},p(n,this,!0),arguments.length?this.inject.apply(n,arguments):n}},!0).inject({has:r,each:m,inject:function(){for(var e=0,t=arguments.length;e<t;e++)p(this,arguments[e]);return this},extend:function(){var e=new(d(this));return e.inject.apply(e,arguments)},each:function(e,t){return m(this,e,t)},clone:function(){return g(this)},statics:{each:m,clone:g,define:c,describe:h,iterator:v,has:function(e,t){return r.call(e,t)},type:function(e){return(e||e===0)&&(e._type||typeof e)||null},check:function(e){return!!e||e===0},pick:function(){for(var e=0,t=arguments.length;e<t;e++)if(arguments[e]!==undefined)return arguments[e];return null},stop:{}}})};this.Base=Base.inject({generics:!0,clone:function(){return new this.constructor(this)},toString:function(){return"{ "+Base.each(this,function(e,t){if(t.charAt(0)!="_"){var n=typeof e;this.push(t+": "+(n==="number"?Base.formatNumber(e):n==="string"?"'"+e+"'":e))}},[]).join(", ")+" }"},statics:{read:function(e,t,n){var t=t||0,n=n||e.length-t,r=e[t];return r instanceof this||this.prototype._readNull&&r==null&&n<=1?r:(r=new this(this.dont),r.initialize.apply(r,t>0||n<e.length?Array.prototype.slice.call(e,t,t+n):e)||r)},readAll:function(e,t){var n=[],r;for(var i=t||0,s=e.length;i<s;i++)n.push(Array.isArray(r=e[i])?this.read(r,0):this.read(e,i,1));return n},splice:function(e,t,n,r){var i=t&&t.length,s=n===undefined;n=s?e.length:n;for(var o=0;o<i;o++)t[o]._index=n+o;if(s)return e.push.apply(e,t),[];var u=[n,r];t&&u.push.apply(u,t);var a=e.splice.apply(e,u);for(var o=0,f=a.length;o<f;o++)delete a[o]._index;for(var o=n+i,f=e.length;o<f;o++)e[o]._index=o;return a},merge:function(){return Base.each(arguments,function(e){Base.each(e,function(e,t){this[t]=e},this)},new Base,!0)},capitalize:function(e){return e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},camelize:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},hyphenate:function(e){return e.replace(/[a-z][A-Z0-9]|[0-9][a-zA-Z]|[A-Z]{2}[a-z]/g,function(e){return e.charAt(0)+"-"+e.substring(1)}).toLowerCase()},formatNumber:function(e){return(Math.round(e*1e5)/1e5).toString()}}});var PaperScope=this.PaperScope=Base.extend({initialize:function(e){paper=this,this.view=null,this.views=[],this.project=null,this.projects=[],this.tool=null,this.tools=[],this._id=e&&(e.getAttribute("id")||e.src)||"paperscope-"+PaperScope._id++,e&&e.setAttribute("id",this._id),PaperScope._scopes[this._id]=this},version:.22,evaluate:function(e){var t=PaperScript.evaluate(e,this);return View.updateFocus(),t},install:function(e){var t=this;Base.each(["project","view","tool"],function(n){Base.define(e,n,{configurable:!0,writable:!0,get:function(){return t[n]}})});for(var n in this)!/^(version|_id|load)/.test(n)&&!(n in e)&&(e[n]=this[n])},setup:function(e){paper=this,this.project=new Project,e&&(this.view=new View(e))},clear:function(){for(var e=this.projects.length-1;e>=0;e--)this.projects[e].remove();for(var e=this.views.length-1;e>=0;e--)this.views[e].remove();for(var e=this.tools.length-1;e>=0;e--)this.tools[e].remove()},remove:function(){this.clear(),delete PaperScope._scopes[this._id]},_needsRedraw:function(){if(!this._redrawNotified){for(var e=this.views.length-1;e>=0;e--)this.views[e]._redrawNeeded=!0;this._redrawNotified=!0}},statics:{_scopes:{},_id:0,get:function(e){return typeof e=="object"&&(e=e.getAttribute("id")),this._scopes[e]||null},each:function(e){Base.each(this._scopes,e)}}}),PaperScopeItem=Base.extend({initialize:function(e){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(e||!this._scope[this._reference])&&this.activate()},activate:function(){return this._scope?(this._scope[this._reference]=this,!0):!1},remove:function(){return this._index==null?!1:(Base.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),Point=this.Point=Base.extend({initialize:function(e,t){t!==undefined?(this.x=e,this.y=t):e!==undefined?e==null?this.x=this.y=0:e.x!==undefined?(this.x=e.x,this.y=e.y):e.width!==undefined?(this.x=e.width,this.y=e.height):Array.isArray(e)?(this.x=e[0],this.y=e.length>1?e[1]:e[0]):e.angle!==undefined?(this.x=e.length,this.y=0,this.setAngle(e.angle)):typeof e=="number"?this.x=this.y=e:this.x=this.y=0:this.x=this.y=0},set:function(e,t){return this.x=e,this.y=t,this},clone:function(){return Point.create(this.x,this.y)},toString:function(){var e=Base.formatNumber;return"{ x: "+e(this.x)+", y: "+e(this.y)+" }"},add:function(e){return e=Point.read(arguments),Point.create(this.x+e.x,this.y+e.y)},subtract:function(e){return e=Point.read(arguments),Point.create(this.x-e.x,this.y-e.y)},multiply:function(e){return e=Point.read(arguments),Point.create(this.x*e.x,this.y*e.y)},divide:function(e){return e=Point.read(arguments),Point.create(this.x/e.x,this.y/e.y)},modulo:function(e){return e=Point.read(arguments),Point.create(this.x%e.x,this.y%e.y)},negate:function(){return Point.create(-this.x,-this.y)},transform:function(e){return e?e._transformPoint(this):this},getDistance:function(e,t){e=Point.read(arguments);var n=e.x-this.x,r=e.y-this.y,i=n*n+r*r;return t?i:Math.sqrt(i)},getLength:function(){var e=this.x*this.x+this.y*this.y;return arguments[0]?e:Math.sqrt(e)},setLength:function(e){if(this.isZero()){var t=this._angle||0;this.set(Math.cos(t)*e,Math.sin(t)*e)}else{var n=e/this.getLength();n==0&&this.getAngle(),this.set(this.x*n,this.y*n)}return this},normalize:function(e){e===undefined&&(e=1);var t=this.getLength(),n=t!=0?e/t:0,r=Point.create(this.x*n,this.y*n);return r._angle=this._angle,r},getAngle:function(){return this.getAngleInRadians(arguments[0])*180/Math.PI},setAngle:function(e){e=this._angle=e*Math.PI/180;if(!this.isZero()){var t=this.getLength();this.set(Math.cos(e)*t,Math.sin(e)*t)}return this},getAngleInRadians:function(){if(arguments[0]===undefined)return this._angle==null&&(this._angle=Math.atan2(this.y,this.x)),this._angle;var e=Point.read(arguments),t=this.getLength()*e.getLength();return t==0?NaN:Math.acos(this.dot(e)/t)},getAngleInDegrees:function(){return this.getAngle(arguments[0])},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3},getDirectedAngle:function(e){return e=Point.read(arguments),Math.atan2(this.cross(e),this.dot(e))*180/Math.PI},rotate:function(e,t){e=e*Math.PI/180;var n=t?this.subtract(t):this,r=Math.sin(e),i=Math.cos(e);return n=Point.create(n.x*i-n.y*r,n.y*i+n.x*r),t?n.add(t):n},equals:function(e){return e=Point.read(arguments),this.x==e.x&&this.y==e.y},isInside:function(e){return e.contains(this)},isClose:function(e,t){return this.getDistance(e)<t},isColinear:function(e){return this.cross(e)<Numerical.TOLERANCE},isOrthogonal:function(e){return this.dot(e)<Numerical.TOLERANCE},isZero:function(){return this.x==0&&this.y==0},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(e){return e=Point.read(arguments),this.x*e.x+this.y*e.y},cross:function(e){return e=Point.read(arguments),this.x*e.y-this.y*e.x},project:function(e){e=Point.read(arguments);if(e.isZero())return Point.create(0,0);var t=this.dot(e)/e.dot(e);return Point.create(e.x*t,e.y*t)},statics:{create:function(e,t){var n=new Point(Point.dont);return n.x=e,n.y=t,n},min:function(e,t){return e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),Point.create(Math.min(e.x,t.x),Math.min(e.y,t.y))},max:function(e,t){return e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),Point.create(Math.max(e.x,t.x),Math.max(e.y,t.y))},random:function(){return Point.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(e){var t=Math[e];this[e]=function(){return Point.create(t(this.x),t(this.y))}},{})}),LinkedPoint=Point.extend({set:function(e,t,n){return this._x=e,this._y=t,n||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner[this._setter](this)},statics:{create:function(e,t,n,r,i){if(i)return Point.create(n,r);var s=new LinkedPoint(LinkedPoint.dont);return s._x=n,s._y=r,s._owner=e,s._setter=t,s}}}),Size=this.Size=Base.extend({initialize:function(e,t){t!==undefined?(this.width=e,this.height=t):e!==undefined?e==null?this.width=this.height=0:e.width!==undefined?(this.width=e.width,this.height=e.height):e.x!==undefined?(this.width=e.x,this.height=e.y):Array.isArray(e)?(this.width=e[0],this.height=e.length>1?e[1]:e[0]):typeof e=="number"?this.width=this.height=e:this.width=this.height=0:this.width=this.height=0},toString:function(){var e=Base.formatNumber;return"{ width: "+e(this.width)+", height: "+e(this.height)+" }"},set:function(e,t){return this.width=e,this.height=t,this},clone:function(){return Size.create(this.width,this.height)},add:function(e){return e=Size.read(arguments),Size.create(this.width+e.width,this.height+e.height)},subtract:function(e){return e=Size.read(arguments),Size.create(this.width-e.width,this.height-e.height)},multiply:function(e){return e=Size.read(arguments),Size.create(this.width*e.width,this.height*e.height)},divide:function(e){return e=Size.read(arguments),Size.create(this.width/e.width,this.height/e.height)},modulo:function(e){return e=Size.read(arguments),Size.create(this.width%e.width,this.height%e.height)},negate:function(){return Size.create(-this.width,-this.height)},equals:function(e){return e=Size.read(arguments),this.width==e.width&&this.height==e.height},isZero:function(){return this.width==0&&this.height==0},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{create:function(e,t){return(new Size(Size.dont)).set(e,t)},min:function(e,t){return Size.create(Math.min(e.width,t.width),Math.min(e.height,t.height))},max:function(e,t){return Size.create(Math.max(e.width,t.width),Math.max(e.height,t.height))},random:function(){return Size.create(Math.random(),Math.random())}}},new function(){return Base.each(["round","ceil","floor","abs"],function(e){var t=Math[e];this[e]=function(){return Size.create(t(this.width),t(this.height))}},{})}),LinkedSize=Size.extend({set:function(e,t,n){return this._width=e,this._height=t,n||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(e){this._width=e,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(e){this._height=e,this._owner[this._setter](this)},statics:{create:function(e,t,n,r,i){if(i)return Size.create(n,r);var s=new LinkedSize(LinkedSize.dont);return s._width=n,s._height=r,s._owner=e,s._setter=t,s}}}),Rectangle=this.Rectangle=Base.extend({initialize:function(e,t,n,r){if(arguments.length==4)this.x=e,this.y=t,this.width=n,this.height=r;else if(arguments.length==2)if(t&&t.x!==undefined){var i=Point.read(arguments,0,1),s=Point.read(arguments,1,1);this.x=i.x,this.y=i.y,this.width=s.x-i.x,this.height=s.y-i.y,this.width<0&&(this.x=s.x,this.width=-this.width),this.height<0&&(this.y=s.y,this.height=-this.height)}else{var o=Point.read(arguments,0,1),u=Size.read(arguments,1,1);this.x=o.x,this.y=o.y,this.width=u.width,this.height=u.height}else e?(this.x=e.x||0,this.y=e.y||0,this.width=e.width||0,this.height=e.height||0):this.x=this.y=this.width=this.height=0},set:function(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this},getPoint:function(){return LinkedPoint.create(this,"setPoint",this.x,this.y,arguments[0])},setPoint:function(e){return e=Point.read(arguments),this.x=e.x,this.y=e.y,this},getSize:function(){return LinkedSize.create(this,"setSize",this.width,this.height,arguments[0])},setSize:function(e){return e=Size.read(arguments),this.width=e.width,this.height=e.height,this},getLeft:function(){return this.x},setLeft:function(e){return this.width-=e-this.x,this.x=e,this},getTop:function(){return this.y},setTop:function(e){return this.height-=e-this.y,this.y=e,this},getRight:function(){return this.x+this.width},setRight:function(e){return this.width=e-this.x,this},getBottom:function(){return this.y+this.height},setBottom:function(e){return this.height=e-this.y,this},getCenterX:function(){return this.x+this.width*.5},setCenterX:function(e){return this.x=e-this.width*.5,this},getCenterY:function(){return this.y+this.height*.5},setCenterY:function(e){return this.y=e-this.height*.5,this},getCenter:function(){return LinkedPoint.create(this,"setCenter",this.getCenterX(),this.getCenterY(),arguments[0])},setCenter:function(e){return e=Point.read(arguments),this.setCenterX(e.x).setCenterY(e.y)},equals:function(e){return e=Rectangle.read(arguments),this.x==e.x&&this.y==e.y&&this.width==e.width&&this.height==e.height},isEmpty:function(){return this.width==0||this.height==0},toString:function(){var e=Base.formatNumber;return"{ x: "+e(this.x)+", y: "+e(this.y)+", width: "+e(this.width)+", height: "+e(this.height)+" }"},contains:function(e){return e&&e.width!==undefined||(Array.isArray(e)?e:arguments).length==4?this._containsRectangle(Rectangle.read(arguments)):this._containsPoint(Point.read(arguments))},_containsPoint:function(e){var t=e.x,n=e.y;return t>=this.x&&n>=this.y&&t<=this.x+this.width&&n<=this.y+this.height},_containsRectangle:function(e){var t=e.x,n=e.y;return t>=this.x&&n>=this.y&&t+e.width<=this.x+this.width&&n+e.height<=this.y+this.height},intersects:function(e){return e=Rectangle.read(arguments),e.x+e.width>this.x&&e.y+e.height>this.y&&e.x<this.x+this.width&&e.y<this.y+this.height},intersect:function(e){e=Rectangle.read(arguments);var t=Math.max(this.x,e.x),n=Math.max(this.y,e.y),r=Math.min(this.x+this.width,e.x+e.width),i=Math.min(this.y+this.height,e.y+e.height);return Rectangle.create(t,n,r-t,i-n)},unite:function(e){e=Rectangle.read(arguments);var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.width,e.x+e.width),i=Math.max(this.y+this.height,e.y+e.height);return Rectangle.create(t,n,r-t,i-n)},include:function(e){e=Point.read(arguments);var t=Math.min(this.x,e.x),n=Math.min(this.y,e.y),r=Math.max(this.x+this.width,e.x),i=Math.max(this.y+this.height,e.y);return Rectangle.create(t,n,r-t,i-n)},expand:function(e,t){return t===undefined&&(t=e),Rectangle.create(this.x-e/2,this.y-t/2,this.width+e,this.height+t)},scale:function(e,t){return this.expand(this.width*e-this.width,this.height*(t===undefined?e:t)-this.height)},statics:{create:function(e,t,n,r){return(new Rectangle(Rectangle.dont)).set(e,t,n,r)}}},new function(){return Base.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(e,t){var n=e.join(""),r=/^[RL]/.test(n);t>=4&&(e[1]+=r?"Y":"X");var i=e[r?0:1],s=e[r?1:0],o="get"+i,u="get"+s,a="set"+i,f="set"+s,l="get"+n,c="set"+n;this[l]=function(){return LinkedPoint.create(this,c,this[o](),this[u](),arguments[0])},this[c]=function(e){return e=Point.read(arguments),this[a](e.x)[f](e.y)}},{})}),LinkedRectangle=Rectangle.extend({set:function(e,t,n,r,i){return this._x=e,this._y=t,this._width=n,this._height=r,i||this._owner[this._setter](this),this},statics:{create:function(e,t,n,r,i,s){var o=(new LinkedRectangle(LinkedRectangle.dont)).set(n,r,i,s,!0);return o._owner=e,o._setter=t,o}}},new function(){var e=Rectangle.prototype;return Base.each(["x","y","width","height"],function(e){var t=Base.capitalize(e),n="_"+e;this["get"+t]=function(){return this[n]},this["set"+t]=function(e){this[n]=e,this._dontNotify||this._owner[this._setter](this)}},Base.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(t){var n="set"+t;this[n]=function(t){return this._dontNotify=!0,e[n].apply(this,arguments),delete this._dontNotify,this._owner[this._setter](this),this}},{}))}),Matrix=this.Matrix=Base.extend({initialize:function(e){var t=arguments.length,n=!0;t==6?this.set.apply(this,arguments):t==1?e instanceof Matrix?this.set(e._a,e._c,e._b,e._d,e._tx,e._ty):Array.isArray(e)?this.set.apply(this,e):n=!1:t==0?(this._a=this._d=1,this._c=this._b=this._tx=this._ty=0):n=!1;if(!n)throw new Error("Unsupported matrix parameters")},clone:function(){return Matrix.create(this._a,this._c,this._b,this._d,this._tx,this._ty)},set:function(e,t,n,r,i,s){return this._a=e,this._c=t,this._b=n,this._d=r,this._tx=i,this._ty=s,this},scale:function(e,t,n){return arguments.length<2||typeof t=="object"?(n=Point.read(arguments,1),t=e):n=Point.read(arguments,2),n&&this.translate(n),this._a*=e,this._c*=e,this._b*=t,this._d*=t,n&&this.translate(n.negate()),this},translate:function(e){e=Point.read(arguments);var t=e.x,n=e.y;return this._tx+=t*this._a+n*this._b,this._ty+=t*this._c+n*this._d,this},rotate:function(e,t){return this.concatenate(Matrix.getRotateInstance.apply(Matrix,arguments))},shear:function(e,t,n){arguments.length<2||typeof t=="object"?(n=Point.read(arguments,1),t=e):n=Point.read(arguments,2),n&&this.translate(n);var r=this._a,i=this._c;return this._a+=t*this._b,this._c+=t*this._d,this._b+=e*r,this._d+=e*i,n&&this.translate(n.negate()),this},toString:function(){var e=Base.formatNumber;return"[["+[e(this._a),e(this._b),e(this._tx)].join(", ")+"], ["+[e(this._c),e(this._d),e(this._ty)].join(", ")+"]]"},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},concatenate:function(e){var t=this._a,n=this._b,r=this._c,i=this._d;return this._a=e._a*t+e._c*n,this._b=e._b*t+e._d*n,this._tx+=e._tx*t+e._ty*n,this._c=e._a*r+e._c*i,this._d=e._b*r+e._d*i,this._ty+=e._tx*r+e._ty*i,this},preConcatenate:function(e){var t=this._a,n=this._b,r=this._c,i=this._d,s=this._tx,o=this._ty;return this._a=e._a*t+e._b*r,this._c=e._c*t+e._d*r,this._b=e._a*n+e._b*i,this._d=e._c*n+e._d*i,this._tx=e._a*s+e._b*o+e._tx,this._ty=e._c*s+e._d*o+e._ty,this},transform:function(e,t,n,r,i){return arguments.length<5?this._transformPoint(Point.read(arguments)):this._transformCoordinates(e,t,n,r,i)},_transformPoint:function(e,t,n){var r=e.x,i=e.y;return t||(t=new Point(Point.dont)),t.set(r*this._a+i*this._b+this._tx,r*this._c+i*this._d+this._ty,n)},_transformCoordinates:function(e,t,n,r,i){var s=t,o=r,u=t+2*i;while(s<u){var a=e[s++],f=e[s++];n[o++]=a*this._a+f*this._b+this._tx,n[o++]=a*this._c+f*this._d+this._ty}return n},_transformCorners:function(e){var t=e.x,n=e.y,r=t+e.width,i=n+e.height,s=[t,n,r,n,r,i,t,i];return this._transformCoordinates(s,0,s,0,4)},_transformBounds:function(e){var t=this._transformCorners(e),n=t.slice(0,2),r=t.slice(0);for(var i=2;i<8;i++){var s=t[i],o=i&1;s<n[o]?n[o]=s:s>r[o]&&(r[o]=s)}return Rectangle.create(n[0],n[1],r[0]-n[0],r[1]-n[1])},inverseTransform:function(e){return this._inverseTransform(Point.read(arguments))},_getDeterminant:function(){var e=this._a*this._d-this._b*this._c;return isFinite(e)&&Math.abs(e)>Numerical.EPSILON&&isFinite(this._tx)&&isFinite(this._ty)?e:null},_inverseTransform:function(e,t,n){var r=this._getDeterminant();if(!r)return null;var i=e.x-this._tx,s=e.y-this._ty;return t||(t=new Point(Point.dont)),t.set((i*this._d-s*this._b)/r,(s*this._a-i*this._c)/r,n)},getTranslation:function(){return new Point(this._tx,this._ty)},getScaling:function(){var e=Math.sqrt(this._a*this._a+this._c*this._c),t=Math.sqrt(this._b*this._b+this._d*this._d);return new Point(this._a<0?-e:e,this._b<0?-t:t)},getRotation:function(){var e=-Math.atan2(this._b,this._d),t=Math.atan2(this._c,this._a);return Math.abs(e-t)<Numerical.TOLERANCE?e*180/Math.PI:undefined},isIdentity:function(){return this._a==1&&this._c==0&&this._b==0&&this._d==1&&this._tx==0&&this._ty==0},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},createInverse:function(){var e=this._getDeterminant();return e&&Matrix.create(this._d/e,-this._c/e,-this._b/e,this._a/e,(this._b*this._ty-this._d*this._tx)/e,(this._c*this._tx-this._a*this._ty)/e)},createShiftless:function(){return Matrix.create(this._a,this._c,this._b,this._d,0,0)},setToScale:function(e,t){return this.set(e,0,0,t,0,0)},setToTranslation:function(e){return e=Point.read(arguments),this.set(1,0,0,1,e.x,e.y)},setToShear:function(e,t){return this.set(1,t,e,1,0,0)},setToRotation:function(e,t){t=Point.read(arguments,1),e=e*Math.PI/180;var n=t.x,r=t.y,i=Math.cos(e),s=Math.sin(e);return this.set(i,s,-s,i,n-n*i+r*s,r-n*s-r*i)},applyToContext:function(e,t){return e[t?"setTransform":"transform"](this._a,this._c,this._b,this._d,this._tx,this._ty),this},statics:{create:function(e,t,n,r,i,s){return(new Matrix(Matrix.dont)).set(e,t,n,r,i,s)},getScaleInstance:function(e,t){var n=new Matrix;return n.setToScale.apply(n,arguments)},getTranslateInstance:function(e){var t=new Matrix;return t.setToTranslation.apply(t,arguments)},getShearInstance:function(e,t,n){var r=new Matrix;return r.setToShear.apply(r,arguments)},getRotateInstance:function(e,t){var n=new Matrix;return n.setToRotation.apply(n,arguments)}}},new function(){return Base.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(e,t){t=Base.capitalize(t),this["get"+t]=function(){return this[e]},this["set"+t]=function(t){this[e]=t}},{})}),Line=this.Line=Base.extend({initialize:function(e,t,n){e=Point.read(arguments,0,1),t=Point.read(arguments,1,1),arguments.length==3?(this.point=e,this.vector=t.subtract(e),this.infinite=n):(this.point=e,this.vector=t,this.infinite=!0)},intersect:function(e){var t=this.vector.cross(e.vector);if(Math.abs(t)<=Numerical.EPSILON)return null;var n=e.point.subtract(this.point),r=n.cross(e.vector)/t,i=n.cross(this.vector)/t;return(this.infinite||0<=r&&r<=1)&&(e.infinite||0<=i&&i<=1)?this.point.add(this.vector.multiply(r)):null},getSide:function(e){var t=this.vector,n=e.subtract(this.point),r=n.cross(t);return r==0&&(r=n.dot(t),r>0&&(r=n.subtract(t).dot(t),r<0&&(r=0))),r<0?-1:r>0?1:0},getDistance:function(e){var t=this.vector.y/this.vector.x,n=this.point.y-t*this.point.x,r=Math.abs(e.y-t*e.x-n)/Math.sqrt(t*t+1);return this.infinite?r:Math.min(r,e.getDistance(this.point),e.getDistance(this.point.add(this.vector)))}}),Project=this.Project=PaperScopeItem.extend({_list:"projects",_reference:"project",initialize:function(){this.base(!0),this._currentStyle=new PathStyle,this._selectedItems={},this._selectedItemCount=0,this.layers=[],this.symbols=[],this.activeLayer=new Layer},_needsRedraw:function(){this._scope&&this._scope._needsRedraw()},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(e){this._currentStyle.initialize(e)},getIndex:function(){return this._index},getSelectedItems:function(){var e=[];return Base.each(this._selectedItems,function(t){e.push(t)}),e},_updateSelection:function(e){e._selected?(this._selectedItemCount++,this._selectedItems[e.getId()]=e):(this._selectedItemCount--,delete this._selectedItems[e.getId()])},selectAll:function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].setSelected(!0)},deselectAll:function(){for(var e in this._selectedItems)this._selectedItems[e].setSelected(!1)},hitTest:function(e,t){t=HitResult.getOptions(e,t),e=t.point;for(var n=this.layers.length-1;n>=0;n--){var r=this.layers[n].hitTest(e,t);if(r)return r}return null},draw:function(e){e.save();var t={offset:new Point(0,0)};for(var n=0,r=this.layers.length;n<r;n++)Item.draw(this.layers[n],e,t);e.restore(),this._selectedItemCount>0&&(e.save(),e.strokeWidth=1,e.strokeStyle=e.fillStyle="#009dec",t={selection:!0},Base.each(this._selectedItems,function(n){n.draw(e,t)}),e.restore())}}),Symbol=this.Symbol=Base.extend({initialize:function(e){this.project=paper.project,this.project.symbols.push(this),this.setDefinition(e),this._instances={}},_changed:function(e){Base.each(this._instances,function(t){t._changed(e)})},getDefinition:function(){return this._definition},setDefinition:function(e){e._parentSymbol&&(e=e.clone()),this._definition&&delete this._definition._parentSymbol,this._definition=e,e.remove(),e.setPosition(new Point),e._parentSymbol=this,this._changed(Change.GEOMETRY)},place:function(e){return new PlacedSymbol(this,e)},clone:function(){return new Symbol(this._definition.clone())}}),ChangeFlag={APPEARANCE:1,HIERARCHY:2,GEOMETRY:4,STROKE:8,STYLE:16,ATTRIBUTE:32,CONTENT:64,PIXELS:128,CLIPPING:256},Change={HIERARCHY:ChangeFlag.HIERARCHY|ChangeFlag.APPEARANCE,GEOMETRY:ChangeFlag.GEOMETRY|ChangeFlag.APPEARANCE,STROKE:ChangeFlag.STROKE|ChangeFlag.STYLE|ChangeFlag.APPEARANCE,STYLE:ChangeFlag.STYLE|ChangeFlag.APPEARANCE,ATTRIBUTE:ChangeFlag.ATTRIBUTE|ChangeFlag.APPEARANCE,CONTENT:ChangeFlag.CONTENT|ChangeFlag.APPEARANCE,PIXELS:ChangeFlag.PIXELS|ChangeFlag.APPEARANCE},Item=this.Item=Base.extend({initialize:function(){this._id=++Item._id,this._project||paper.project.activeLayer.addChild(this),this._style=PathStyle.create(this),this.setStyle(this._project.getCurrentStyle())},_changed:function(e){e&ChangeFlag.GEOMETRY&&(delete this._bounds,delete this._position),e&ChangeFlag.APPEARANCE&&this._project._needsRedraw(),this._parentSymbol&&this._parentSymbol._changed(e);if(this._project._changes){var t=this._project._changesById[this._id];t?t.flags|=e:(t={item:this,flags:e},this._project._changesById[this._id]=t,this._project._changes.push(t))}},getId:function(){return this._id},getName:function(){return this._name},setName:function(e){this._name&&this._removeFromNamed(),this._name=e||undefined;if(e){var t=this._parent._children,n=this._parent._namedChildren;(n[e]=n[e]||[]).push(this),t[e]=this}this._changed(ChangeFlag.ATTRIBUTE)},getPosition:function(){var e=this._position||(this._position=this.getBounds().getCenter());return LinkedPoint.create(this,"setPosition",e._x,e._y)},setPosition:function(e){this.translate(Point.read(arguments).subtract(this.getPosition()))},getStyle:function(){return this._style},setStyle:function(e){this._style.initialize(e)},statics:{_id:0}},new function(){return Base.each(["locked","visible","blendMode","opacity","guide"],function(e){var t=Base.capitalize(e),e="_"+e;this["get"+t]=function(){return this[e]},this["set"+t]=function(t){t!=this[e]&&(this[e]=t,this._changed(e==="_locked"?ChangeFlag.ATTRIBUTE:Change.ATTRIBUTE))}},{})},{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._children)for(var e=0,t=this._children.length;e<t;e++)if(this._children[e].isSelected())return!0;return this._selected},setSelected:function(e){if(this._children)for(var t=0,n=this._children.length;t<n;t++)this._children[t].setSelected(e);else(e=!!e)!=this._selected&&(this._selected=e,this._project._updateSelection(this),this._changed(Change.ATTRIBUTE))},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var e=0,t=this._children.length;e<t;e++)if(!this._children[e].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(e){if(this._children)for(var t=0,n=this._children.length;t<n;t++)this._children[t].setFullySelected(e);this.setSelected(e)},isClipMask:function(){return this._clipMask},setClipMask:function(e){this._clipMask!=(e=!!e)&&(this._clipMask=e,e&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(Change.ATTRIBUTE),this._parent&&this._parent._changed(ChangeFlag.CLIPPING))},_clipMask:!1,getProject:function(){return this._project},_setProject:function(e){if(this._project!=e){this._project=e;if(this._children)for(var t=0,n=this._children.length;t<n;t++)this._children[t]._setProject(e)}},getLayer:function(){var e=this;while(e=e._parent)if(e instanceof Layer)return e;return null},getParent:function(){return this._parent},getChildren:function(){return this._children},setChildren:function(e){this.removeChildren(),this.addChildren(e)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},clone:function(){return this._clone(new this.constructor)},_clone:function(e){e.setStyle(this._style);if(this._children)for(var t=0,n=this._children.length;t<n;t++)e.addChild(this._children[t].clone());var r=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"];for(var t=0,n=r.length;t<n;t++){var i=r[t];this.hasOwnProperty(i)&&(e[i]=this[i])}return e.setSelected(this._selected),this._name&&e.setName(this._name),e},copyTo:function(e){var t=this.clone();return e.layers?e.activeLayer.addChild(t):e.addChild(t),t},rasterize:function(e){var t=this.getStrokeBounds(),n=(e||72)/72,r=CanvasProvider.getCanvas(t.getSize().multiply(n)),i=r.getContext("2d"),s=(new Matrix).scale(n).translate(-t.x,-t.y);s.applyToContext(i),this.draw(i,{});var o=new Raster(r);return o.setBounds(t),o},hitTest:function(e,t,n){t=HitResult.getOptions(e,t),e=t.point;if(!this._children&&!this.getRoughBounds(n).expand(t.tolerance)._containsPoint(e))return null;if((t.center||t.bounds)&&!(this instanceof Layer&&!this._parent)){var r=this.getBounds(),i=this,s=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],o;function u(s,o){var u=r["get"+o]().transform(n);if(e.getDistance(u)<t.tolerance)return new HitResult(s,i,{name:Base.hyphenate(o),point:u})}if(t.center&&(o=u("center","Center")))return o;if(t.bounds)for(var a=0;a<8;a++)if(o=u("bounds",s[a]))return o}return this._children||!(t.guides&&!this._guide||t.selected&&!this._selected)?this._hitTest(e,t,n):null},_hitTest:function(e,t,n){if(this._children)for(var r=this._children.length-1;r>=0;r--){var i=this._children[r].hitTest(e,t,n);if(i)return i}},addChild:function(e){return this.insertChild(undefined,e)},insertChild:function(e,t){return this._children?(t._remove(!1,!0),Base.splice(this._children,[t],e,0),t._parent=this,t._setProject(this._project),t._name&&t.setName(t._name),this._changed(Change.HIERARCHY),!0):!1},addChildren:function(e){for(var t=0,n=e&&e.length;t<n;t++)this.insertChild(undefined,e[t])},insertChildren:function(e,t){for(var n=0,r=t&&t.length;n<r;n++)this.insertChild(e,t[n])&&e++},insertAbove:function(e){return e._parent&&e._parent.insertChild(e._index+1,this)},insertBelow:function(e){return e._parent&&e._parent.insertChild(e._index-1,this)},appendTop:function(e){return this.addChild(e)},appendBottom:function(e){return this.insertChild(0,e)},moveAbove:function(e){return this.insertAbove(e)},moveBelow:function(e){return this.insertBelow(e)},_removeFromNamed:function(){var e=this._parent._children,t=this._parent._namedChildren,n=this._name,r=t[n],i=r?r.indexOf(this):-1;if(i==-1)return;e[n]==this&&delete e[n],r.splice(i,1),r.length?e[n]=r[r.length-1]:delete t[n]},_remove:function(e,t){return this._parent?(e&&this.setSelected(!1),this._name&&this._removeFromNamed(),Base.splice(this._parent._children,null,this._index,1),t&&this._parent._changed(Change.HIERARCHY),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},removeChildren:function(e,t){if(!this._children)return null;e=e||0,t=Base.pick(t,this._children.length);var n=this._children.splice(e,t-e);for(var r=n.length-1;r>=0;r--)n[r]._remove(!0,!1);return n.length>0&&this._changed(Change.HIERARCHY),n},reverseChildren:function(){if(this._children){this._children.reverse();for(var e=0,t=this._children.length;e<t;e++)this._children[e]._index=e;this._changed(Change.HIERARCHY)}},isEditable:function(){var e=this;while(e){if(!e._visible||e._locked)return!1;e=e._parent}return!0},_getOrder:function(e){function t(e){var t=[];do t.unshift(e);while(e=e._parent);return t}var n=t(this),r=t(e);for(var i=0,s=Math.min(n.length,r.length);i<s;i++)if(n[i]!=r[i])return n[i]._index<r[i]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isAbove:function(e){return this._getOrder(e)==-1},isBelow:function(e){return this._getOrder(e)==1},isParent:function(e){return this._parent==e},isChild:function(e){return e&&e._parent==this},isDescendant:function(e){var t=this;while(t=t._parent)if(t==e)return!0;return!1},isAncestor:function(e){return e?e.isDescendant(this):!1},isGroupedWith:function(e){var t=this._parent;while(t){if(t._parent&&(t instanceof Group||t instanceof CompoundPath)&&e.isDescendant(t))return!0;t=t._parent}return!1},_getBounds:function(e,t,n){var r=this._children;if(!r||r.length==0)return new Rectangle;var i=Infinity,s=-i,o=i,u=s;for(var a=0,f=r.length;a<f;a++){var l=r[a];if(l._visible){var c=l[e](n[0]);i=Math.min(c.x,i),o=Math.min(c.y,o),s=Math.max(c.x+c.width,s),u=Math.max(c.y+c.height,u)}}var h=Rectangle.create(i,o,s-i,u-o);return e=="getBounds"?this._createBounds(h):h},_createBounds:function(e){return LinkedRectangle.create(this,"setBounds",e.x,e.y,e.width,e.height)},getBounds:function(){return this._getBounds("getBounds","_bounds",arguments)},setBounds:function(e){e=Rectangle.read(arguments);var t=this.getBounds(),n=new Matrix,r=e.getCenter();n.translate(r),(e.width!=t.width||e.height!=t.height)&&n.scale(t.width!=0?e.width/t.width:1,t.height!=0?e.height/t.height:1),r=t.getCenter(),n.translate(-r.x,-r.y),this.transform(n)},getStrokeBounds:function(){return this._getBounds("getStrokeBounds","_strokeBounds",arguments)},getHandleBounds:function(){return this._getBounds("getHandleBounds","_handleBounds",arguments)},getRoughBounds:function(){return this._getBounds("getRoughBounds","_roughBounds",arguments)},scale:function(e,t,n){if(arguments.length<2||typeof t=="object")n=t,t=e;return this.transform((new Matrix).scale(e,t,n||this.getPosition()))},translate:function(e){var t=new Matrix;return this.transform(t.translate.apply(t,arguments))},rotate:function(e,t){return this.transform((new Matrix).rotate(e,t||this.getPosition()))},shear:function(e,t,n){if(arguments.length<2||typeof t=="object")n=t,t=e;return this.transform((new Matrix).shear(e,t,n||this.getPosition()))},transform:function(e,t){var n=this._bounds,r=this._position,i=this._children;this._transform&&(this._transform(e,t),this._changed(Change.GEOMETRY)),n&&e.getRotation()%90===0?(this._bounds=this._createBounds(e._transformBounds(n)),this._position=this._bounds.getCenter()):r&&(this._position=e._transformPoint(r,r,!0));for(var s=0,o=i&&i.length;s<o;s++)i[s].transform(e,t);return this},fitBounds:function(e,t){e=Rectangle.read(arguments);var n=this.getBounds(),r=n.height/n.width,i=e.height/e.width,s=(t?r>i:r<i)?e.width/n.width:e.height/n.height,o=e.getCenter().subtract(n.getCenter()),u=new Rectangle(new Point,new Size(n.width*s,n.height*s));u.setCenter(e.getCenter()),this.setBounds(u)},toString:function(){return(this.constructor._name||"Item")+(this._name?" '"+this._name+"'":" @"+this._id)},statics:{drawSelectedBounds:function(e,t,n){var r=n._transformCorners(e);t.beginPath();for(var i=0;i<8;i++)t[i==0?"moveTo":"lineTo"](r[i],r[++i]);t.closePath(),t.stroke();for(var i=0;i<8;i++)t.beginPath(),t.rect(r[i]-2,r[++i]-2,4,4),t.fill()},draw:function(e,t,n){if(!e._visible||e._opacity==0)return;var r,i;if(e._blendMode!=="normal"||e._opacity<1&&(!e._segments||!!e.getFillColor()&&!!e.getStrokeColor())){var s=e.getStrokeBounds()||e.getBounds();if(!s.width||!s.height)return;var o=s.getTopLeft().floor(),u=s.getSize().ceil().add(new Size(1,1));r=CanvasProvider.getCanvas(u),i=t,t=r.getContext("2d"),t.save(),t.translate(-o.x,-o.y)}var a;o&&(a=n.offset,n.offset=o),e.draw(t,n),o&&(n.offset=a);if(r){t.restore();if(e._blendMode!=="normal"){var f=o.subtract(n.offset);BlendMode.process(e._blendMode,t,i,e._opacity,f)}else i.save(),i.globalAlpha=e._opacity,i.drawImage(r,o.x,o.y),i.restore();CanvasProvider.returnCanvas(r)}}}},new function(){function t(t){for(var n in t){var r=t[n];r.remove();for(var i in e){var s=e[i];s!=t&&s[r.getId()]&&delete s[r.getId()]}}}function n(n){var r="onMouse"+Base.capitalize(n),i=paper.tool[r];if(!i||!i._installed){var s={};s[r]=function(r){n==="up"&&(e.drag={}),t(e[n]),e[n]={},this.base&&this.base(r)},paper.tool.inject(s),paper.tool[r]._installed=!0}}var e={down:{},drag:{},up:{},move:{}};return Base.each(["down","drag","up","move"],function(e){this["removeOn"+Base.capitalize(e)]=function(){var t={};return t[e]=!0,this.removeOn(t)}},{removeOn:function(t){for(var r in t)t[r]&&(e[r][this.getId()]=this,r==="drag"&&n("up"),n(r));return this}})}),Group=this.Group=Item.extend({initialize:function(e){this.base(),this._children=[],this._namedChildren={},this.addChildren(!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e)},_changed:function(e){Item.prototype._changed.call(this,e),e&(ChangeFlag.HIERARCHY|ChangeFlag.CLIPPING)&&delete this._clipItem},_getClipItem:function(){if(this._clipItem!==undefined)return this._clipItem;for(var e=0,t=this._children.length;e<t;e++){var n=this._children[e];if(n._clipMask)return this._clipItem=n}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(e){var t=this.getFirstChild();return t&&t.setClipMask(e),this},draw:function(e,t){var n=this._getClipItem();n&&Item.draw(n,e,t);for(var r=0,i=this._children.length;r<i;r++){var s=this._children[r];s!=n&&Item.draw(s,e,t)}}}),Layer=this.Layer=Group.extend({initialize:function(e){this._project=paper.project,this._index=this._project.layers.push(this)-1,this.base.apply(this,arguments),this.activate()},_remove:function(e,t){return this._parent?this.base(e,t):this._index!=null?(e&&this.setSelected(!1),Base.splice(this._project.layers,null,this._index,1),this._project._needsRedraw(),!0):!1},getNextSibling:function(){return this._parent?this.base():this._project.layers[this._index+1]||null},getPreviousSibling:function(){return this._parent?this.base():this._project.layers[this._index-1]||null},activate:function(){this._project.activeLayer=this}},new function(){function e(e){return function(t){return t instanceof Layer&&!t._parent&&this._remove(!1,!0)?(Base.splice(t._project.layers,[this],t._index+(e?1:-1),0),this._setProject(t._project),!0):this.base(t)}}return{insertAbove:e(!0),insertBelow:e(!1)}}),PlacedItem=this.PlacedItem=Item.extend({_transform:function(e,t){this._matrix.preConcatenate(e)},_changed:function(e){Item.prototype._changed.call(this,e),e&ChangeFlag.GEOMETRY&&(delete this._strokeBounds,delete this._handleBounds,delete this._roughBounds)},getMatrix:function(){return this._matrix},setMatrix:function(e){this._matrix=e.clone(),this._changed(Change.GEOMETRY)},getBounds:function(){var e=arguments[0]===undefined;if(e&&this._bounds)return this._bounds;var t=this.getStrokeBounds(arguments[0]);return e&&(t=this._bounds=this._createBounds(t)),t},_getBounds:function(e,t,n){var r=n[0],i=r===undefined;if(i&&this[t])return this[t];r=r?r.clone().concatenate(this._matrix):this._matrix;var s=this._calculateBounds(e,r);return i&&(this[t]=s),s}}),Raster=this.Raster=PlacedItem.extend({initialize:function(e){this.base(),e.getContext?this.setCanvas(e):(typeof e=="string"&&(e=document.getElementById(e)),this.setImage(e)),this._matrix=new Matrix},clone:function(){var e=this._image;e||(e=CanvasProvider.getCanvas(this._size),e.getContext("2d").drawImage(this._canvas,0,0));var t=new Raster(e);return t._matrix=this._matrix.clone(),this._clone(t)},getSize:function(){return this._size},setSize:function(){var e=Size.read(arguments),t=this.getImage();this.setCanvas(CanvasProvider.getCanvas(e)),this.getContext(!0).drawImage(t,0,0,e.width,e.height)},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},getPpi:function(){var e=this._matrix,t=(new Point(0,0)).transform(e),n=(new Point(1,0)).transform(e).subtract(t),r=(new Point(0,1)).transform(e).subtract(t);return new Size(72/n.getLength(),72/r.getLength())},getContext:function(){return this._context||(this._context=this.getCanvas().getContext("2d")),arguments[0]&&this._changed(Change.PIXELS),this._context},setContext:function(e){this._context=e},getCanvas:function(){return this._canvas||(this._canvas=CanvasProvider.getCanvas(this._size),this._image&&this.getContext(!0).drawImage(this._image,0,0)),this._canvas},setCanvas:function(e){this._canvas&&CanvasProvider.returnCanvas(this._canvas),this._canvas=e,this._size=new Size(e.width,e.height),this._image=null,this._context=null,this._changed(Change.GEOMETRY)},getImage:function(){return this._image||this.getCanvas()},setImage:function(e){this._canvas&&CanvasProvider.returnCanvas(this._canvas),this._image=e,this._size=new Size(e.naturalWidth,e.naturalHeight),this._canvas=null,this._context=null,this._changed(Change.GEOMETRY)},getSubImage:function(e){e=Rectangle.read(arguments);var t=CanvasProvider.getCanvas(e.getSize());return t.getContext("2d").drawImage(this.getCanvas(),e.x,e.y,t.width,t.height,0,0,t.width,t.height),t},drawImage:function(e,t){t=Point.read(arguments,1),this.getContext(!0).drawImage(e,t.x,t.y)},getAverageColor:function(e){e||(e=this.getBounds());var t,n;e instanceof PathItem?(n=e,t=e.getBounds()):e.width?t=new Rectangle(e):e.x&&(t=Rectangle.create(e.x-.5,e.y-.5,1,1));var r=32,i=Math.min(t.width,r),s=Math.min(t.height,r),o=Raster._sampleContext;o?o.clearRect(0,0,r,r):o=Raster._sampleContext=CanvasProvider.getCanvas(new Size(r)).getContext("2d"),o.save(),o.scale(i/t.width,s/t.height),o.translate(-t.x,-t.y),n&&n.draw(o,{clip:!0}),this._matrix.applyToContext(o),o.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2),o.restore();var u=o.getImageData(.5,.5,Math.ceil(i),Math.ceil(s)).data,a=[0,0,0],f=0;for(var l=0,c=u.length;l<c;l+=4){var h=u[l+3];f+=h,h/=255,a[0]+=u[l]*h,a[1]+=u[l+1]*h,a[2]+=u[l+2]*h}for(var l=0;l<3;l++)a[l]/=f;return f?Color.read(a):null},getPixel:function(e){e=Point.read(arguments);var t=this.getContext().getImageData(e.x,e.y,1,1).data,n=new Array(4);for(var r=0;r<4;r++)n[r]=t[r]/255;return RgbColor.read(n)},setPixel:function(e,t){var n=arguments.length==2;e=Point.read(arguments,0,n?1:2),t=Color.read(arguments,n?1:2);var r=this.getContext(!0),i=r.createImageData(1,1),s=t.getAlpha();i.data[0]=t.getRed()*255,i.data[1]=t.getGreen()*255,i.data[2]=t.getBlue()*255,i.data[3]=s!=null?s*255:255,r.putImageData(i,e.x,e.y)},createData:function(e){return e=Size.read(arguments),this.getContext().createImageData(e.width,e.height)},getData:function(e){return e=Rectangle.read(arguments),e.isEmpty()&&(e=new Rectangle(this.getSize())),this.getContext().getImageData(e.x,e.y,e.width,e.height)},setData:function(e,t){t=Point.read(arguments,1),this.getContext(!0).putImageData(e,t.x,t.y)},_calculateBounds:function(e,t){return t._transformBounds((new Rectangle(this._size)).setCenter(0,0))},getHandleBounds:function(){return this.getStrokeBounds(arguments[0])},getRoughBounds:function(){return this.getStrokeBounds(arguments[0])},draw:function(e,t){if(t.selection){var n=(new Rectangle(this._size)).setCenter(0,0);Item.drawSelectedBounds(n,e,this._matrix)}else e.save(),this._matrix.applyToContext(e),e.drawImage(this._canvas||this._image,-this._size.width/2,-this._size.height/2),e.restore()}}),PlacedSymbol=this.PlacedSymbol=PlacedItem.extend({initialize:function(e,t){this.base(),this.setSymbol(e instanceof Symbol?e:new Symbol(e)),this._matrix=t!==undefined?t instanceof Matrix?t:(new Matrix).translate(Point.read(arguments,1)):new Matrix},getSymbol:function(){return this._symbol},setSymbol:function(e){this._symbol&&delete this._symbol._instances[this._id],this._symbol=e,e._instances[this._id]=this},clone:function(){return this._clone(new PlacedSymbol(this.symbol,this._matrix.clone()))},_calculateBounds:function(e,t){return this.symbol._definition[e](t)},draw:function(e,t){t.selection?Item.drawSelectedBounds(this.symbol._definition.getStrokeBounds(),e,this._matrix):(e.save(),this._matrix.applyToContext(e),Item.draw(this.symbol.getDefinition(),e,t),e.restore())}});HitResult=Base.extend({initialize:function(e,t,n){this.type=e,this.item=t,n&&Base.each(n,function(e,t){this[t]=e},this)},statics:{getOptions:function(e,t){return t&&t._merged?t:Base.merge({point:Point.read(arguments,0,1),type:null,tolerance:2,fill:!t,stroke:!t,segments:!t,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},t)}}});var Segment=this.Segment=Base.extend({initialize:function(e,t,n,r,i,s){var o=arguments.length,u=SegmentPoint.create,a,f,l;o!=0&&(o==1?e.point?(a=e.point,f=e.handleIn,l=e.handleOut):a=e:o<6?o==2&&t.x===undefined?a=[e,t]:(a=e,f=t,l=n):o==6&&(a=[e,t],f=[n,r],l=[i,s])),u(this,"_point",a),u(this,"_handleIn",f),u(this,"_handleOut",l)},_changed:function(e){if(!this._path)return;var t=this._path._curves&&this.getCurve(),n;t&&(t._changed(),(n=t[e==this._point||e==this._handleIn&&t._segment1==this?"getPrevious":"getNext"]())&&n._changed()),this._path._changed(Change.GEOMETRY)},getPoint:function(){return this._point},setPoint:function(e){e=Point.read(arguments),this._point.set(e.x,e.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(e){e=Point.read(arguments),this._handleIn.set(e.x,e.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(e){e=Point.read(arguments),this._handleOut.set(e.x,e.y)},_isSelected:function(e){var t=this._selectionState;return e==this._point?!!(t&SelectionState.POINT):e==this._handleIn?!!(t&SelectionState.HANDLE_IN):e==this._handleOut?!!(t&SelectionState.HANDLE_OUT):!1},_setSelected:function(e,t){var n=this._path,t=!!t,r=this._selectionState||0,i=[!!(r&SelectionState.POINT),!!(r&SelectionState.HANDLE_IN),!!(r&SelectionState.HANDLE_OUT)];if(e==this._point){if(t)i[1]=i[2]=!1;else{var s=this.getPrevious(),o=this.getNext();i[1]=s&&(s._point.isSelected()||s._handleOut.isSelected()),i[2]=o&&(o._point.isSelected()||o._handleIn.isSelected())}i[0]=t}else{var u=e==this._handleIn?1:2;i[u]!=t&&(t&&(i[0]=!1),i[u]=t,n._changed(Change.ATTRIBUTE))}this._selectionState=(i[0]?SelectionState.POINT:0)|(i[1]?SelectionState.HANDLE_IN:0)|(i[2]?SelectionState.HANDLE_OUT:0),n&&r!=this._selectionState&&n._updateSelection(this,r,this._selectionState)},isSelected:function(){return this._isSelected(this._point)},setSelected:function(e){this._setSelected(this._point,e)},getIndex:function(){return this._index!==undefined?this._index:null},getPath:function(){return this._path||null},getCurve:function(){if(this._path){var e=this._index;return!this._path._closed&&e==this._path._segments.length-1&&e--,this._path.getCurves()[e]||null}return null},getNext:function(){var e=this._path&&this._path._segments;return e&&(e[this._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._segments;return e&&(e[this._index-1]||this._path._closed&&e[e.length-1])||null},reverse:function(){return new Segment(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},toString:function(){var e=["point: "+this._point];return this._handleIn.isZero()||e.push("handleIn: "+this._handleIn),this._handleOut.isZero()||e.push("handleOut: "+this._handleOut),"{ "+e.join(", ")+" }"},_transformCoordinates:function(e,t,n){var r=this._point,i=!n||!this._handleIn.isZero()?this._handleIn:null,s=!n||!this._handleOut.isZero()?this._handleOut:null,o=r._x,u=r._y,a=2;t[0]=o,t[1]=u,i&&(t[a++]=i._x+o,t[a++]=i._y+u),s&&(t[a++]=s._x+o,t[a++]=s._y+u);if(!e)return;e._transformCoordinates(t,0,t,0,a/2),o=t[0],u=t[1],n?(r._x=o,r._y=u,a=2,i&&(i._x=t[a++]-o,i._y=t[a++]-u),s&&(s._x=t[a++]-o,s._y=t[a++]-u)):(i||(t[a++]=o,t[a++]=u),s||(t[a++]=o,t[a++]=u))}}),SegmentPoint=Point.extend({set:function(e,t){return this._x=e,this._y=t,this._owner._changed(this),this},getX:function(){return this._x},setX:function(e){this._x=e,this._owner._changed(this)},getY:function(){return this._y},setY:function(e){this._y=e,this._owner._changed(this)},isZero:function(){return this._x==0&&this._y==0},setSelected:function(e){this._owner._setSelected(this,e)},isSelected:function(){return this._owner._isSelected(this)},statics:{create:function(e,t,n){var r=new SegmentPoint(SegmentPoint.dont),i,s,o;return n?(i=n[0])!==undefined?s=n[1]:((i=n.x)===undefined&&(n=Point.read(arguments,2,1),i=n.x),s=n.y,o=n.selected):i=s=0,r._x=i,r._y=s,r._owner=e,e[t]=r,o&&r.setSelected(!0),r}}}),SelectionState={HANDLE_IN:1,HANDLE_OUT:2,POINT:4},Curve=this.Curve=Base.extend({initialize:function(e,t,n,r,i,s,o,u){var a=arguments.length;if(a==0)this._segment1=new Segment,this._segment2=new Segment;else if(a==1)this._segment1=new Segment(e.segment1),this._segment2=new Segment(e.segment2);else if(a==2)this._segment1=new Segment(e),this._segment2=new Segment(t);else if(a==4)this._segment1=new Segment(e,null,t),this._segment2=new Segment(r,n,null);else if(a==8){var f=Point.create(e,t),l=Point.create(o,u);this._segment1=new Segment(f,null,Point.create(n,r).subtract(f)),this._segment2=new Segment(l,Point.create(i,s).subtract(l),null)}},_changed:function(){delete this._length},getPoint1:function(){return this._segment1._point},setPoint1:function(e){e=Point.read(arguments),this._segment1._point.set(e.x,e.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(e){e=Point.read(arguments),this._segment2._point.set(e.x,e.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(e){e=Point.read(arguments),this._segment1._handleOut.set(e.x,e.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(e){e=Point.read(arguments),this._segment2._handleIn.set(e.x,e.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index+1]||this._path._closed&&e[0])||null},getPrevious:function(){var e=this._path&&this._path._curves;return e&&(e[this._segment1._index-1]||this._path._closed&&e[e.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(e){this.getHandle1().setSelected(e),this.getHandle2().setSelected(e)},getValues:function(e){return Curve.getValues(this._segment1,this._segment2,e)},getPoints:function(e){var t=this.getValues(e),n=[];for(var r=0;r<8;r+=2)n.push(Point.create(t[r],t[r+1]));return n},getLength:function(){var e=arguments[0],t=arguments[1];fullLength=arguments.length==0||e==0&&t==1;if(fullLength&&this._length!=null)return this._length;var n=Curve.getLength(this.getValues(),e,t);return fullLength&&(this._length=n),n},getPart:function(e,t){return new Curve(Curve.getPart(this.getValues(),e,t))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getParameterAt:function(e,t){return Curve.getParameterAt(this.getValues(),e,t!==undefined?t:e<0?1:0)},getPoint:function(e){return Curve.evaluate(this.getValues(),e,0)},getTangent:function(e){return Curve.evaluate(this.getValues(),e,1)},getNormal:function(e){return Curve.evaluate(this.getValues(),e,2)},getParameter:function(e){return e=Point.read(e),Curve.getParameter(this.getValues(),e.x,e.y)},getCrossings:function(e,t,n){var r=this.getValues(t),i=Curve.solveCubic(r,1,e.y,n),s=0;for(var o=0;o<i;o++){var u=n[o];if(u>=0&&u<1&&Curve.evaluate(r,u,0).x>e.x){if(u<Numerical.TOLERANCE&&Curve.evaluate(this.getPrevious().getValues(t),1,1).y*Curve.evaluate(r,u,1).y>=0)continue;s++}}return s},reverse:function(){return new Curve(this._segment2.reverse(),this._segment1.reverse())},clone:function(){return new Curve(this._segment1,this._segment2)},toString:function(){var e=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||e.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||e.push("handle2: "+this._segment2._handleIn),e.push("point2: "+this._segment2._point),"{ "+e.join(", ")+" }"},statics:{create:function(e,t,n){var r=new Curve(Curve.dont);return r._path=e,r._segment1=t,r._segment2=n,r},getValues:function(e,t,n){var r=e._point,i=e._handleOut,s=t._handleIn,o=t._point,u=[r._x,r._y,r._x+i._x,r._y+i._y,o._x+s._x,o._y+s._y,o._x,o._y];return n?n._transformCoordinates(u,0,u,0,4):u},evaluate:function(e,t,n){var r=e[0],i=e[1],s=e[2],o=e[3],u=e[4],a=e[5],f=e[6],l=e[7],c,h;if(n!=0||t!=0&&t!=1){var p=Numerical.TOLERANCE;t<p&&s==r&&o==i?t=p:t>1-p&&u==f&&a==l&&(t=1-p);var d=3*(s-r),v=3*(u-s)-d,m=f-r-d-v,g=3*(o-i),y=3*(a-o)-g,b=l-i-g-y;switch(n){case 0:c=((m*t+v)*t+d)*t+r,h=((b*t+y)*t+g)*t+i;break;case 1:case 2:c=(3*m*t+2*v)*t+d,h=(3*b*t+2*y)*t+g}}else c=t==0?r:f,h=t==0?i:l;return n==2?new Point(h,-c):new Point(c,h)},subdivide:function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],u=e[5],a=e[6],f=e[7];t===undefined&&(t=.5);var l=1-t,c=l*n+t*i,h=l*r+t*s,p=l*i+t*o,d=l*s+t*u,v=l*o+t*a,m=l*u+t*f,g=l*c+t*p,y=l*h+t*d,b=l*p+t*v,w=l*d+t*m,E=l*g+t*b,S=l*y+t*w;return[[n,r,c,h,g,y,E,S],[E,S,b,w,v,m,a,f]]},solveCubic:function(e,t,n,r){var i=e[t],s=e[t+2],o=e[t+4],u=e[t+6],a=3*(s-i),f=3*(o-s)-a,l=u-i-a-f;return Numerical.solveCubic(l,f,a,i-n,r,Numerical.TOLERANCE)},getParameter:function(e,t,n){var r=[],i=[],s=Curve.solveCubic(e,0,t,r),o=Curve.solveCubic(e,1,n,i),u,a;for(var f=0;s==-1||f<s;)if(s==-1||(u=r[f++])>=0&&u<=1){for(var l=0;o==-1||l<o;)if(o==-1||(a=i[l++])>=0&&a<=1){s==-1?u=a:o==-1&&(a=u);if(Math.abs(u-a)<Numerical.TOLERANCE)return(u+a)*.5}if(s==-1)break}return null},getPart:function(e,t,n){return t>0&&(e=Curve.subdivide(e,t)[1]),n<1&&(e=Curve.subdivide(e,(n-t)/(1-t))[0]),e},isFlatEnough:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=n-a,l=u-t,c=t*a-u*n,h=f*r+l*i+c,p=f*s+l*o+c;return Math.abs((h*h+p*p)/(f*(f*f+l*l)))<.005}}},new function(){function e(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],f=9*(r-s)+3*(u-t),l=6*(t+s)-12*r,c=3*(r-t),h=9*(i-o)+3*(a-n),p=6*(n+o)-12*i,d=3*(i-n);return function(e){var t=(f*e+l)*e+c,n=(h*e+p)*e+d;return Math.sqrt(t*t+n*n)}}function t(e,t){return Math.max(2,Math.min(16,Math.ceil(Math.abs(t-e)*32)))}return{statics:!0,getLength:function(n,r,i){r===undefined&&(r=0),i===undefined&&(i=1);if(n[0]==n[2]&&n[1]==n[3]&&n[6]==n[4]&&n[7]==n[5]){var s=n[6]-n[0],o=n[7]-n[1];return(i-r)*Math.sqrt(s*s+o*o)}var u=e(n);return Numerical.integrate(u,r,i,t(r,i))},getParameterAt:function(n,r,i){function h(e){var n=t(i,e);return c+=i<e?Numerical.integrate(a,i,e,n):-Numerical.integrate(a,e,i,n),i=e,c-r}if(r==0)return i;var s=r>0,o=s?i:0,u=s?1:i,r=Math.abs(r),a=e(n),f=Numerical.integrate(a,o,u,t(o,u));if(r>=f)return s?u:o;var l=r/f,c=0;return Numerical.findRoot(h,a,s?o+l:u-l,o,u,16,Numerical.TOLERANCE)}}},new function(){function i(e,t){var r=3,i=5,s=[],o=[],u=[],a=[];for(var f=0;f<=r;f++)s[f]=e[f].subtract(t),f<r&&(o[f]=e[f+1].subtract(e[f]).multiply(r));for(var l=0;l<r;l++){u[l]=[];for(var c=0;c<=r;c++)u[l][c]=o[l].dot(s[c])}for(var f=0;f<=i;f++)a[f]=new Point(f/i,0);for(k=0;k<=i;k++){var h=Math.max(0,k-r+1),p=Math.min(k,r);for(var f=h;f<=p;f++){var d=k-f;a[k].y+=u[d][f]*n[d][f]}}return a}function s(t,n){switch(o(t)){case 0:return[];case 1:if(n>=e)return[.5*(t[0].x+t[5].x)];if(u(t)){var i=new Line(t[0],t[5],!0);return[i.vector.getLength(!0)<=Numerical.EPSILON?i.point.x:r.intersect(i).x]}}var a=[[]],f=[],l=[];for(var c=0;c<=5;c++)a[0][c]=new Point(t[c]);for(var h=1;h<=5;h++){a[h]=[];for(var c=0;c<=5-h;c++)a[h][c]=a[h-1][c].add(a[h-1][c+1]).multiply(.5)}for(var c=0;c<=5;c++)f[c]=a[c][0],l[c]=a[5-c][c];return s(f,n+1).concat(s(l,n+1))}function o(e){var t=0,n=null;for(var r=0,i=e.length;r<i;r++){var s=e[r].y<0?-1:1;n!=null&&s!=n&&t++,n=s}return t}function u(e){var n=e.length-1,r=e[0].y-e[n].y,i=e[n].x-e[0].x,s=e[0].x*e[n].y-e[n].x*e[0].y,o=0,u=0;for(var a=1;a<n;a++){var f=r*e[a].x+i*e[a].y+s,l=f*f;f<0&&l>u?u=l:l>o&&(o=l)}return Math.abs((o+u)/(2*r*(r*r+i*i)))<t}var e=32,t=Math.pow(2,-e-1),n=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],r=new Line(new Point(0,0),new Point(1,0));return{getNearestLocation:function(e,t){var n=i(this.getPoints(t),e),r=s(n,0).concat([0,1]),o=Infinity,u,a;for(var f=0;f<r.length;f++){var l=this.getPoint(r[f]),c=e.getDistance(l,!0);c<o&&(o=c,u=r[f],a=l)}return new CurveLocation(this,u,a,Math.sqrt(o))},getNearestPoint:function(e,t){return this.getNearestLocation(e,t).getPoint()}}});CurveLocation=Base.extend({initialize:function(e,t,n,r){this._curve=e,this._parameter=t,this._point=n,this._distance=r},getSegment:function(){if(!this._segment){var e=this._curve,t=this.getParameter();if(t==0)this._segment=e._segment1;else if(t==1)this._segment=e._segment2;else{if(t==null)return null;this._segment=e.getLength(0,t)<e.getLength(t,1)?e._segment1:e._segment2}}return this._segment},getCurve:function(){return this._curve},getPath:function(){return this._curve&&this._curve._path},getIndex:function(){return this._curve&&this._curve.getIndex()},getOffset:function(){var e=this._curve&&this._curve._path;return e&&e._getOffset(this)},getCurveOffset:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getLength(0,e)},getParameter:function(){return this._parameter==null&&this._curve&&this._point&&(this._parameter=this._curve.getParameterAt(this._point)),this._parameter},getPoint:function(){return!this._point&&this._curve&&this._parameter!=null&&(this._point=this._curve.getPoint(this._parameter)),this._point},getTangent:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getTangent(e)},getNormal:function(){var e=this.getParameter();return e!=null&&this._curve&&this._curve.getNormal(e)},getDistance:function(){return this._distance},toString:function(){var e=[],t=this.getPoint();t&&e.push("point: "+t);var n=this.getIndex();n!=null&&e.push("index: "+n);var r=this.getParameter();return r!=null&&e.push("parameter: "+Base.formatNumber(r)),this._distance!=null&&e.push("distance: "+Base.formatNumber(this._distance)),"{ "+e.join(", ")+" }"}});var PathItem=this.PathItem=Item.extend({}),Path=this.Path=PathItem.extend({initialize:function(e){this.base(),this._closed=!1,this._selectedSegmentState=0,this.setSegments(!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e)},clone:function(){var e=this._clone(new Path(this._segments));return e._closed=this._closed,this._clockwise!==undefined&&(e._clockwise=this._clockwise),e},_changed:function(e){Item.prototype._changed.call(this,e),e&ChangeFlag.GEOMETRY?(delete this._strokeBounds,delete this._handleBounds,delete this._roughBounds,delete this._length,delete this._clockwise):e&ChangeFlag.STROKE&&delete this._strokeBounds},getSegments:function(){return this._segments},setSegments:function(e){this._segments?(this._selectedSegmentState=0,this._segments.length=0,this._curves&&delete this._curves):this._segments=[],this._add(Segment.readAll(e))},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){if(!this._curves){var e=this._segments,t=e.length;!this._closed&&t>0&&t--,this._curves=new Array(t);for(var n=0;n<t;n++)this._curves[n]=Curve.create(this,e[n],e[n+1]||e[0])}return this._curves},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var e=this.getCurves();return e[e.length-1]},getClosed:function(){return this._closed},setClosed:function(e){if(this._closed!=(e=!!e)){this._closed=e;if(this._curves){var t=this._segments.length,n;!e&&t>0&&t--,this._curves.length=t,e&&(this._curves[n=t-1]=Curve.create(this,this._segments[n],this._segments[0]))}this._changed(Change.GEOMETRY)}},_transform:function(e,t){if(!e.isIdentity()){var n=new Array(6);for(var r=0,i=this._segments.length;r<i;r++)this._segments[r]._transformCoordinates(e,n,!0);var s=this.getFillColor(),o=this.getStrokeColor();s&&s.transform&&s.transform(e),o&&o.transform&&o.transform(e)}},_add:function(e,t){var n=this._segments,r=this._curves,i=e.length,s=t==null,t=s?n.length:t,o=this.isFullySelected();for(var u=0;u<i;u++){var a=e[u];a._path&&(a=e[u]=new Segment(a)),a._path=this,a._index=t+u,o&&(a._selectionState=SelectionState.POINT),a._selectionState&&this._updateSelection(a,0,a._selectionState)}if(s)n.push.apply(n,e);else{n.splice.apply(n,[t,0].concat(e));for(var u=t+i,f=n.length;u<f;u++)n[u]._index=u}if(r&&--t>=0){r.splice(t,0,Curve.create(this,n[t],n[t+1]));var l=r[t+i];l&&(l._segment1=n[t+i])}return this._changed(Change.GEOMETRY),e},add:function(e){return arguments.length>1&&typeof e!="number"?this._add(Segment.readAll(arguments)):this._add([Segment.read(arguments)])[0]},insert:function(e,t){return arguments.length>2&&typeof t!="number"?this._add(Segment.readAll(arguments,1),e):this._add([Segment.read(arguments,1)],e)[0]},addSegment:function(e){return this._add([Segment.read(arguments)])[0]},insertSegment:function(e,t){return this._add([Segment.read(arguments,1)],e)[0]},addSegments:function(e){return this._add(Segment.readAll(e))},insertSegments:function(e,t){return this._add(Segment.readAll(t),e)},removeSegment:function(e){var t=this.removeSegments(e,e+1);return t[0]||null},removeSegments:function(e,t){e=e||0,t=Base.pick(t,this._segments.length);var n=this._segments,r=this._curves,i=t>=n.length,s=n.splice(e,t-e),o=s.length;if(!o)return s;for(var u=0;u<o;u++){var a=s[u];a._selectionState&&this._updateSelection(a,a._selectionState,0),s._index=s._path=undefined}for(var u=e,f=n.length;u<f;u++)n[u]._index=u;if(r){r.splice(e,o);var l;if(l=r[e-1])l._segment2=n[e];if(l=r[e])l._segment1=n[e];i&&this._closed&&(l=r[r.length-1])&&(l._segment2=n[0])}return this._changed(Change.GEOMETRY),s},isFullySelected:function(){return this._selected&&this._selectedSegmentState==this._segments.length*SelectionState.POINT},setFullySelected:function(e){var t=this._segments.length;this._selectedSegmentState=e?t*SelectionState.POINT:0;for(var n=0;n<t;n++)this._segments[n]._selectionState=e?SelectionState.POINT:0;this.setSelected(e)},_updateSelection:function(e,t,n){e._selectionState=n;var r=this._selectedSegmentState+=n-t;r>0&&this.setSelected(!0)},flatten:function(e){var t=new PathFlattener(this),n=0,r=t.length/Math.ceil(t.length/e),i=t.length+(this._closed?-r:r)/2,s=[];while(n<=i)s.push(new Segment(t.evaluate(n,0))),n+=r;this.setSegments(s)},simplify:function(e){if(this._segments.length>2){var t=new PathFitter(this,e||2.5);this.setSegments(t.fit())}},isClockwise:function(){function r(r,i){t!==undefined&&(e+=(t-r)*(i+n)),t=r,n=i}if(this._clockwise!==undefined)return this._clockwise;var e=0,t,n;for(var i=0,s=this._segments.length;i<s;i++){var o=this._segments[i],u=this._segments[i+1<s?i+1:0],a=o._point,f=o._handleOut,l=u._handleIn,c=u._point;r(a._x,a._y),r(a._x+f._x,a._y+f._y),r(c._x+l._x,c._y+l._y),r(c._x,c._y)}return e>0},setClockwise:function(e){this.isClockwise()!=(e=!!e)&&(this.reverse(),this._clockwise=e)},reverse:function(){this._segments.reverse();for(var e=0,t=this._segments.length;e<t;e++){var n=this._segments[e],r=n._handleIn;n._handleIn=n._handleOut,n._handleOut=r}this._clockwise!==undefined&&(this._clockwise=!this._clockwise)},join:function(e){if(e){var t=e._segments,n=this.getLastSegment(),r=e.getLastSegment();n._point.equals(r._point)&&e.reverse();var i=e.getFirstSegment();if(n._point.equals(i._point))n.setHandleOut(i._handleOut),this._add(t.slice(1));else{var s=this.getFirstSegment();s._point.equals(i._point)&&e.reverse(),r=e.getLastSegment(),s._point.equals(r._point)?(s.setHandleIn(r._handleIn),this._add(t.slice(0,t.length-1),0)):this._add(t.slice(0))}e.remove();var s=this.getFirstSegment();return n=this.getLastSegment(),n._point.equals(s._point)&&(s.setHandleIn(n._handleIn),n.remove(),this.setClosed(!0)),this._changed(Change.GEOMETRY),!0}return!1},getLength:function(){if(this._length==null){var e=this.getCurves();this._length=0;for(var t=0,n=e.length;t<n;t++)this._length+=e[t].getLength()}return this._length},_getOffset:function(e){var t=e&&e.getIndex();if(t!=null){var n=this.getCurves(),r=0;for(var i=0;i<t;i++)r+=n[i].getLength();var s=n[t];return r+s.getLength(0,e.getParameter())}return null},getLocation:function(e){var t=this.getCurves();for(var n=0,r=t.length;n<r;n++){var i=t[n],s=i.getParameter(e);if(s!=null)return new CurveLocation(i,s)}return null},getLocationAt:function(e,t){var n=this.getCurves(),r=0;if(t){var i=~~e;return new CurveLocation(n[i],e-i)}for(var s=0,o=n.length;s<o;s++){var u=r,a=n[s];r+=a.getLength();if(r>=e)return new CurveLocation(a,a.getParameterAt(e-u))}return e<=this.getLength()?new CurveLocation(n[n.length-1],1):null},getPointAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getPoint()},getTangentAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getTangent()},getNormalAt:function(e,t){var n=this.getLocationAt(e,t);return n&&n.getNormal()},getNearestLocation:function(e,t){var n=this.getCurves(),r=Infinity,i=null;for(var s=0,o=n.length;s<o;s++){var u=n[s].getNearestLocation(e,t);u._distance<r&&(r=u._distance,i=u)}return i},getNearestPoint:function(e,t){return this.getNearestLocation(e,t).getPoint()},contains:function(e,t){e=Point.read(arguments);if(!this._closed||!this.getRoughBounds(t)._containsPoint(e))return!1;var n=this.getCurves(),r=0,i=[];for(var s=0,o=n.length;s<o;s++)r+=n[s].getCrossings(e,t,i);return(r&1)==1},_hitTest:function(e,t,n){function f(i,s){i._transformCoordinates(n,u);for(var o=s||t.segments?0:2,f=!s&&t.handles?6:2;o<f;o+=2)if(e.getDistance(u[o],u[o+1])<r)return new HitResult(o==0?"segment":"handle-"+(o==2?"in":"out"),a,{segment:i})}var r=t.tolerance||0,i=(t.stroke?this.getStrokeWidth()/2:0)+r,s,o,u=[],a=this;if(t.ends&&!t.segments&&!this._closed){if(o=f(this.getFirstSegment(),!0)||f(this.getLastSegment(),!0))return o}else if(t.segments||t.handles)for(var l=0,c=this._segments.length;l<c;l++)if(o=f(this._segments[l]))return o;t.stroke&&i>0&&(s=this.getNearestLocation(e,n));if(!(s&&s._distance<=i)&&t.fill&&this.getFillColor()&&this.contains(e,n))return new HitResult("fill",this);!s&&t.stroke&&i>0&&(s=this.getNearestLocation(e,n));if(s&&s._distance<=i)return t.stroke?new HitResult("stroke",this,{location:s}):new HitResult("fill",this)}},new function(){function e(e,n){for(var r=0,i=n.length;r<i;r++){var s=n[r],o=s._point,u=s._selectionState,a=u&SelectionState.POINT;(a||u&SelectionState.HANDLE_IN)&&t(e,o,s._handleIn),(a||u&SelectionState.HANDLE_OUT)&&t(e,o,s._handleOut),e.save(),e.beginPath(),e.rect(o._x-2,o._y-2,4,4),e.fill(),a||(e.beginPath(),e.rect(o._x-1,o._y-1,2,2),e.fillStyle="#ffffff",e.fill()),e.restore()}}function t(e,t,n){if(!n.isZero()){var r=t._x+n._x,i=t._y+n._y;e.beginPath(),e.moveTo(t._x,t._y),e.lineTo(r,i),e.stroke(),e.beginPath(),e.arc(r,i,1.75,0,Math.PI*2,!0),e.fill()}}function n(e,t){function u(t){var r=n[t],u=r._point,a=u._x,f=u._y,l=r._handleIn;i?l.isZero()&&i.isZero()?e.lineTo(a,f):e.bezierCurveTo(s,o,l._x+a,l._y+f,a,f):e.moveTo(a,f),i=r._handleOut,s=i._x+a,o=i._y+f}var n=t._segments,r=n.length,i,s,o;for(var a=0;a<r;a++)u(a);t._closed&&r>1&&u(0)}function r(e,t,n,r){var i=new PathFlattener(t),s=r,o,u=0;while(s<i.length)o=s+n[u++%n.length],i.drawPart(e,s,o),s=o+n[u++%n.length]}return{draw:function(t,i){i.compound||t.beginPath();var s=this.getFillColor(),o=this.getStrokeColor(),u=this.getDashArray()||[],a=!!u.length;(i.compound||i.selection||this._clipMask||s||o&&!a)&&n(t,this);if(i.selection)t.stroke(),e(t,this._segments);else if(this._clipMask)t.clip();else if(!i.compound&&(s||o)){t.save(),this._setStyles(t);if(!s||!o)t.globalAlpha=this._opacity;s&&(t.fillStyle=s.getCanvasStyle(t),t.fill()),o&&(t.strokeStyle=o.getCanvasStyle(t),a&&(t.beginPath(),r(t,this,u,this.getDashOffset())),t.stroke()),t.restore()}}}},new function(){function e(e){var t=e.length,n=[],r=[],i=2;n[0]=e[0]/i;for(var s=1;s<t;s++)r[s]=1/i,i=(s<t-1?4:2)-r[s],n[s]=(e[s]-n[s-1])/i;for(var s=1;s<t;s++)n[t-s-1]-=r[t-s]*n[t-s];return n}var t={getStrokeWidth:"lineWidth",getStrokeJoin:"lineJoin",getStrokeCap:"lineCap",getMiterLimit:"miterLimit"};return{_setStyles:function(e){for(var n in t){var r=this._style[n]();r&&(e[t[n]]=r)}},smooth:function(){var t=this._segments,n=t.length,r=n,i;if(n<=2)return;this._closed?(i=Math.min(n,4),r+=Math.min(n,i)*2):i=0;var s=[];for(var o=0;o<n;o++)s[o+i]=t[o]._point;if(this._closed)for(var o=0;o<i;o++)s[o]=t[o+n-i]._point,s[o+n+i]=t[o]._point;else r--;var u=[];for(var o=1;o<r-1;o++)u[o]=4*s[o]._x+2*s[o+1]._x;u[0]=s[0]._x+2*s[1]._x,u[r-1]=3*s[r-1]._x;var a=e(u);for(var o=1;o<r-1;o++)u[o]=4*s[o]._y+2*s[o+1]._y;u[0]=s[0]._y+2*s[1]._y,u[r-1]=3*s[r-1]._y;var f=e(u);if(this._closed){for(var o=0,l=n;o<i;o++,l++){var c=o/i,h=1-c;a[l]=a[o]*c+a[l]*h,f[l]=f[o]*c+f[l]*h;var p=o+i,d=l+i;a[d]=a[p]*h+a[d]*c,f[d]=f[p]*h+f[d]*c}r--}var v=null;for(var o=i;o<=r-i;o++){var m=t[o-i];v&&m.setHandleIn(v.subtract(m._point)),o<r&&(m.setHandleOut((new Point(a[o],f[o])).subtract(m._point)),o<r-1?v=new Point(2*s[o+1]._x-a[o+1],2*s[o+1]._y-f[o+1]):v=new Point((s[r]._x+a[r-1])/2,(s[r]._y+f[r-1])/2))}if(this._closed&&v){var m=this._segments[0];m.setHandleIn(v.subtract(m._point))}}}},new function(){function e(e){var t=e._segments;if(t.length==0)throw new Error("Use a moveTo() command first");return t[t.length-1]}return{moveTo:function(e){this._segments.length||this._add([new Segment(Point.read(arguments))])},moveBy:function(e){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(e){this._add([new Segment(Point.read(arguments))])},cubicCurveTo:function(t,n,r){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1),r=Point.read(arguments,2,1);var i=e(this);i.setHandleOut(t.subtract(i._point)),this._add([new Segment(r,n.subtract(r))])},quadraticCurveTo:function(t,n){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1);var r=e(this)._point;this.cubicCurveTo(t.add(r.subtract(t).multiply(1/3)),t.add(n.subtract(t).multiply(1/3)),n)},curveTo:function(t,n,r){t=Point.read(arguments,0,1),n=Point.read(arguments,1,1);var i=Base.pick(r,.5),s=1-i,o=e(this)._point,u=t.subtract(o.multiply(s*s)).subtract(n.multiply(i*i)).divide(2*i*s);if(u.isNaN())throw new Error("Cannot put a curve through points with parameter = "+i);this.quadraticCurveTo(u,n)},arcTo:function(t,n){var r=e(this),i=r._point,s;n===undefined&&(n=!0);if(typeof n=="boolean"){t=Point.read(arguments,0,1);var o=i.add(t).divide(2),s=o.add(o.subtract(i).rotate(n?-90:90))}else s=Point.read(arguments,0,1),t=Point.read(arguments,1,1);var u=new Line(i.add(s).divide(2),s.subtract(i).rotate(90)),a=new Line(s.add(t).divide(2),t.subtract(s).rotate(90)),f=u.intersect(a),l=new Line(i,t,!0),c=l.getSide(s);if(!f){if(!c)return this.lineTo(t);throw new Error("Cannot put an arc through the given points: "+[i,s,t])}var h=i.subtract(f),p=h.getLength(),d=h.getDirectedAngle(t.subtract(f)),v=l.getSide(f);v==0?d=c*Math.abs(d):c==v&&(d-=360*(d<0?-1:1));var m=Math.abs(d),g=m>=360?4:Math.ceil(m/90),y=d/g,b=y*Math.PI/360,w=4/3*Math.sin(b)/(1+Math.cos(b)),E=[];for(var S=0;S<=g;S++){var x=S<g?f.add(h):t,T=S<g?h.rotate(90).multiply(w):null;S==0?r.setHandleOut(T):E.push(new Segment(x,h.rotate(-90).multiply(w),T)),h=h.rotate(y)}this._add(E)},lineBy:function(t){t=Point.read(arguments);var n=e(this);this.lineTo(n._point.add(t))},curveBy:function(t,n,r){t=Point.read(t),n=Point.read(n);var i=e(this)._point;this.curveTo(i.add(t),i.add(n),r)},arcBy:function(t,n){t=Point.read(t),n=Point.read(n);var r=e(this)._point;this.arcBy(r.add(t),r.add(n))},closePath:function(){this.setClosed(!0)}}},new function(){function e(e,t,n){function c(e){e._transformCoordinates(t,s,!1);for(var r=0;r<2;r++){var i=o[r],c=o[r+4],h=s[r+2],p=s[r];function d(e,t){var s=0;if(e==null){var o=1-t;e=o*o*o*i+3*o*o*t*c+3*o*t*t*h+t*t*t*p,s=n?n[r]:0}var f=e-s,l=e+s;f<u[r]&&(u[r]=f),l>a[r]&&(a[r]=l)}d(p,null);var v=3*(c-h)-i+p,m=2*(i+h)-4*c,g=c-i;if(v==0){if(m==0)continue;var y=-g/m;f<y&&y<l&&d(null,y);continue}var b=m*m-4*v*g;if(b<0)continue;var w=Math.sqrt(b),E=-0.5/v,S=(m-w)*E,x=(m+w)*E;f<S&&S<l&&d(null,S),f<x&&x<l&&d(null,x)}var T=o;o=s,s=T}var r=e._segments,i=r[0];if(!i)return null;var s=new Array(6),o=new Array(6);t&&t.isIdentity()&&(t=null),i._transformCoordinates(t,o,!1);var u=o.slice(0,2),a=u.slice(0),f=Numerical.TOLERANCE,l=1-f;for(var h=1,p=r.length;h<p;h++)c(r[h]);return e._closed&&c(i),Rectangle.create(u[0],u[1],a[0]-u[0],a[1]-u[1])}function t(e,t){if(!t)return[e,e];var n=t.createShiftless(),r=n.transform(new Point(e,0)),i=n.transform(new Point(0,e)),s=r.getAngleInRadians(),o=r.getLength(),u=i.getLength(),a=-Math.atan(u*Math.tan(s)),f=+Math.atan(u/Math.tan(s)),l=o*Math.cos(a)*Math.cos(s)-u*Math.sin(a)*Math.sin(s),c=u*Math.sin(f)*Math.cos(s)+o*Math.cos(f)*Math.sin(s);return[Math.abs(l),Math.abs(c)]}return{getBounds:function(){var t=arguments[0]===undefined;if(t&&this._bounds)return this._bounds;var n=this._createBounds(e(this,arguments[0]));return t&&(this._bounds=n),n},getStrokeBounds:function(){function d(e){h=h.include(r?r.transform(e):e)}function v(e,t){var n=e.getPoint(t),r=e.getNormal(t).normalize(s);d(n.add(r)),d(n.subtract(r))}function m(e,t){if(t==="round"||!e._handleIn.isZero()&&!e._handleOut.isZero())h=h.unite(p.setCenter(r?r.transform(e._point):e._point));else if(t=="bevel"){var n=e.getCurve();v(n,0),v(n.getPrevious(),1)}else if(t=="miter"){var i=e.getCurve(),o=i.getPrevious(),u=i.getPoint(0),a=o.getNormal(1).normalize(s),l=i.getNormal(0).normalize(s),c=new Line(u.subtract(a),new Point(-a.y,a.x)),g=new Line(u.subtract(l),new Point(-l.y,l.x)),y=c.intersect(g);!y||u.getDistance(y)>f?m(e,"bevel"):d(y)}}function g(e,t,n){switch(t){case"round":return m(e,t);case"butt":case"square":var r=e.getCurve(),i=r.getPoint(n),o=r.getNormal(n).normalize(s);t==="square"&&(i=i.add(o.y,-o.x)),d(i.add(o)),d(i.subtract(o))}}if(!this._style._strokeColor||!this._style._strokeWidth)return this.getBounds.apply(this,arguments);var n=arguments[0]===undefined;if(n&&this._strokeBounds)return this._strokeBounds;var r=arguments[0],i=this.getStrokeWidth(),s=i/2,o=t(s,r),u=this.getStrokeJoin(),a=this.getStrokeCap(),f=this.getMiterLimit()*i/2,l=this._segments,c=l.length,h=e(this,r,t(s)),p=new Rectangle((new Size(o)).multiply(2));for(var y=1,b=c-(this._closed?0:1);y<b;y++)m(l[y],u);return this._closed?m(l[0],u):(g(l[0],a,0),g(l[c-1],a,1)),n&&(this._strokeBounds=h),h},getHandleBounds:function(){var e=arguments[0],t=e===undefined;if(t&&this._handleBounds)return this._handleBounds;var n=new Array(6),r=arguments[1]/2||0,i=arguments[2]/2||0,s=!this._closed,o=Infinity,u=-o,a=o,f=u;for(var l=0,c=this._segments.length;l<c;l++){var h=this._segments[l];h._transformCoordinates(e,n,!1);for(var p=0;p<6;p+=2){var d=p==0?i:r,v=n[p],m=n[p+1],g=v-d,y=v+d,b=m-d,w=m+d;g<o&&(o=g),y>u&&(u=y),b<a&&(a=b),w>f&&(f=w)}}var E=Rectangle.create(o,a,u-o,f-a);return t&&(this._handleBounds=E),E},getRoughBounds:function(){var e=arguments[0]===undefined;if(e&&this._roughBounds)return this._roughBounds;var t=this.getHandleBounds(arguments[0],this.strokeWidth,this.getStrokeJoin()=="miter"?this.strokeWidth*this.getMiterLimit():this.strokeWidth);return e&&(this._roughBounds=t),t}}});Path.inject({statics:new function(){var e=2/3*(Math.sqrt(2)-1),t=[new Segment([0,.5],[0,e],[0,-e]),new Segment([.5,0],[-e,0],[e,0]),new Segment([1,.5],[0,-e],[0,e]),new Segment([.5,1],[e,0],[-e,0])];return{Line:function(){var e=Math.floor(arguments.length/2);return new Path(Segment.read(arguments,0,e),Segment.read(arguments,e,e))},Rectangle:function(e){e=Rectangle.read(arguments);var t=e.x,n=e.y;return right=t+e.width,bottom=n+e.height,path=new Path,path._add([new Segment(Point.create(t,bottom)),new Segment(Point.create(t,n)),new Segment(Point.create(right,n)),new Segment(Point.create(right,bottom))]),path._closed=!0,path},RoundRectangle:function(t,n){arguments.length==2?(t=Rectangle.read(arguments,0,1),n=Size.read(arguments,1,1)):arguments.length==6&&(t=Rectangle.read(arguments,0,4),n=Size.read(arguments,4,2)),n=Size.min(n,t.getSize(!0).divide(2));var r=new Path,i=n.multiply(e*2),s=t.getBottomLeft(!0),o=t.getTopLeft(!0),u=t.getTopRight(!0),a=t.getBottomRight(!0);return r._add([new Segment(s.add(n.width,0),null,[-i.width,0]),new Segment(s.subtract(0,n.height),[0,i.height],null),new Segment(o.add(0,n.height),null,[0,-i.height]),new Segment(o.add(n.width,0),[-i.width,0],null),new Segment(u.subtract(n.width,0),null,[i.width,0]),new Segment(u.add(0,n.height),[0,-i.height],null),new Segment(a.subtract(0,n.height),null,[0,i.height]),new Segment(a.subtract(n.width,0),[i.width,0],null)]),r._closed=!0,r},Oval:function(e){e=Rectangle.read(arguments);var n=new Path,r=e.getPoint(!0),i=e.getSize(!0),s=new Array(4);for(var o=0;o<4;o++){var u=t[o];s[o]=new Segment(u._point.multiply(i).add(r),u._handleIn.multiply(i),u._handleOut.multiply(i))}return n._add(s),n._closed=!0,n},Circle:function(e,t){return arguments.length==3?(e=Point.read(arguments,0,2),t=arguments[2]):e=Point.read(arguments,0,1),Path.Oval(new Rectangle(e.subtract(t),Size.create(t*2,t*2)))},Arc:function(e,t,n){var r=new Path;return r.moveTo(e),r.arcTo(t,n),r},RegularPolygon:function(e,t,n){e=Point.read(arguments,0,1);var r=new Path,i=360/t,s=!(t%3),o=new Point(0,s?-n:n),u=s?-1:.5,a=new Array(t);for(var f=0;f<t;f++)a[f]=new Segment(e.add(o.rotate((f+u)*i)));return r._add(a),r._closed=!0,r},Star:function(e,t,n,r){e=Point.read(arguments,0,1),t*=2;var i=new Path,s=360/t,o=new Point(0,-1),u=new Array(t);for(var a=0;a<t;a++)u[a]=new Segment(e.add(o.rotate(s*a).multiply(a%2?r:n)));return i._add(u),i._closed=!0,i}}}});var CompoundPath=this.CompoundPath=PathItem.extend({initialize:function(e){this.base(),this._children=[],this._namedChildren={};var t=!e||!Array.isArray(e)||typeof e[0]!="object"?arguments:e;this.addChildren(t)},insertChild:function(e,t){this.base(e,t),t._clockwise===undefined&&t.setClockwise(t._index==0)},simplify:function(){if(this._children.length==1){var e=this._children[0];return e.insertAbove(this),this.remove(),e}return this},smooth:function(){for(var e=0,t=this._children.length;e<t;e++)this._children[e].smooth()},draw:function(e,t){var n=this._children.length;if(n==0)return;var r=this._children[0];e.beginPath(),t.compound=!0;for(var i=0;i<n;i++)Item.draw(this._children[i],e,t);r._setStyles(e);var s=r.getFillColor(),o=r.getStrokeColor();s&&(e.fillStyle=s.getCanvasStyle(e),e.fill()),o&&(e.strokeStyle=o.getCanvasStyle(e),e.stroke()),t.compound=!1}},new function(){function e(e){if(!e._children.length)throw new Error("Use a moveTo() command first");return e._children[e._children.length-1]}var t={moveTo:function(e){var t=new Path;this.addChild(t),t.moveTo.apply(t,arguments)},moveBy:function(t){this.moveTo(e(this).getLastSegment()._point.add(Point.read(arguments)))},closePath:function(){e(this).setClosed(!0)}};return Base.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","curveBy","arcBy"],function(n){t[n]=function(){var t=e(this);t[n].apply(t,arguments)}}),t}),PathFlattener=Base.extend({initialize:function(e){function s(e,t){var n=Curve.getValues(e,t);i.curves.push(n),i._computeParts(n,e._index,0,1)}this.curves=[],this.parts=[],this.length=0,this.index=0;var t=e._segments,n=t[0],r,i=this;for(var o=1,u=t.length;o<u;o++)r=t[o],s(n,r),n=r;e._closed&&s(r,t[0])},_computeParts:function(e,t,n,r){if(r-n>1/32&&!Curve.isFlatEnough(e)){var i=Curve.subdivide(e),s=(n+r)/2;this._computeParts(i[0],t,n,s),this._computeParts(i[1],t,s,r)}else{var o=e[6]-e[0],u=e[7]-e[1],a=Math.sqrt(o*o+u*u);a>Numerical.TOLERANCE&&(this.length+=a,this.parts.push({offset:this.length,value:r,index:t}))}},getParameterAt:function(e){var t,n=this.index;for(;;){t=n;if(n==0||this.parts[--n].offset<e)break}for(var r=this.parts.length;t<r;t++){var i=this.parts[t];if(i.offset>=e){this.index=t;var s=this.parts[t-1],o=s&&s.index==i.index?s.value:0,u=s?s.offset:0;return{value:o+(i.value-o)*(e-u)/(i.offset-u),index:i.index}}}var i=this.parts[this.parts.length-1];return{value:1,index:i.index}},evaluate:function(e,t){var n=this.getParameterAt(e);return Curve.evaluate(this.curves[n.index],n.value,t)},drawPart:function(e,t,n){t=this.getParameterAt(t),n=this.getParameterAt(n);for(var r=t.index;r<=n.index;r++){var i=Curve.getPart(this.curves[r],r==t.index?t.value:0,r==n.index?n.value:1);r==t.index&&e.moveTo(i[0],i[1]),e.bezierCurveTo.apply(e,i.slice(2))}}}),PathFitter=Base.extend({initialize:function(e,t){this.points=[];var n=e._segments,r;for(var i=0,s=n.length;i<s;i++){var o=n[i].point.clone();if(!r||!r.equals(o))this.points.push(o),r=o}this.error=t},fit:function(){return this.segments=[new Segment(this.points[0])],this.fitCubic(0,this.points.length-1,this.points[1].subtract(this.points[0]).normalize(),this.points[this.points.length-2].subtract(this.points[this.points.length-1]).normalize()),this.segments},fitCubic:function(e,t,n,r){if(t-e==1){var i=this.points[e],s=this.points[t],o=i.getDistance(s)/3;this.addCurve([i,i.add(n.normalize(o)),s.add(r.normalize(o)),s]);return}var u=this.chordLengthParameterize(e,t),a=Math.max(this.error,this.error*this.error),f,l;for(var c=0;c<=4;c++){var h=this.generateBezier(e,t,u,n,r),p=this.findMaxError(e,t,h,u);if(p.error<this.error){this.addCurve(h);return}l=p.index;if(p.error>=a)break;this.reparameterize(e,t,u,h),a=p.error}var d=this.points[l-1].subtract(this.points[l]),v=this.points[l].subtract(this.points[l+1]),m=d.add(v).divide(2).normalize();this.fitCubic(e,l,n,m),this.fitCubic(l,t,m.negate(),r)},addCurve:function(e){var t=this.segments[this.segments.length-1];t.setHandleOut(e[1].subtract(e[0])),this.segments.push(new Segment(e[3],e[2].subtract(e[3])))},generateBezier:function(e,t,n,r,i){var s=Numerical.EPSILON,o=this.points[e],u=this.points[t],a=[[0,0],[0,0]],f=[0,0];for(var l=0,c=t-e+1;l<c;l++){var h=n[l],p=1-h,d=3*h*p,v=p*p*p,m=d*p,g=d*h,y=h*h*h,b=r.normalize(m),w=i.normalize(g),E=this.points[e+l].subtract(o.multiply(v+m)).subtract(u.multiply(g+y));a[0][0]+=b.dot(b),a[0][1]+=b.dot(w),a[1][0]=a[0][1],a[1][1]+=w.dot(w),f[0]+=b.dot(E),f[1]+=w.dot(E)}var S=a[0][0]*a[1][1]-a[1][0]*a[0][1],x,T;if(Math.abs(S)>s){var N=a[0][0]*f[1]-a[1][0]*f[0],C=f[0]*a[1][1]-f[1]*a[0][1];x=C/S,T=N/S}else{var k=a[0][0]+a[0][1],L=a[1][0]+a[1][1];Math.abs(k)>s?x=T=f[0]/k:Math.abs(k)>s?x=T=f[1]/L:x=T=0}var A=u.getDistance(o);s*=A;if(x<s||T<s)x=T=A/3;return[o,o.add(r.normalize(x)),u.add(i.normalize(T)),u]},reparameterize:function(e,t,n,r){for(var i=e;i<=t;i++)n[i-e]=this.findRoot(r,this.points[i],n[i-e])},findRoot:function(e,t,n){var r=[],i=[];for(var s=0;s<=2;s++)r[s]=e[s+1].subtract(e[s]).multiply(3);for(var s=0;s<=1;s++)i[s]=r[s+1].subtract(r[s]).multiply(2);var o=this.evaluate(3,e,n),u=this.evaluate(2,r,n),a=this.evaluate(1,i,n),f=o.subtract(t),l=u.dot(u)+f.dot(a);return Math.abs(l)<Numerical.TOLERANCE?n:n-f.dot(u)/l},evaluate:function(e,t,n){var r=t.slice();for(var i=1;i<=e;i++)for(var s=0;s<=e-i;s++)r[s]=r[s].multiply(1-n).add(r[s+1].multiply(n));return r[0]},chordLengthParameterize:function(e,t){var n=[0];for(var r=e+1;r<=t;r++)n[r-e]=n[r-e-1]+this.points[r].getDistance(this.points[r-1]);for(var r=1,i=t-e;r<=i;r++)n[r]/=n[i];return n},findMaxError:function(e,t,n,r){var i=Math.floor((t-e+1)/2),s=0;for(var o=e+1;o<t;o++){var u=this.evaluate(3,n,r[o-e]),a=u.subtract(this.points[o]),f=a.x*a.x+a.y*a.y;f>=s&&(s=f,i=o)}return{error:s,index:i}}}),TextItem=this.TextItem=Item.extend({initialize:function(){this.base(),this._content="",this._characterStyle=CharacterStyle.create(this),this.setCharacterStyle(this._project.getCurrentStyle()),this._paragraphStyle=ParagraphStyle.create(this),this.setParagraphStyle()},_clone:function(e){return e._content=this._content,e.setCharacterStyle(this._characterStyle),e.setParagraphStyle(this._paragraphStyle),this.base(e)},getContent:function(){return this._content},setContent:function(e){this._changed(Change.CONTENT),this._content=""+e},getCharacterStyle:function(){return this._characterStyle},setCharacterStyle:function(e){this._characterStyle.initialize(e)},getParagraphStyle:function(){return this._paragraphStyle},setParagraphStyle:function(e){this._paragraphStyle.initialize(e)}}),PointText=this.PointText=TextItem.extend({initialize:function(e){this.base(),this._point=Point.read(arguments).clone(),this._matrix=(new Matrix).translate(this._point)},clone:function(){var e=this._clone(new PointText(this._point));return e._matrix.initialize(this._matrix),e},getPoint:function(){return LinkedPoint.create(this,"setPoint",this._point.x,this._point.y)},setPoint:function(e){this.translate(Point.read(arguments).subtract(this._point))},getPosition:function(){return this.getPoint()},setPosition:function(e){this.setPoint.apply(this,arguments)},_transform:function(e,t){this._matrix.preConcatenate(e),e._transformPoint(this._point,this._point)},draw:function(e){if(!this._content)return;e.save(),e.font=this.getFontSize()+"pt "+this.getFont(),e.textAlign=this.getJustification(),this._matrix.applyToContext(e);var t=this.getFillColor(),n=this.getStrokeColor();if(!t||!n)e.globalAlpha=this._opacity;t&&(e.fillStyle=t.getCanvasStyle(e),e.fillText(this._content,0,0)),n&&(e.strokeStyle=n.getCanvasStyle(e),e.strokeText(this._content,0,0)),e.restore()}}),Style=Item.extend({initialize:function(e){var t=e instanceof Style;return Base.each(this._defaults,function(n,r){n=e&&e[r]||n,this[r]=n&&t&&n.clone?n.clone():n},this)},statics:{create:function(e){var t=new this(this.dont);return t._item=e,t},extend:function(e){var t=e._style,n=e._flags||{};return e._owner.inject(Base.each(e._defaults,function(r,i){var s=!!i.match(/Color$/),o=Base.capitalize(i),u="set"+o,a="get"+o;e[u]=function(e){var r=this._item&&this._item._children;e=s?Color.read(arguments):e;if(r)for(var o=0,a=r.length;o<a;o++)r[o][t][u](e);else{var f=this["_"+i];f!=e&&!(f&&f.equals&&f.equals(e))&&(this["_"+i]=e,s&&(f&&f._removeOwner(this._item),e&&e._addOwner(this._item)),this._item&&this._item._changed(n[i]||Change.STYLE))}return this},e[a]=function(){var e=this._item&&this._item._children,n;if(!e)return this["_"+i];for(var r=0,s=e.length;r<s;r++){var o=e[r][t][a]();if(!n)n=o;else if(n!=o&&!(n&&n.equals&&n.equals(o)))return undefined}return n},this[u]=function(e){return this[t][u](e),this},this[a]=function(){return this[t][a]()}},{})),this.base(e)}}}),PathStyle=this.PathStyle=Style.extend({_defaults:{fillColor:undefined,strokeColor:undefined,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[]},_flags:{strokeWidth:Change.STROKE,strokeCap:Change.STROKE,strokeJoin:Change.STROKE,miterLimit:Change.STROKE},_owner:Item,_style:"_style"}),ParagraphStyle=this.ParagraphStyle=Style.extend({_defaults:{justification:"left"},_owner:TextItem,_style:"_paragraphStyle"}),CharacterStyle=this.CharacterStyle=PathStyle.extend({_defaults:Base.merge(PathStyle.prototype._defaults,{fillColor:"black",fontSize:10,font:"sans-serif"}),_owner:TextItem,_style:"_characterStyle"}),Color=this.Color=Base.extend(new function(){function r(e){var r=t[e];if(r)return r.clone();if(!n){var i=CanvasProvider.getCanvas(Size.create(1,1));n=i.getContext("2d"),n.globalCompositeOperation="copy"}n.fillStyle="rgba(0,0,0,0)",n.fillStyle=e,n.fillRect(0,0,1,1);var s=n.getImageData(0,0,1,1).data,o=[s[0]/255,s[1]/255,s[2]/255];return(t[e]=RgbColor.read(o)).clone()}function i(e){var t=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);if(t.length>=4){var n=new Array(3);for(var r=0;r<3;r++){var i=t[r+1];n[r]=parseInt(i.length==1?i+i:i,16)/255}return RgbColor.read(n)}}var e={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"]},t={},n,s=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],o={"rgb-hsb":function(e){var t=e._red,n=e._green,r=e._blue,i=Math.max(t,n,r),s=Math.min(t,n,r),o=i-s,u=o==0?0:(i==t?(n-r)/o+(n<r?6:0):i==n?(r-t)/o+2:(t-n)/o+4)*60,a=i==0?0:o/i,f=i;return new HsbColor(u,a,f,e._alpha)},"hsb-rgb":function(e){var t=e._hue/60%6,n=e._saturation,r=e._brightness,i=Math.floor(t),o=t-i,i=s[i],u=[r,r*(1-n),r*(1-n*o),r*(1-n*(1-o))];return new RgbColor(u[i[0]],u[i[1]],u[i[2]],e._alpha)},"rgb-hsl":function(e){var t=e._red,n=e._green,r=e._blue,i=Math.max(t,n,r),s=Math.min(t,n,r),o=i-s,u=o==0,a=u?0:(i==t?(n-r)/o+(n<r?6:0):i==n?(r-t)/o+2:(t-n)/o+4)*60,f=(i+s)/2,l=u?0:f<.5?o/(i+s):o/(2-i-s);return new HslColor(a,l,f,e._alpha)},"hsl-rgb":function(e){var t=e._saturation,n=e._hue/360,r=e._lightness,i,s,o;if(t==0)return new RgbColor(r,r,r,e._alpha);var u=[n+1/3,n,n-1/3],s=r<.5?r*(1+t):r+t-r*t,i=2*r-s,o=[];for(var a=0;a<3;a++){var f=u[a];f<0&&(f+=1),f>1&&(f-=1),o[a]=6*f<1?i+(s-i)*6*f:2*f<1?s:3*f<2?i+(s-i)*(2/3-f)*6:i}return new RgbColor(o[0],o[1],o[2],e._alpha)},"rgb-gray":function(e){return new GrayColor(1-(e._red*.2989+e._green*.587+e._blue*.114),e._alpha)},"gray-rgb":function(e){var t=1-e._gray;return new RgbColor(t,t,t,e._alpha)},"gray-hsb":function(e){return new HsbColor(0,0,1-e._gray,e._alpha)},"gray-hsl":function(e){return new HslColor(0,0,1-e._gray,e._alpha)}},u={_readNull:!0,initialize:function(e){var t=Array.isArray(e),n=this._colorType;if(typeof e=="object"&&!t)return n?Color.read(arguments).convert(n):e.red!==undefined?new RgbColor(e.red,e.green,e.blue,e.alpha):e.gray!==undefined?new GrayColor(e.gray,e.alpha):e.lightness!==undefined?new HslColor(e.hue,e.saturation,e.lightness,e.alpha):e.hue!==undefined?new HsbColor(e.hue,e.saturation,e.brightness,e.alpha):new RgbColor;if(typeof e=="string"){var s=e.match(/^#[0-9a-f]{3,6}$/i)?i(e):r(e);return n?s.convert(n):s}var o=t?e:Array.prototype.slice.call(arguments);if(!n)return o.length>=3?new RgbColor(o):new GrayColor(o);Base.each(this._components,function(e,t){var n=o[t];this["_"+e]=n!==undefined?n:null},this)},clone:function(){var e=this.constructor,t=new e(e.dont),n=this._components;for(var r=0,i=n.length;r<i;r++){var s="_"+n[r];t[s]=this[s]}return t},convert:function(e){var t;return this._colorType==e?this.clone():(t=o[this._colorType+"-"+e])?t(this):o["rgb-"+e](o[this._colorType+"-rgb"](this))},statics:{extend:function(t){t.beans=!0;if(t._colorType){var n=e[t._colorType];t._components=n.concat(["alpha"]),Base.each(n,function(e){var t=e==="hue",n=Base.capitalize(e),e="_"+e;this["get"+n]=function(){return this[e]},this["set"+n]=function(n){return this[e]=t?(n%360+360)%360:Math.min(Math.max(n,0),1),this._changed(),this}},t)}return this.base(t)}}};return Base.each(e,function(e,t){Base.each(e,function(e){var n=Base.capitalize(e);u["get"+n]=function(){return this.convert(t)[e]},u["set"+n]=function(n){var r=this.convert(t);r[e]=n,r=r.convert(this._colorType);for(var i=0,s=this._components.length;i<s;i++){var o=this._components[i];this[o]=r[o]}}})}),u},{_changed:function(){this._cssString=null;for(var e=0,t=this._owners&&this._owners.length;e<t;e++)this._owners[e]._changed(Change.STYLE)},_addOwner:function(e){this._owners||(this._owners=[]),this._owners.push(e)},_removeOwner:function(e){var t=this._owners?this._owners.indexOf(e):-1;t!=-1&&(this._owners.splice(t,1),this._owners.length==0&&delete this._owners)},getType:function(){return this._colorType},getComponents:function(){var e=this._components.length,t=new Array(e);for(var n=0;n<e;n++)t[n]=this["_"+this._components[n]];return t},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(e){return this._alpha=e==null?null:Math.min(Math.max(e,0),1),this._changed(),this},hasAlpha:function(){return this._alpha!=null},equals:function(e){if(e&&e._colorType===this._colorType){for(var t=0,n=this._components.length;t<n;t++){var r="_"+this._components[t];if(this[r]!==e[r])return!1}return!0}return!1},toString:function(){var e=[],t=Base.formatNumber;for(var n=0,r=this._components.length;n<r;n++){var i=this._components[n],s=this["_"+i];i==="alpha"&&s==null&&(s=1),e.push(i+": "+t(s))}return"{ "+e.join(", ")+" }"},toCssString:function(){if(!this._cssString){var e=this.convert("rgb"),t=e.getAlpha(),n=[Math.round(e._red*255),Math.round(e._green*255),Math.round(e._blue*255),t!=null?t:1];this._cssString="rgba("+n.join(", ")+")"}return this._cssString},getCanvasStyle:function(){return this.toCssString()}}),GrayColor=this.GrayColor=Color.extend({_colorType:"gray"}),RgbColor=this.RgbColor=this.RGBColor=Color.extend({_colorType:"rgb"}),HsbColor=this.HsbColor=this.HSBColor=Color.extend({_colorType:"hsb"}),HslColor=this.HslColor=this.HSLColor=Color.extend({_colorType:"hsl"}),GradientColor=this.GradientColor=Color.extend({initialize:function(e,t,n,r){this.gradient=e||new Gradient,this.setOrigin(t),this.setDestination(n),r&&this.setHilite(r)},clone:function(){return new GradientColor(this.gradient,this._origin,this._destination,this._hilite)},getOrigin:function(){return this._origin},setOrigin:function(e){return e=Point.read(arguments).clone(),this._origin=e,this._destination&&(this._radius=this._destination.getDistance(this._origin)),this._changed(),this},getDestination:function(){return this._destination},setDestination:function(e){return e=Point.read(arguments).clone(),this._destination=e,this._radius=this._destination.getDistance(this._origin),this._changed(),this},getHilite:function(){return this._hilite},setHilite:function(e){e=Point.read(arguments).clone();var t=e.subtract(this._origin);return t.getLength()>this._radius?this._hilite=this._origin.add(t.normalize(this._radius-.1)):this._hilite=e,this._changed(),this},getCanvasStyle:function(e){var t;if(this.gradient.type==="linear")t=e.createLinearGradient(this._origin.x,this._origin.y,this._destination.x,this._destination.y);else{var n=this._hilite||this._origin;t=e.createRadialGradient(n.x,n.y,0,this._origin.x,this._origin.y,this._radius)}for(var r=0,i=this.gradient._stops.length;r<i;r++){var s=this.gradient._stops[r];t.addColorStop(s._rampPoint,s._color.toCssString())}return t},equals:function(e){return e==this||e&&e._colorType===this._colorType&&this.gradient.equals(e.gradient)&&this._origin.equals(e._origin)&&this._destination.equals(e._destination)},transform:function(e){e._transformPoint(this._origin,this._origin,!0),e._transformPoint(this._destination,this._destination,!0),this._hilite&&e._transformPoint(this._hilite,this._hilite,!0),this._radius=this._destination.getDistance(this._origin)}}),Gradient=this.Gradient=Base.extend({initialize:function(e,t){this.setStops(e||["white","black"]),this.type=t||"linear"},clone:function(){var e=[];for(var t=0,n=this._stops.length;t<n;t++)e[t]=this._stops[t].clone();return new Gradient(e,this.type)},getStops:function(){return this._stops},setStops:function(e){if(e.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");this._stops=GradientStop.readAll(e);for(var t=0,n=this._stops.length;t<n;t++){var r=this._stops[t];r._defaultRamp&&r.setRampPoint(t/(n-1))}},equals:function(e){if(e.type!=this.type)return!1;if(this._stops.length==e._stops.length){for(var t=0,n=this._stops.length;t<n;t++)if(!this._stops[t].equals(e._stops[t]))return!1;return!0}return!1}}),GradientStop=this.GradientStop=Base.extend({initialize:function(e,t){t===undefined&&Array.isArray(e)?(this.setColor(e[0]),this.setRampPoint(e[1])):e.color?(this.setColor(e.color),this.setRampPoint(e.rampPoint)):(this.setColor(e),this.setRampPoint(t))},clone:function(){return new GradientStop(this._color.clone(),this._rampPoint)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(e){this._defaultRamp=e==null,this._rampPoint=e||0},getColor:function(){return this._color},setColor:function(e){this._color=Color.read(arguments)},equals:function(e){return e==this||e instanceof GradientStop&&this._color.equals(e._color)&&this._rampPoint==e._rampPoint}}),DomElement={getBounds:function(e,t){var n=e.getBoundingClientRect(),r=e.ownerDocument,i=r.body,s=r.documentElement,o=n.left-(s.clientLeft||i.clientLeft||0),u=n.top-(s.clientTop||i.clientTop||0);if(!t){var a=DomElement.getViewport(r);o+=a.pageXOffset||s.scrollLeft||i.scrollLeft,u+=a.pageYOffset||s.scrollTop||i.scrollTop}return new Rectangle(o,u,n.width,n.height)},getOffset:function(e,t){return this.getBounds(e,t).getPoint()},getSize:function(e){return this.getBounds(e,!0).getSize()},isInvisible:function(e){return this.getSize(e).equals([0,0])},isVisible:function(e){return!this.isInvisible(e)&&this.getViewportBounds(e).intersects(this.getBounds(e,!0))},getViewport:function(e){return e.defaultView||e.parentWindow},getViewportBounds:function(e){var t=e.ownerDocument,n=this.getViewport(t),r=t.getElementsByTagName(t.compatMode==="CSS1Compat"?"html":"body")[0];return Rectangle.create(0,0,n.innerWidth||r.clientWidth,n.innerHeight||r.clientHeight)},getComputedStyle:function(e,t){if(e.currentStyle)return e.currentStyle[Base.camelize(t)];var n=this.getViewport(e.ownerDocument).getComputedStyle(e,null);return n?n.getPropertyValue(Base.hyphenate(t)):null}},DomEvent={add:function(e,t){for(var n in t){var r=t[n];e.addEventListener?e.addEventListener(n,r,!1):e.attachEvent&&e.attachEvent("on"+n,r.bound=function(){r.call(e,window.event)})}},remove:function(e,t){for(var n in t){var r=t[n];e.removeEventListener?e.removeEventListener(n,r,!1):e.detachEvent&&e.detachEvent("on"+n,r.bound)}},getPoint:function(e){var t=e.targetTouches?e.targetTouches.length?e.targetTouches[0]:e.changedTouches[0]:e;return Point.create(t.pageX||t.clientX+document.documentElement.scrollLeft,t.pageY||t.clientY+document.documentElement.scrollTop)},getTarget:function(e){return e.target||e.srcElement},getOffset:function(e,t){return DomEvent.getPoint(e).subtract(DomElement.getOffset(t||DomEvent.getTarget(e)))},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},stop:function(e){DomEvent.stopPropagation(e),DomEvent.preventDefault(e)}};DomEvent.requestAnimationFrame=new function(){var e="equestAnimationFrame",t=window["r"+e]||window["webkitR"+e]||window["mozR"+e]||window["oR"+e]||window["msR"+e];t&&t(function(e){e==undefined&&(t=null)});var n=[],r=!0,i;return DomEvent.add(window,{focus:function(){r=!0},blur:function(){r=!1}}),function(e,s){if(t)return t(e,s);n.push([e,s]);if(i)return;i=window.setInterval(function(){for(var e=n.length-1;e>=0;e--){var t=n[e],i=t[0],s=t[1];if(!s||(PaperScript.getAttribute(s,"keepalive")=="true"||r)&&DomElement.isVisible(s))n.splice(e,1),i(Date.now())}},1e3/60)}};var View=this.View=PaperScopeItem.extend({_list:"views",_reference:"view",initialize:function(e){this.base();var t;typeof e=="string"&&(e=document.getElementById(e));if(e instanceof HTMLCanvasElement){this._canvas=e;if(PaperScript.hasAttribute(e,"resize")){var n=DomElement.getOffset(e,!0),r=this;t=DomElement.getViewportBounds(e).getSize().subtract(n),e.width=t.width,e.height=t.height,DomEvent.add(window,{resize:function(t){DomElement.isInvisible(e)||(n=DomElement.getOffset(e,!0)),r.setViewSize(DomElement.getViewportBounds(e).getSize().subtract(n))}})}else t=DomElement.isInvisible(e)?Size.create(parseInt(e.getAttribute("width")),parseInt(e.getAttribute("height"))):DomElement.getSize(e);if(PaperScript.hasAttribute(e,"stats")){this._stats=new Stats;var i=this._stats.domElement,s=i.style,n=DomElement.getOffset(e);s.position="absolute",s.left=n.x+"px",s.top=n.y+"px",document.body.appendChild(i)}}else t=Size.read(arguments,1),t.isZero()&&(t=new Size(1024,768)),this._canvas=CanvasProvider.getCanvas(t);this._id=this._canvas.getAttribute("id"),this._id==null&&this._canvas.setAttribute("id",this._id="canvas-"+View._id++),View._views[this._id]=this,this._viewSize=LinkedSize.create(this,"setViewSize",t.width,t.height),this._context=this._canvas.getContext("2d"),this._matrix=new Matrix,this._zoom=1,this._events=this._createEvents(),DomEvent.add(this._canvas,this._events),View._focused||(View._focused=this),this._scope._redrawNotified=!1},remove:function(){return this.base()?(View._focused==this&&(View._focused=null),delete View._views[this._id],DomEvent.remove(this._canvas,this._events),this._canvas=this._events=this._onFrame=null,!0):!1},_redraw:function(){this._redrawNeeded=!0,this._onFrameCallback?this._onFrameCallback(0,!0):this.draw()},_transform:function(e,t){this._matrix.preConcatenate(e),this._bounds=null,this._inverse=null,this._redraw()},getCanvas:function(){return this._canvas},getViewSize:function(){return this._viewSize},setViewSize:function(e){e=Size.read(arguments);var t=e.subtract(this._viewSize);if(t.isZero())return;this._canvas.width=e.width,this._canvas.height=e.height,this._viewSize.set(e.width,e.height,!0),this._bounds=null,this._redrawNeeded=!0,this.onResize&&this.onResize({size:e,delta:t}),this._redraw()},getBounds:function(){return this._bounds||(this._bounds=this._getInverse()._transformBounds(new Rectangle(new Point,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(e){this.scrollBy(Point.read(arguments).subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(e){this._transform((new Matrix).scale(e/this._zoom,this.getCenter())),this._zoom=e},isVisible:function(){return DomElement.isVisible(this._canvas)},scrollBy:function(e){this._transform((new Matrix).translate(Point.read(arguments).negate()))},draw:function(e){if(e&&!this._redrawNeeded)return!1;this._stats&&this._stats.update();var t=this._context,n=this._viewSize;return t.clearRect(0,0,n._width+1,n._height+1),t.save(),this._matrix.applyToContext(t),this._scope.project.draw(t),t.restore(),this._redrawNeeded&&(this._redrawNeeded=!1,this._scope._redrawNotified=!1),!0},projectToView:function(e){return this._matrix._transformPoint(Point.read(arguments))},viewToProject:function(e){return this._getInverse()._transformPoint(Point.read(arguments))},_getInverse:function(){return this._inverse||(this._inverse=this._matrix.createInverse()),this._inverse},getOnFrame:function(){return this._onFrame},setOnFrame:function(e){this._onFrame=e;if(!e){delete this._onFrameCallback;return}var t=this,n=!1,r,i=0,s=0;this._onFrameCallback=function(e,o){n=!1;if(!t._onFrame)return;paper=t._scope,n=!0,o||DomEvent.requestAnimationFrame(t._onFrameCallback,t._canvas);var u=Date.now()/1e3,a=r?u-r:0;t._onFrame(Base.merge({delta:a,time:i+=a,count:s++})),r=u,t.draw(!0)},n||this._onFrameCallback()},onResize:null},{statics:{_views:{},_id:0}},new function(){function s(e,t){return e.viewToProject(DomEvent.getOffset(t,e._canvas))}function o(){(!View._focused||!View._focused.isVisible())&&PaperScope.each(function(e){for(var t=0,n=e.views.length;t<n;t++){var i=e.views[t];if(i.isVisible())throw View._focused=r=i,Base.stop}})}function u(t){var u;i||(u=View._views[DomEvent.getTarget(t).getAttribute("id")],u?View._focused=r=u:r&&r==View._focused&&(View._focused=null,o()));if(!(u=u||View._focused)||!(e=u._scope.tool))return;var a=t&&s(u,t),f=!e.onMouseDrag&&!!e.onMouseMove;i&&!f?(n=a||n,n&&e.onHandleEvent("mousedrag",n,t)&&(u.draw(!0),DomEvent.stop(t))):(!i||f)&&e.onHandleEvent("mousemove",a,t)&&(u.draw(!0),DomEvent.stop(t))}function a(r){var o=View._focused;if(!o||!i)return;i=!1,n=null,e&&(t!=null&&(t=clearInterval(t)),e.onHandleEvent("mouseup",s(o,r),r)&&(o.draw(!0),DomEvent.stop(r)))}function f(e){i&&DomEvent.stop(e)}var e,t,n,r,i=!1;return DomEvent.add(document,{mousemove:u,mouseup:a,touchmove:u,touchend:a,selectstart:f,scroll:o}),DomEvent.add(window,{load:o}),{_createEvents:function(){function o(o){View._focused=r;if(!(e=r._scope.tool))return;n=s(r,o),e.onHandleEvent("mousedown",n,o)&&r.draw(!0),e.eventInterval!=null&&(t=setInterval(u,e.eventInterval)),i=!0}var r=this;return{mousedown:o,touchstart:o,selectstart:f}},statics:{updateFocus:o}}}),Event=this.Event=Base.extend({initialize:function(e){this.event=e},preventDefault:function(){DomEvent.preventDefault(this.event)},stopPropagation:function(){DomEvent.stopPropagation(this.event)},stop:function(){DomEvent.stop(this.event)},getModifiers:function(){return Key.modifiers}}),KeyEvent=this.KeyEvent=Event.extend(new function(){return{initialize:function(e,t,n,r){this.base(r),this.type=e?"keydown":"keyup",this.key=t,this.character=n},toString:function(){return"{ type: "+this.type+", key: "+this.key+", character: "+this.character+", modifiers: "+this.getModifiers()+" }"}}}),Key=this.Key=new function(){function s(t,n,i,s){var o=String.fromCharCode(i),u=e[n]||o.toLowerCase(),a=t?"onKeyDown":"onKeyUp",f=View._focused,l=f&&f.isVisible()&&f._scope,c=l&&l.tool;r[u]=t;if(c&&c[a]){var h=new KeyEvent(t,u,o,s);c[a](h)===!1&&h.preventDefault(),f&&f.draw(!0)}}var e={8:"backspace",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},t=Base.merge({shift:!1,control:!1,option:!1,command:!1,capsLock:!1}),n={},r={},i;return DomEvent.add(document,{keydown:function(r){var o=r.which||r.keyCode,u=e[o],a;u?((a=Base.camelize(u))in t&&(t[a]=!0),n[o]=0,s(!0,o,null,r)):i=o},keypress:function(e){if(i!=null){var t=e.which||e.keyCode;n[i]=t,s(!0,i,t,e),i=null}},keyup:function(r){var i=r.which||r.keyCode,o=e[i],u;o&&(u=Base.camelize(o))in t&&(t[u]=!1),n[i]!=null&&(s(!1,i,n[i],r),delete n[i])}}),{modifiers:t,isDown:function(e){return!!r[e]}}},ToolEvent=this.ToolEvent=Event.extend({initialize:function(e,t,n){this.tool=e,this.type=t,this.event=n},_choosePoint:function(e,t){return e?e:t?t.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(e){this._point=e},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(e){this._lastPoint=e},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(e){this._downPoint=e},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this.middlePoint},setMiddlePoint:function(e){this._middlePoint=e},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(e){this._delta=e},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(e){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=e},getItem:function(){if(!this._item){var e=this.tool._scope.project.hitTest(this.getPoint());if(e){var t=e.item,n=t._parent;while(n instanceof Group&&!(n instanceof Layer)||n instanceof CompoundPath)t=n,n=n._parent;this._item=t}}return this._item},setItem:function(e){this._item=e},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Tool=this.Tool=PaperScopeItem.extend({_list:"tools",_reference:"tool",initialize:function(){this.base(),this._firstMove=!0,this._count=0,this._downCount=0},eventInterval:null,getMinDistance:function(){return this._minDistance},setMinDistance:function(e){this._minDistance=e,this._minDistance!=null&&this._maxDistance!=null&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(e){this._maxDistance=e,this._minDistance!=null&&this._maxDistance!=null&&this._maxDistance<this._minDistance&&(this._minDistance=e)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(e){this._minDistance=e,this._maxDistance=e},updateEvent:function(e,t,n,r,i,s,o){if(!i){if(n!=null||r!=null){var u=n!=null?n:0,a=t.subtract(this._point),f=a.getLength();if(f<u)return!1;var l=r!=null?r:0;if(l!=0)if(f>l)t=this._point.add(a.normalize(l));else if(o)return!1}if(s&&t.equals(this._point))return!1}this._lastPoint=i&&e=="mousemove"?t:this._point,this._point=t;switch(e){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=i?0:this._count+1,!0},onHandleEvent:function(e,t,n){paper=this._scope;var r=!1;switch(e){case"mousedown":this.updateEvent(e,t,null,null,!0,!1,!1),this.onMouseDown&&(this.onMouseDown(new ToolEvent(this,e,n)),r=!0);break;case"mousedrag":var i=!1,s=!1;while(this.updateEvent(e,t,this.minDistance,this.maxDistance,!1,i,s))this.onMouseDrag&&(this.onMouseDrag(new ToolEvent(this,e,n)),r=!0),i=!0,s=!0;break;case"mouseup":(this._point.x!=t.x||this._point.y!=t.y)&&this.updateEvent("mousedrag",t,this.minDistance,this.maxDistance,!1,!1,!1)&&this.onMouseDrag&&(this.onMouseDrag(new ToolEvent(this,e,n)),r=!0),this.updateEvent(e,t,null,this.maxDistance,!1,!1,!1),this.onMouseUp&&(this.onMouseUp(new ToolEvent(this,e,n)),r=!0),this.updateEvent(e,t,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":while(this.updateEvent(e,t,this.minDistance,this.maxDistance,this._firstMove,!0,!1))this.onMouseMove&&(this.onMouseMove(new ToolEvent(this,e,n)),r=!0),this._firstMove=!1}return r}}),CanvasProvider={canvases:[],getCanvas:function(e){if(this.canvases.length){var t=this.canvases.pop();return t.width!=e.width||t.height!=e.height?(t.width=e.width,t.height=e.height):t.getContext("2d").clearRect(0,0,e.width+1,e.height+1),t}var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t},returnCanvas:function(e){this.canvases.push(e)}},Numerical=new function(){var e=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],t=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],n=Math.abs,r=Math.sqrt,i=Math.cos,s=Math.PI;return{TOLERANCE:1e-5,EPSILON:1e-11,integrate:function(n,r,i,s){var o=e[s-2],u=t[s-2],a=.5*(i-r),f=a+r,l=0,c=s+1>>1,h=s&1?u[l++]*n(f):0;while(l<c){var p=a*o[l];h+=u[l++]*(n(f+p)+n(f-p))}return a*h},findRoot:function(e,t,r,i,s,o,u){for(var a=0;a<o;a++){var f=e(r),l=f/t(r);if(n(l)<u)return r;var c=r-l;f>0?(s=r,r=c<=i?.5*(i+s):c):(i=r,r=c>=s?.5*(i+s):c)}},solveQuadratic:function(e,t,i,s,o){if(n(e)<o)return n(t)>=o?(s[0]=-i/t,1):n(i)<o?-1:0;var u=t*t-4*e*i;if(u<0)return 0;u=r(u),t<0&&(u=-u),u=(t+u)*-0.5;var a=0;return n(u)>=o&&(s[a++]=i/u),n(e)>=o&&(s[a++]=u/e),a},solveCubic:function(e,t,o,u,a,f){if(n(e)<f)return Numerical.solveQuadratic(t,o,u,a,f);t/=e,o/=e,u/=e;var l=(t*t-3*o)/9,c=(2*t*t*t-9*t*o+27*u)/54,h=l*l*l,p=c*c;t/=3;if(p<h){var d=Math.acos(c/r(h)),v=-2*r(l);return a[0]=v*i(d/3)-t,a[1]=v*i((d+2*s)/3)-t,a[2]=v*i((d-2*s)/3)-t,3}var m=-Math.pow(n(c)+r(p-h),1/3);c<0&&(m=-m);var g=n(m)<f?0:l/m;return a[0]=m+g-t,1}}},BlendMode={process:function(e,t,n,r,i){function x(e,t,n){return.2989*e+.587*t+.114*n}function T(e,t,n,r){var i=r-x(e,t,n);w=e+i,E=t+i,S=n+i;var r=x(w,E,S),s=f(w,E,S),o=l(w,E,S);if(s<0){var u=r-s;w=r+(w-r)*r/u,E=r+(E-r)*r/u,S=r+(S-r)*r/u}if(o>255){var a=255-r,c=o-r;w=r+(w-r)*a/c,E=r+(E-r)*a/c,S=r+(S-r)*a/c}}function N(e,t,n){return l(e,t,n)-f(e,t,n)}function C(e,t,n,r){var i=[e,t,n],s=l(e,t,n),o=f(e,t,n),u;o=o==e?0:o==t?1:2,s=s==e?0:s==t?1:2,u=f(o,s)==0?l(o,s)==1?2:1:0,i[s]>i[o]?(i[u]=(i[u]-i[o])*r/(i[s]-i[o]),i[s]=r):i[u]=i[s]=0,i[o]=0,w=i[0],E=i[1],S=i[2]}var s=t.canvas,o=n.getImageData(i.x,i.y,s.width,s.height),u=o.data,a=t.getImageData(0,0,s.width,s.height).data,f=Math.min,l=Math.max,c=Math.abs,h,p,d,v,m,g,y,b,w,E,S,k={multiply:function(){w=m*h/255,E=g*p/255,S=y*d/255},screen:function(){w=255-(255-m)*(255-h)/255,E=255-(255-g)*(255-p)/255,S=255-(255-y)*(255-d)/255},overlay:function(){w=m<128?2*m*h/255:255-2*(255-m)*(255-h)/255,E=g<128?2*g*p/255:255-2*(255-g)*(255-p)/255,S=y<128?2*y*d/255:255-2*(255-y)*(255-d)/255},"soft-light":function(){var e=h*m/255;w=e+m*(255-(255-m)*(255-h)/255-e)/255,e=p*g/255,E=e+g*(255-(255-g)*(255-p)/255-e)/255,e=d*y/255,S=e+y*(255-(255-y)*(255-d)/255-e)/255},"hard-light":function(){w=h<128?2*h*m/255:255-2*(255-h)*(255-m)/255,E=p<128?2*p*g/255:255-2*(255-p)*(255-g)/255,S=d<128?2*d*y/255:255-2*(255-d)*(255-y)/255},"color-dodge":function(){w=h==255?h:f(255,m*255/(255-h)),E=p==255?p:f(255,g*255/(255-p)),S=d==255?d:f(255,y*255/(255-d))},"color-burn":function(){w=h==0?0:l(255-(255-m)*255/h,0),E=p==0?0:l(255-(255-g)*255/p,0),S=d==0?0:l(255-(255-y)*255/d,0)},darken:function(){w=m<h?m:h,E=g<p?g:p,S=y<d?y:d},lighten:function(){w=m>h?m:h,E=g>p?g:p,S=y>d?y:d},difference:function(){w=m-h,w<0&&(w=-w),E=g-p,E<0&&(E=-E),S=y-d,S<0&&(S=-S)},exclusion:function(){w=m+h*(255-m-m)/255,E=g+p*(255-g-g)/255,S=y+d*(255-y-y)/255},hue:function(){C(h,p,d,N(m,g,y)),T(w,E,S,x(m,g,y))},saturation:function(){C(m,g,y,N(h,p,d)),T(w,E,S,x(m,g,y))},luminosity:function(){T(m,g,y,x(h,p,d))},color:function(){T(h,p,d,x(m,g,y))},add:function(){w=f(m+h,255),E=f(g+p,255),S=f(y+d,255)},subtract:function(){w=l(m-h,0),E=l(g-p,0),S=l(y-d,0)},average:function(){w=(m+h)/2,E=(g+p)/2,S=(y+d)/2},negation:function(){w=255-c(255-h-m),E=255-c(255-p-g),S=255-c(255-d-y)}},L=k[e];if(!L)return;for(var A=0,O=u.length;A<O;A+=4){h=a[A],m=u[A],p=a[A+1],g=u[A+1],d=a[A+2],y=u[A+2],v=a[A+3],b=u[A+3],L();var M=v*r/255,_=1-M;u[A]=M*w+_*m,u[A+1]=M*E+_*g,u[A+2]=M*S+_*y,u[A+3]=v*r+_*b}n.putImageData(o,i.x,i.y)}},PaperScript=this.PaperScript=new function(){function $eval(e,t,n){var r=operators[t];if(e&&e[r]){var i=e[r](n);return t=="!="?!i:i}switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"==":return e==n;case"!=":return e!=n;default:throw new Error("Implement Operator: "+t)}}function $sign(e,t){var n=signOperators[e];if(t&&t[n])return t[n]();switch(e){case"+":return+t;case"-":return-t;default:throw new Error("Implement Sign Operator: "+e)}}function isDynamic(e){var t=e[0];return t!="num"&&t!="string"}function handleOperator(e,t,n){if(operators[e]&&isDynamic(t))return["call",["name","$eval"],[t,["string",e],n]]}function compile(e){var t=parse_js.parse(e),n=parse_js.ast_walker(),r=n.walk;return t=n.with_walkers({binary:function(e,t,n){return handleOperator(e,t=r(t),n=r(n))||[this[0],e,t,n]},assign:function(e,t,n){var i=handleOperator(e,t=r(t),n=r(n));return i?[this[0],!0,t,i]:[this[0],e,t,n]},"unary-prefix":function(e,t){if(signOperators[e]&&isDynamic(t))return["call",["name","$sign"],[["string",e],r(t)]]}},function(){return r(t)}),parse_js.gen_code(t,{beautify:!0})}function evaluate(code,scope){paper=scope;var view=scope.view,tool=/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(code)&&new Tool,res;with(scope)(function(){var onEditOptions,onSelect,onDeselect,onReselect,onMouseDown,onMouseUp,onMouseDrag,onMouseMove,onKeyDown,onKeyUp,onFrame,onResize,handlers=["onEditOptions","onSelect","onDeselect","onReselect","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"];res=eval(compile(code)),tool&&Base.each(handlers,function(key){tool[key]=eval(key)}),view&&(view.onResize=onResize,view.setOnFrame(onFrame),view.draw())}).call(scope);return res}function request(e,t){var n=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain"),n.onreadystatechange=function(){if(n.readyState===4)return evaluate(n.responseText,t)},n.send(null)}function load(){var e=document.getElementsByTagName("script");for(var t=0,n=e.length;t<n;t++){var r=e[t];if(/^text\/(?:x-|)paperscript$/.test(r.type)&&!r.getAttribute("data-paper-loaded")){var i=new PaperScope(r);i.setup(PaperScript.getAttribute(r,"canvas")),r.src?request(r.src,i):evaluate(r.innerHTML,i),r.setAttribute("data-paper-loaded",!0)}}}function handleAttribute(e){return e+="Attribute",function(t,n){return t[e](n)||t[e]("data-paper-"+n)}}var parse_js=new function(){function e(e,t,n){var r=[];for(var i=0;i<e.length;++i)r.push(t.call(n,e[i],i));return r}function t(e){return/^[a-z_$][a-z0-9_$]*$/i.test(e)&&e!="this"&&!a(O,e)&&!a(L,e)&&!a(k,e)}function n(e,t){var n={};e===!0&&(e={});for(var r in t)a(t,r)&&(n[r]=e&&a(e,r)?e[r]:t[r]);return n}function r(e,t){return t<1?"":Array(t+1).join(e)}function i(i,l){function h(e){var t=e[0],n=D[t];if(!n)throw new Error("Can't find generator for \""+t+'"');P.push(e);var r=n.apply(t,e.slice(1));return P.pop(),r}function p(e){var t=e[0],n=e[1];return n!=null&&(t=N([L(t),"=",S(n,"seq")])),t}function d(e){return e?e.length==0?"{}":"{"+M+C(function(){return m(e).join(M)})+M+k("}"):";"}function v(t){var n=t.length;return n==0?"{}":"{"+M+e(t,function(e,t){var r=e[1].length>0,i=C(function(){return k(e[0]?N(["case",h(e[0])+":"]):"default:")},.5)+(r?M+C(function(){return m(e[1]).join(M)}):"");return!A&&r&&t<n-1&&(i+=";"),i}).join(M)+M+k("}")}function m(t,n){for(var r=[],i=t.length-1,s=0;s<=i;++s){var u=t[s],a=h(u);a!=";"&&(!A&&s==i&&(u[0]=="while"&&o(u[2])||f(u[0],["for","for-in"])&&o(u[4])||u[0]=="if"&&o(u[2])&&!u[3]||u[0]=="if"&&u[3]&&o(u[3])?a=a.replace(/;*\s*$/,";"):a=a.replace(/;+\s*$/,"")),r.push(a))}return n?r:e(r,k)}function g(t,n,r,i){var s=i||"function";return t&&(s+=" "+L(t)),s+="("+x(e(n,L))+")",N([s,d(r)])}function y(e){if(e[0]=="do")return h(["block",[e]]);var t=e;for(;;){var n=t[0];if(n=="if"){if(!t[3])return h(["block",[e]]);t=t[3]}else if(n=="while"||n=="do")t=t[2];else{if(n!="for"&&n!="for-in")break;t=t[4]}}return h(e)}function b(e){var t=e.toString(10),n=[t.replace(/^0\./,".")],r;return Math.floor(e)===e?(n.push("0x"+e.toString(16).toLowerCase(),"0"+e.toString(8)),(r=/^(.*?)(0+)$/.exec(e))&&n.push(r[1]+"e"+r[2].length)):(r=/^0?\.(0+)(.*)$/.exec(e))&&n.push(r[2]+"e-"+(r[1].length+r[2].length),t.substr(t.indexOf("."))),E(n)}function w(e){if(e[0]=="function"||e[0]=="object"){var t=c(P),n=t.pop(),r=t.pop();while(r){if(r[0]=="stat")return!0;if((r[0]!="seq"&&r[0]!="call"&&r[0]!="dot"&&r[0]!="sub"&&r[0]!="conditional"||r[1]!==n)&&(r[0]!="binary"&&r[0]!="assign"&&r[0]!="unary-postfix"||r[2]!==n))return!1;n=r,r=t.pop()}}return!a($,e[0])}function E(e){if(e.length==1)return e[0];if(e.length==2){var t=e[1];return e=e[0],e.length<=t.length?e:t}return E([e[0],E(e.slice(1))])}function S(e){var t=h(e);for(var n=1;n<arguments.length;++n){var r=arguments[n];if(r instanceof Function&&r(e)||e[0]==r)return"("+t+")"}return t}function x(e){return e.join(","+_)}function N(e){if(A)return e.join(" ");var t=[];for(var n=0;n<e.length;++n){var r=e[n+1];t.push(e[n]),r&&(/[a-z0-9_\x24]$/i.test(e[n].toString())&&/^[a-z0-9_\x24]/i.test(r.toString())||/[\+\-]$/.test(e[n].toString())&&/^[\+\-]/.test(r.toString()))&&t.push(" ")}return t.join("")}function C(e,t){t==null&&(t=1),O+=t;try{return e.apply(null,c(arguments,1))}finally{O-=t}}function k(e){return e==null&&(e=""),A&&(e=r(" ",l.indent_start+O*l.indent_level)+e),e}function L(e){return e.toString()}l=n(l,{indent_start:0,indent_level:4,quote_keys:!1,space_colon:!1,beautify:!1});var A=!!l.beautify,O=0,M=A?"\n":"",_=A?" ":"",D={string:s,num:b,name:L,toplevel:function(e){return m(e).join(M)},splice:function(t){var n=P[P.length-2][0];return a(J,n)?d.apply(this,arguments):e(m(t,!0),function(e,t){return t>0?k(e):e}).join(M)},block:d,"var":function(t){return"var "+x(e(t,p))+";"},"const":function(t){return"const "+x(e(t,p))+";"},"try":function(e,t,n){var r=["try",d(e)];return t&&r.push("catch","("+t[0]+")",d(t[1])),n&&r.push("finally",d(n)),N(r)},"throw":function(e){return N(["throw",h(e)])+";"},"new":function(t,n){return n=n.length>0?"("+x(e(n,h))+")":"",N(["new",S(t,"seq","binary","conditional","assign",function(e){var t=u(),n={};try{t.with_walkers({call:function(){throw n},"function":function(){return this}},function(){t.walk(e)})}catch(r){if(r===n)return!0;throw r}})+n])},"switch":function(e,t){return N(["switch","("+h(e)+")",v(t)])},"break":function(e){var t="break";return e!=null&&(t+=" "+L(e)),t+";"},"continue":function(e){var t="continue";return e!=null&&(t+=" "+L(e)),t+";"},conditional:function(e,t,n){return N([S(e,"assign","seq","conditional"),"?",S(t,"seq"),":",S(n,"seq")])},assign:function(e,t,n){return e&&e!==!0?e+="=":e="=",N([h(t),e,S(n,"seq")])},dot:function(e){var t=h(e),n=1;e[0]=="num"?/\./.test(e[1])||(t+="."):w(e)&&(t="("+t+")");while(n<arguments.length)t+="."+L(arguments[n++]);return t},call:function(t,n){var r=h(t);return w(t)&&(r="("+r+")"),r+"("+x(e(n,function(e){return S(e,"seq")}))+")"},"function":g,defun:g,"if":function(e,t,n){var r=["if","("+h(e)+")",n?y(t):h(t)];return n&&r.push("else",h(n)),N(r)},"for":function(e,t,n,r){var i=["for"];e=(e!=null?h(e):"").replace(/;*\s*$/,";"+_),t=(t!=null?h(t):"").replace(/;*\s*$/,";"+_),n=(n!=null?h(n):"").replace(/;*\s*$/,"");var s=e+t+n;return s=="; ; "&&(s=";;"),i.push("("+s+")",h(r)),N(i)},"for-in":function(e,t,n,r){return N(["for","("+(e?h(e).replace(/;+$/,""):h(t)),"in",h(n)+")",h(r)])},"while":function(e,t){return N(["while","("+h(e)+")",h(t)])},"do":function(e,t){return N(["do",h(t),"while","("+h(e)+")"])+";"},"return":function(e){var t=["return"];return e!=null&&t.push(h(e)),N(t)+";"},binary:function(e,t,n){var r=h(t),i=h(n);if(f(t[0],["assign","conditional","seq"])||t[0]=="binary"&&W[e]>W[t[1]])r="("+r+")";if(f(n[0],["assign","conditional","seq"])||n[0]=="binary"&&W[e]>=W[n[1]]&&(n[1]!=e||!f(e,["&&","||","*"])))i="("+i+")";return N([r,e,i])},"unary-prefix":function(e,t){var n=h(t);return t[0]=="num"||t[0]=="unary-prefix"&&!a(H,e+t[1])||!w(t)||(n="("+n+")"),e+(T(e.charAt(0))?" ":"")+n},"unary-postfix":function(e,t){var n=h(t);return t[0]=="num"||t[0]=="unary-postfix"&&!a(H,e+t[1])||!w(t)||(n="("+n+")"),n+e},sub:function(e,t){var n=h(e);return w(e)&&(n="("+n+")"),n+"["+h(t)+"]"},object:function(n){return n.length==0?"{}":"{"+M+C(function(){return e(n,function(e){if(e.length==3)return k(g(e[0],e[1][2],e[1][3],e[2]));var n=e[0],r=h(e[1]);return l.quote_keys?n=s(n):(typeof n=="number"||!A&&+n+""==n)&&parseFloat(n)>=0?n=b(+n):t(n)||(n=s(n)),k(N(A&&l.space_colon?[n,":",r]:[n+":",r]))}).join(","+M)})+M+k("}")},regexp:function(e,t){return"/"+e+"/"+t},array:function(t){return t.length==0?"[]":N(["[",x(e(t,function(e){return!A&&e[0]=="atom"&&e[1]=="undefined"?"":S(e,"seq")})),"]"])},stat:function(e){return h(e).replace(/;*\s*$/,";")},seq:function(){return x(e(c(arguments),h))},label:function(e,t){return N([L(e),":",h(t)])},"with":function(e,t){return N(["with","("+h(e)+")",h(t)])},atom:function(e){return L(e)}},P=[];return h(i)}function s(e){var t=0,n=0;return e=e.replace(/[\\\b\f\n\r\t\x22\x27]/g,function(e){switch(e){case"\\":return"\\\\";case"\b":return"\\b";case"\f":return"\\f";case"\n":return"\\n";case"\r":return"\\r";case"	":return"\\t";case'"':return++t,'"';case"'":return++n,"'"}return e}),t>n?"'"+e.replace(/\x27/g,"\\'")+"'":'"'+e.replace(/\x22/g,'\\"')+'"'}function o(e){return!e||e[0]=="block"&&(!e[1]||e[1].length==0)}function u(){function t(e,t){var n={},r;for(r in e)a(e,r)&&(n[r]=o[r],o[r]=e[r]);var i=t();for(r in n)a(n,r)&&(n[r]?o[r]=n[r]:delete o[r]);return i}function n(e){if(e==null)return null;try{u.push(e);var t=e[0],n=o[t];if(n){var r=n.apply(e,e.slice(1));if(r!=null)return r}return n=s[t],n.apply(e,e.slice(1))}finally{u.pop()}}function r(t){var r=[this[0]];return t!=null&&r.push(e(t,n)),r}function i(t){return[this[0],e(t,function(e){var t=[e[0]];return e.length>1&&(t[1]=n(e[1])),t})]}var s={string:function(e){return[this[0],e]},num:function(e){return[this[0],e]},name:function(e){return[this[0],e]},toplevel:function(t){return[this[0],e(t,n)]},block:r,splice:r,"var":i,"const":i,"try":function(t,r,i){return[this[0],e(t,n),r!=null?[r[0],e(r[1],n)]:null,i!=null?e(i,n):null]},"throw":function(e){return[this[0],n(e)]},"new":function(t,r){return[this[0],n(t),e(r,n)]},"switch":function(t,r){return[this[0],n(t),e(r,function(t){return[t[0]?n(t[0]):null,e(t[1],n)]})]},"break":function(e){return[this[0],e]},"continue":function(e){return[this[0],e]},conditional:function(e,t,r){return[this[0],n(e),n(t),n(r)]},assign:function(e,t,r){return[this[0],e,n(t),n(r)]},dot:function(e){return[this[0],n(e)].concat(c(arguments,1))},call:function(t,r){return[this[0],n(t),e(r,n)]},"function":function(t,r,i){return[this[0],t,r.slice(),e(i,n)]},defun:function(t,r,i){return[this[0],t,r.slice(),e(i,n)]},"if":function(e,t,r){return[this[0],n(e),n(t),n(r)]},"for":function(e,t,r,i){return[this[0],n(e),n(t),n(r),n(i)]},"for-in":function(e,t,r,i){return[this[0],n(e),n(t),n(r),n(i)]},"while":function(e,t){return[this[0],n(e),n(t)]},"do":function(e,t){return[this[0],n(e),n(t)]},"return":function(e){return[this[0],n(e)]},binary:function(e,t,r){return[this[0],e,n(t),n(r)]},"unary-prefix":function(e,t){return[this[0],e,n(t)]},"unary-postfix":function(e,t){return[this[0],e,n(t)]},sub:function(e,t){return[this[0],n(e),n(t)]},object:function(t){return[this[0],e(t,function(e){return e.length==2?[e[0],n(e[1])]:[e[0],n(e[1]),e[2]]})]},regexp:function(e,t){return[this[0],e,t]},array:function(t){return[this[0],e(t,n)]},stat:function(e){return[this[0],n(e)]},seq:function(){return[this[0]].concat(e(c(arguments),n))},label:function(e,t){return[this[0],e,n(t)]},"with":function(e,t){return[this[0],n(e),n(t)]},atom:function(e){return[this[0],e]}},o={},u=[];return{walk:n,with_walkers:t,parent:function(){return u[u.length-2]},stack:function(){return u}}}function a(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function f(e,t){for(var n=t.length;--n>=0;)if(t[n]===e)return!0;return!1}function l(e){return e.split("")}function c(e,t){return Array.prototype.slice.call(e,t||0)}function h(e){var t={};for(var n=0;n<e.length;++n)t[e[n]]=!0;return t}function p(e){e instanceof Function&&(e=e());for(var t=1,n=arguments.length;--n>0;++t)arguments[t]();return e}function d(e){var t=c(arguments,1);return function(){return e.apply(this,t.concat(c(arguments)))}}function v(e,t,n){function r(e){try{return++ot.in_loop,e()}finally{--ot.in_loop}}function i(e){var t=o(e),n=ot.token.value;if(st("operator")&&a(z,n)){if(s(t))return rt(),$("assign",z[n],t,i(e));tt("Invalid assignment")}return t}function s(e){if(!t)return!0;switch(e[0]){case"dot":case"sub":case"new":case"call":return!0;case"name":return e[1]!="this"}}function o(e){var t=u(e);if(st("operator","?")){rt();var n=ct(!1);return Q(":"),$("conditional",t,n,ct(!1,e))}return t}function u(e){return l(lt(!0),0,e)}function l(e,t,n){var r=st("operator")?ot.token.value:null;r&&r=="in"&&n&&(r=null);var i=r!=null?W[r]:null;if(i!=null&&i>t){rt();var s=l(lt(!0),i,n);return l($("binary",r,e,s),t,n)}return e}function h(e,t,n){return(t=="++"||t=="--")&&!s(n)&&tt("Invalid use of "+t+" operator"),$(e,t,n)}function v(e,t){return st("punc",".")?(rt(),v($("dot",e,w()),t)):st("punc","[")?(rt(),v($("sub",e,p(ct,d(Q,"]"))),t)):t&&st("punc","(")?(rt(),v($("call",e,T(")")),!0)):t&&st("operator")&&a(U,ot.token.value)?p(d(h,"unary-postfix",ot.token.value,e),rt):e}function w(){switch(ot.token.type){case"name":case"operator":case"keyword":case"atom":return p(ot.token.value,rt);default:Z()}}function E(){switch(ot.token.type){case"num":case"string":return p(ot.token.value,rt)}return w()}function S(){var e=!0,n=[];while(!st("punc","}")){e?e=!1:Q(",");if(!t&&st("punc","}"))break;var r=ot.token.type,i=E();r!="name"||i!="get"&&i!="set"||!!st("punc",":")?(Q(":"),n.push([i,ct(!1)])):n.push([w(),at(!1),i])}return rt(),$("object",n)}function x(){return $("array",T("]",!t,!0))}function T(e,t,n){var r=!0,i=[];while(!st("punc",e)){r?r=!1:Q(",");if(t&&st("punc",e))break;st("punc",",")&&n?i.push(["atom","undefined"]):i.push(ct(!1))}return rt(),i}function N(){var e=lt(!1),t;return st("punc","(")?(rt(),t=T(")")):t=[],v($("new",e,t),!0)}function C(){return $("const",L())}function k(e){return $("var",L(e))}function L(e){var t=[];for(;;){st("name")||Z();var n=ot.token.value;rt(),st("operator","=")?(rt(),t.push([n,ct(!1,e)])):t.push([n]);if(!st("punc",","))break;rt()}return t}function A(){var e=O(),t,n;if(st("keyword","catch")){rt(),Q("("),st("name")||tt("Name expected");var r=ot.token.value;rt(),Q(")"),t=[r,O()]}return st("keyword","finally")&&(rt(),n=O()),!t&&!n&&tt("Missing catch/finally blocks"),$("try",e,t,n)}function O(){Q("{");var e=[];while(!st("punc","}"))st("eof")&&Z(),e.push(ut());return rt(),e}function M(){var e=q(),t=ut(),n;return st("keyword","else")&&(rt(),n=ut()),$("if",e,t,n)}function _(e){var t=e[0]=="var"?$("name",e[1][0]):e;rt();var n=ct();return Q(")"),$("for-in",e,t,n,r(ut))}function D(e){Q(";");var t=st("punc",";")?null:ct();Q(";");var n=st("punc",")")?null:ct();return Q(")"),$("for",e,t,n,r(ut))}function P(){Q("(");var e=null;if(!st("punc",";")){e=st("keyword","var")?(rt(),k(!0)):ct(!0,!0);if(st("operator","in"))return _(e)}return D(e)}function H(e){var t;return K()||(t=st("name")?ot.token.value:null),t!=null?(rt(),f(t,ot.labels)||tt("Label "+t+" without matching loop or statement")):ot.in_loop==0&&tt(e+" not inside a loop or switch"),J(),$(e,t)}function B(){return $("stat",p(ct,J))}function j(e){ot.labels.push(e);var n=ot.token,r=ut();return t&&!a(X,r[0])&&Z(n),ot.labels.pop(),$("label",e,r)}function F(e){return n?function(){var t=ot.token,n=e.apply(this,arguments);return n[0]=I(n[0],t,nt()),n}:e}function I(e,t,n){return e instanceof m?e:new m(e,t,n)}function q(){Q("(");var e=ct();return Q(")"),e}function $(){return c(arguments)}function J(){st("punc",";")?rt():K()||Z()}function K(){return!t&&(ot.token.nlb||st("eof")||st("punc","}"))}function Q(e){return Y("punc",e)}function Y(e,t){if(st(e,t))return rt();et(ot.token,"Unexpected token "+ot.token.type+", expected "+e)}function Z(e){e==null&&(e=ot.token),et(e,"Unexpected token: "+e.type+" ("+e.value+")")}function et(e,t){tt(t,e.line,e.col)}function tt(e,t,n,r){var i=ot.input.context();b(e,t!=null?t:i.tokline,n!=null?n:i.tokcol,r!=null?r:i.tokpos)}function nt(){return ot.prev}function rt(){return ot.prev=ot.token,ot.peeked?(ot.token=ot.peeked,ot.peeked=null):ot.token=ot.input(),ot.token}function it(){return ot.peeked||(ot.peeked=ot.input())}function st(e,t){return y(ot.token,e,t)}var ot={input:typeof e=="string"?g(e,!0):e,token:null,prev:null,peeked:null,in_function:0,in_loop:0,labels:[]};ot.token=rt();var ut=F(function(){st("operator","/")&&(ot.peeked=null,ot.token=ot.input(!0));switch(ot.token.type){case"num":case"string":case"regexp":case"operator":case"atom":return B();case"name":return y(it(),"punc",":")?j(p(ot.token.value,rt,rt)):B();case"punc":switch(ot.token.value){case"{":return $("block",O());case"[":case"(":return B();case";":return rt(),$("block");default:Z()};case"keyword":switch(p(ot.token.value,rt)){case"break":return H("break");case"continue":return H("continue");case"debugger":return J(),$("debugger");case"do":return function(e){return Y("keyword","while"),$("do",p(q,J),e)}(r(ut));case"for":return P();case"function":return at(!0);case"if":return M();case"return":return ot.in_function==0&&tt("'return' outside of function"),$("return",st("punc",";")?(rt(),null):K()?null:p(ct,J));case"switch":return $("switch",q(),ft());case"throw":return $("throw",p(ct,J));case"try":return A();case"var":return p(k,J);case"const":return p(C,J);case"while":return $("while",q(),r(ut));case"with":return $("with",q(),ut());default:Z()}}}),at=F(function(e){var t=st("name")?p(ot.token.value,rt):null;return e&&!t&&Z(),Q("("),$(e?"defun":"function",t,function(e,t){while(!st("punc",")"))e?e=!1:Q(","),st("name")||Z(),t.push(ot.token.value),rt();return rt(),t}(!0,[]),function(){++ot.in_function;var e=ot.in_loop;ot.in_loop=0;var t=O();return--ot.in_function,ot.in_loop=e,t}())}),ft=d(r,function(){Q("{");var e=[],t=null;while(!st("punc","}"))st("eof")&&Z(),st("keyword","case")?(rt(),t=[],e.push([ct(),t]),Q(":")):st("keyword","default")?(rt(),Q(":"),t=[],e.push([null,t])):(t||Z(),t.push(ut()));return rt(),e}),lt=F(function(e){if(st("operator","new"))return rt(),N();if(st("operator")&&a(R,ot.token.value))return h("unary-prefix",p(ot.token.value,rt),lt(e));if(st("punc")){switch(ot.token.value){case"(":return rt(),v(p(ct,d(Q,")")),e);case"[":return rt(),v(x(),e);case"{":return rt(),v(S(),e)}Z()}if(st("keyword","function"))return rt(),v(at(!1),e);if(a(V,ot.token.type)){var t=ot.token.type=="regexp"?$("regexp",ot.token.value[0],ot.token.value[1]):$(ot.token.type,ot.token.value);return v(p(t,rt),e)}Z()}),ct=F(function(e,t){arguments.length==0&&(e=!0);var n=i(t);return e&&st("punc",",")?(rt(),$("seq",n,ct(!0,t))):n});return $("toplevel",function(e){while(!st("eof"))e.push(ut());return e}([]))}function m(e,t,n){this.name=e,this.start=t,this.end=n}function g(e){function t(e){if(e)return u();g(),w();var t=D();if(!t)return y("eof");if(N(t))return d();if(t=='"'||t=="'")return c();if(a(F,t))return y("punc",_());if(t==".")return i();if(t=="/")return s();if(a(M,t))return o();if(t=="\\"||x(t))return r();v("Unexpected character '"+t+"'")}function n(e,t){try{return t()}catch(n){if(n!==q)throw n;v(e)}}function r(){var e=m(S);return a(k,e)?a(H,e)?y("operator",e):a(O,e)?y("atom",e):y("keyword",e):y("name",e)}function i(){return _(),N(D())?d("."):y("punc",".")}function s(){_();var e=P.regex_allowed;switch(D()){case"/":return P.comments_before.push(l()),P.regex_allowed=e,t();case"*":return P.comments_before.push(f()),P.regex_allowed=e,t()}return P.regex_allowed?u():o("/")}function o(e){function t(e){if(!D())return e;var n=e+D();return a(H,n)?(_(),t(n)):e}return y("operator",t(e||_()))}function u(){return n("Unterminated regular expression",function(){var e=!1,t="",n,r=!1;while(n=_(!0))if(e)t+="\\"+n,e=!1;else if(n=="[")r=!0,t+=n;else if(n=="]"&&r)r=!1,t+=n;else{if(n=="/"&&!r)break;n=="\\"?e=!0:t+=n}var i=m(function(e){return a(I,e)});return y("regexp",[t,i])})}function f(){return _(),n("Unterminated multiline comment",function(){var e=C("*/",!0),t=P.text.substring(P.pos,e),n=y("comment2",t,!0);return P.pos=e+2,P.line+=t.split("\n").length-1,P.newline_before=t.indexOf("\n")>=0,n})}function l(){_();var e=C("\n"),t;return e==-1?(t=P.text.substr(P.pos),P.pos=P.text.length):(t=P.text.substring(P.pos,e),P.pos=e),y("comment1",t,!0)}function c(){return n("Unterminated string constant",function(){var e=_(),t="";for(;;){var n=_(!0);if(n=="\\")n=p();else if(n==e)break;t+=n}return y("string",t)})}function h(e){var t=0;for(;e>0;--e){var n=parseInt(_(!0),16);isNaN(n)&&v("Invalid hex-character pattern in string"),t=t<<4|n}return t}function p(){var e=_(!0);switch(e){case"n":return"\n";case"r":return"\r";case"t":return"	";case"b":return"\b";case"v":return"";case"f":return"\f";case"0":return"\0";case"x":return String.fromCharCode(h(2));case"u":return String.fromCharCode(h(4));case"\n":return"";default:return e}}function d(e){var t=!1,n=!1,r=!1,i=e==".",s=m(function(s,o){return s=="x"||s=="X"?r?!1:r=!0:!!r||s!="E"&&s!="e"?s=="-"?n||o==0&&!e?!0:!1:s=="+"?n:(n=!1,s=="."?!i&&!r?i=!0:!1:T(s)):t?!1:t=n=!0});e&&(s=e+s);var o=E(s);if(!isNaN(o))return y("num",o);v("Invalid syntax: "+s)}function v(e){b(e,P.tokline,P.tokcol,P.tokpos)}function m(e){var t="",n=D(),r=0;while(n&&e(n,r++))t+=_(),n=D();return t}function g(){while(a(B,D()))_()}function y(e,t,n){P.regex_allowed=e=="operator"&&!a(U,t)||e=="keyword"&&a(A,t)||e=="punc"&&a(j,t);var r={type:e,value:t,line:P.tokline,col:P.tokcol,pos:P.tokpos,nlb:P.newline_before};return n||(r.comments_before=P.comments_before,P.comments_before=[]),P.newline_before=!1,r}function w(){P.tokline=P.line,P.tokcol=P.col,P.tokpos=P.pos}function C(e,t){var n=P.text.indexOf(e,P.pos);if(t&&n==-1)throw q;return n}function L(){return!P.peek()}function _(e){var t=P.text.charAt(P.pos++);if(e&&!t)throw q;return t=="\n"?(P.newline_before=!0,++P.line,P.col=0):++P.col,t}function D(){return P.text.charAt(P.pos)}var P={text:e.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,""),pos:0,tokpos:0,line:0,tokline:0,col:0,tokcol:0,newline_before:!1,regex_allowed:!1,comments_before:[]};return t.context=function(e){return e&&(P=e),P},t}function y(e,t,n){return e.type==t&&(n==null||e.value==n)}function b(e,t,n,r){throw new w(e,t,n,r)}function w(e,t,n,r){this.message=e,this.line=t,this.col=n,this.pos=r}function E(e){if(_.test(e))return parseInt(e.substr(2),16);if(D.test(e))return parseInt(e.substr(1),8);if(P.test(e))return parseFloat(e)}function S(e){return x(e)||N(e)}function x(e){return e=="$"||e=="_"||C(e)}function T(e){return N(e)||C(e)}function N(e){return e=e.charCodeAt(0),e>=48&&e<=57}function C(e){return e=e.charCodeAt(0),e>=65&&e<=90||e>=97&&e<=122}var k=h(["break","case","catch","const","continue","default","delete","do","else","finally","for","function","if","in","instanceof","new","return","switch","throw","try","typeof","var","void","while","with"]),L=h(["abstract","boolean","byte","char","class","debugger","double","enum","export","extends","final","float","goto","implements","import","int","interface","long","native","package","private","protected","public","short","static","super","synchronized","throws","transient","volatile"]),A=h(["return","new","delete","throw","else","case"]),O=h(["false","null","true","undefined"]),M=h(l("+-*&%=<>!?|~^")),_=/^0x[0-9a-f]+$/i,D=/^0[0-7]+$/,P=/^\d*\.?\d*(?:e[+-]?\d*(?:\d\.?|\.?\d)\d*)?$/i,H=h(["in","instanceof","typeof","new","void","delete","++","--","+","-","!","~","&","|","^","*","/","%",">>","<<",">>>","<",">","<=",">=","==","===","!=","!==","?","=","+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&=","&&","||"]),B=h(l(" \n\r	")),j=h(l("[{}(,.;:")),F=h(l("[]{}(),;:")),I=h(l("gmsiy"));w.prototype.toString=function(){return this.message+" (line: "+this.line+", col: "+this.col+", pos: "+this.pos+")"};var q={},R=h(["typeof","void","delete","--","++","!","~","-","+"]),U=h(["--","++"]),z=function(e,t,n){while(n<e.length)t[e[n]]=e[n].substr(0,e[n].length-1),n++;return t}(["+=","-=","/=","*=","%=",">>=","<<=",">>>=","|=","^=","&="],{"=":!0},0),W=function(e,t){for(var n=0,r=1;n<e.length;++n,++r){var i=e[n];for(var s=0;s<i.length;++s)t[i[s]]=r}return t}([["||"],["&&"],["|"],["^"],["&"],["==","===","!=","!=="],["<",">","<=",">=","in","instanceof"],[">>","<<",">>>"],["+","-"],["*","/","%"]],{}),X=h(["for","do","while","switch"]),V=h(["atom","num","string","regexp","name"]);m.prototype.toString=function(){return this.name};var $=h(["name","array","object","string","dot","sub","call","regexp"]),J=h(["if","while","do","for","for-in","with"]);return{parse:v,gen_code:i,tokenizer:g,ast_walker:u}},operators={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"modulo","==":"equals","!=":"equals"},signOperators={"-":"negate"};return DomEvent.add(window,{load:load}),{compile:compile,evaluate:evaluate,load:load,getAttribute:handleAttribute("get"),hasAttribute:handleAttribute("has")}};return this.load=PaperScript.load,Base.each(this,function(e,t){e&&e.prototype instanceof Base&&(e._name=t)}),this.enumerable=!0,new(PaperScope.inject(this))};(function(){if(!this.require){var e={},t={},n=function(s,o){var u=r(o,s),a=r(u,"./index"),f,l;f=t[u]||t[a];if(f)return f.exports;if(!(l=e[u]||e[u=a]))throw"module '"+s+"' not found";f={id:u,exports:{}};try{return t[u]=f,l(f.exports,function(e){return n(e,i(u))},f),f.exports}catch(c){throw delete t[u],c}},r=function(e,t){var n=[],r,i;/^\.\.?(\/|$)/.test(t)?r=[e,t].join("/").split("/"):r=t.split("/");for(var s=0,o=r.length;s<o;s++)i=r[s],i==".."?n.pop():i!="."&&i!=""&&n.push(i);return n.join("/")},i=function(e){return e.split("/").slice(0,-1).join("/")};this.require=function(e){return n(e,"")},this.require.define=function(t){for(var n in t)e[n]=t[n]},this.require.modules=e,this.require.cache=t}return this.require.define}).call(this)({"es5-shimify/index":function(e,t,n){(function(e){typeof define=="function"?define(e):typeof YUI=="function"?YUI.add("es5",e):e()})(function(){function e(){}function A(e){return e=+e,e!==e?e=0:e!==0&&e!==1/0&&e!==-1/0&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function O(e){var t=typeof e;return e===null||t==="undefined"||t==="boolean"||t==="number"||t==="string"}function M(e){var t,n,r;if(O(e))return e;n=e.valueOf;if(typeof n=="function"){t=n.call(e);if(O(t))return t}r=e.toString;if(typeof r=="function"){t=r.call(e);if(O(t))return t}throw new TypeError}Function.prototype.bind||(Function.prototype.bind=function(n){var r=this;if(typeof r!="function")throw new TypeError("Function.prototype.bind called on incompatible "+r);var s=i.call(arguments,1),o=function(){if(this instanceof o){var e=r.apply(this,s.concat(i.call(arguments)));return Object(e)===e?e:this}return r.apply(n,s.concat(i.call(arguments)))};return r.prototype&&(e.prototype=r.prototype,o.prototype=new e,e.prototype=null),o});var t=Function.prototype.call,n=Array.prototype,r=Object.prototype,i=n.slice,s=t.bind(r.toString),o=t.bind(r.hasOwnProperty),u,a,f,l,c;if(c=o(r,"__defineGetter__"))u=t.bind(r.__defineGetter__),a=t.bind(r.__defineSetter__),f=t.bind(r.__lookupGetter__),l=t.bind(r.__lookupSetter__);if([1,2].splice(0).length!=2){var h=Array.prototype.splice;Array.prototype.splice=function(e,t){return arguments.length?h.apply(this,[e===void 0?0:e,t===void 0?this.length-e:t].concat(i.call(arguments,2))):[]}}if([].unshift(0)!=1){var p=Array.prototype.unshift;Array.prototype.unshift=function(){return p.apply(this,arguments),this.length}}Array.isArray||(Array.isArray=function(t){return s(t)=="[object Array]"});var d=Object("a"),v=d[0]!="a"||!(0 in d);Array.prototype.forEach||(Array.prototype.forEach=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=arguments[1],o=-1,u=r.length>>>0;if(s(t)!="[object Function]")throw new TypeError;while(++o<u)o in r&&t.call(i,r[o],o,n)}),Array.prototype.map||(Array.prototype.map=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0,o=Array(i),u=arguments[1];if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var a=0;a<i;a++)a in r&&(o[a]=t.call(u,r[a],a,n));return o}),Array.prototype.filter||(Array.prototype.filter=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0,o=[],u,a=arguments[1];if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var f=0;f<i;f++)f in r&&(u=r[f],t.call(a,u,f,n)&&o.push(u));return o}),Array.prototype.every||(Array.prototype.every=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0,o=arguments[1];if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var u=0;u<i;u++)if(u in r&&!t.call(o,r[u],u,n))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0,o=arguments[1];if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");for(var u=0;u<i;u++)if(u in r&&t.call(o,r[u],u,n))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0;if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!i&&arguments.length==1)throw new TypeError("reduce of empty array with no initial value");var o=0,u;if(arguments.length>=2)u=arguments[1];else do{if(o in r){u=r[o++];break}if(++o>=i)throw new TypeError("reduce of empty array with no initial value")}while(!0);for(;o<i;o++)o in r&&(u=t.call(void 0,u,r[o],o,n));return u}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(t){var n=_(this),r=v&&s(this)=="[object String]"?this.split(""):n,i=r.length>>>0;if(s(t)!="[object Function]")throw new TypeError(t+" is not a function");if(!i&&arguments.length==1)throw new TypeError("reduceRight of empty array with no initial value");var o,u=i-1;if(arguments.length>=2)o=arguments[1];else do{if(u in r){o=r[u--];break}if(--u<0)throw new TypeError("reduceRight of empty array with no initial value")}while(!0);do u in this&&(o=t.call(void 0,o,r[u],u,n));while(u--);return o});if(!Array.prototype.indexOf||[0,1].indexOf(1,2)!=-1)Array.prototype.indexOf=function(t){var n=v&&s(this)=="[object String]"?this.split(""):_(this),r=n.length>>>0;if(!r)return-1;var i=0;arguments.length>1&&(i=A(arguments[1])),i=i>=0?i:Math.max(0,r+i);for(;i<r;i++)if(i in n&&n[i]===t)return i;return-1};if(!Array.prototype.lastIndexOf||[0,1].lastIndexOf(0,-3)!=-1)Array.prototype.lastIndexOf=function(t){var n=v&&s(this)=="[object String]"?this.split(""):_(this),r=n.length>>>0;if(!r)return-1;var i=r-1;arguments.length>1&&(i=Math.min(i,A(arguments[1]))),i=i>=0?i:r-Math.abs(i);for(;i>=0;i--)if(i in n&&t===n[i])return i;return-1};if(!Object.keys){var m=!0,g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],y=g.length;for(var b in{toString:null})m=!1;Object.keys=function D(e){if(typeof e!="object"&&typeof e!="function"||e===null)throw new TypeError("Object.keys called on a non-object");var D=[];for(var t in e)o(e,t)&&D.push(t);if(m)for(var n=0,r=y;n<r;n++){var i=g[n];o(e,i)&&D.push(i)}return D}}var w=-621987552e5,E="-000001";if(!Date.prototype.toISOString||(new Date(w)).toISOString().indexOf(E)===-1)Date.prototype.toISOString=function(){var t,n,r,i,s;if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");i=this.getUTCFullYear(),s=this.getUTCMonth(),i+=Math.floor(s/12),s=(s%12+12)%12,t=[s+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],i=(i<0?"-":i>9999?"+":"")+("00000"+Math.abs(i)).slice(0<=i&&i<=9999?-4:-6),n=t.length;while(n--)r=t[n],r<10&&(t[n]="0"+r);return i+"-"+t.slice(0,2).join("-")+"T"+t.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"};var S=!1;try{S=Date.prototype.toJSON&&(new Date(NaN)).toJSON()===null&&(new Date(w)).toJSON().indexOf(E)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(x){}S||(Date.prototype.toJSON=function(t){var n=Object(this),r=M(n),i;if(typeof r=="number"&&!isFinite(r))return null;i=n.toISOString;if(typeof i!="function")throw new TypeError("toISOString property is not callable");return i.call(n)});if(!Date.parse||"Date.parse is buggy")Date=function(e){function t(n,r,i,s,o,u,a){var f=arguments.length;if(this instanceof e){var l=f==1&&String(n)===n?new e(t.parse(n)):f>=7?new e(n,r,i,s,o,u,a):f>=6?new e(n,r,i,s,o,u):f>=5?new e(n,r,i,s,o):f>=4?new e(n,r,i,s):f>=3?new e(n,r,i):f>=2?new e(n,r):f>=1?new e(n):new e;return l.constructor=t,l}return e.apply(this,arguments)}function i(e,t){var n=t>1?1:0;return r[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)}var n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),r=[0,31,59,90,120,151,181,212,243,273,304,334,365];for(var s in e)t[s]=e[s];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function(r){var s=n.exec(r);if(s){var o=Number(s[1]),u=Number(s[2]||1)-1,a=Number(s[3]||1)-1,f=Number(s[4]||0),l=Number(s[5]||0),c=Number(s[6]||0),h=Number(s[7]||0),p=!s[4]||s[8]?0:Number(new e(1970,0)),d=s[9]==="-"?1:-1,v=Number(s[10]||0),m=Number(s[11]||0),g;if(f<(l>0||c>0||h>0?24:25)&&l<60&&c<60&&h<1e3&&u>-1&&u<12&&v<24&&m<60&&a>-1&&a<i(o,u+1)-i(o,u)){g=((i(o,u)+a)*24+f+v*d)*60,g=((g+l+m*d)*60+c)*1e3+h+p;if(-864e13<=g&&g<=864e13)return g}return NaN}return e.parse.apply(this,arguments)},t}(Date);Date.now||(Date.now=function(){return(new Date).getTime()});if("0".split(void 0,0).length){var T=String.prototype.split;String.prototype.split=function(e,t){return e===void 0&&t===0?[]:T.apply(this,arguments)}}if("".substr&&"0b".substr(-1)!=="b"){var N=String.prototype.substr;String.prototype.substr=function(e,t){return N.call(this,e<0?(e=this.length+e)<0?0:e:e,t)}}var C="	\n\f\r \u2028\u2029";if(!String.prototype.trim||C.trim()){C="["+C+"]";var k=new RegExp("^"+C+C+"*"),L=new RegExp(C+C+"*$");String.prototype.trim=function(){if(this===undefined||this===null)throw new TypeError("can't convert "+this+" to object");return String(this).replace(k,"").replace(L,"")}}var _=function(e){if(e==null)throw new TypeError("can't convert "+e+" to object");return Object(e)}})},"json2ify/index":function(exports,require,module){typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},"jqueryify/index":function(exports,require,module){(function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=jQuery.extend({},s),f=s.events,data_priv.set(t,o);if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTweens(e,t){jQuery.each(t,function(t,n){var r=(tweeners[t]||[]).concat(tweeners["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return createTweens(f,l),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&isHidden(e);n.queue||(l=jQuery._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,jQuery.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]})),u=data_priv.get(e,"fxshow");for(r in t){s=t[r];if(rfxtypes.exec(s)){delete t[r],a=a||s==="toggle";if(s===(m?"hide":"show")){if(s!=="show"||u===undefined||u[r]===undefined)continue;m=!0}v.push(r)}}o=v.length;if(o){u=data_priv.get(e,"fxshow")||data_priv.access(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?jQuery(e).show():h.done(function(){jQuery(e).hide()}),h.done(function(){var t;data_priv.remove(e,"fxshow");for(t in d)jQuery.style(e,t,d[t])});for(r=0;r<o;r++)i=v[r],f=h.createTween(i,m?u[i]:0),d[i]=u[i]||jQuery.style(e,i),i in u||(u[i]=f.start,m&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.0",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function it(e){return Q.test(e+"")}function st(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function ot(e){return e[y]=!0,e}function ut(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function at(e,t,n,r){var i,s,o,u,a,f,h,v,m,E;(t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(p&&!r){if(i=G.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return D.apply(n,t.getElementsByTagName(e)),n;if((o=i[3])&&w.getElementsByClassName&&t.getElementsByClassName)return D.apply(n,t.getElementsByClassName(o)),n}if(w.qsa&&(!d||!d.test(e))){v=h=y,m=t,E=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=vt(e),(h=t.getAttribute("id"))?v=h.replace(et,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+mt(f[a]);m=X.test(e)&&t.parentNode||t,E=f.join(",")}if(E)try{return D.apply(n,m.querySelectorAll(E)),n}catch(S){}finally{h||t.removeAttribute("id")}}}return Tt(e.replace(U,"$1"),t,n,r)}function ft(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function lt(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}function ct(e,n,r){var i;return r?t:i=e.getAttribute(n,n.toLowerCase()==="type"?1:2)}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function dt(e){return ot(function(t){return t=+t,ot(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(e,t){var n,r,s,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=z.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=W.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(U," ")}),u=u.slice(n.length);for(o in i.filter)(r=K[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?at.error(e):T(e,a).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var i=t.dir,s=n&&i==="parentNode",o=S++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[y]||(t[y]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function wt(e,t,n,r,i,s){return r&&!r[y]&&(r=wt(r)),i&&!i[y]&&(i=wt(i,s)),ot(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||xt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?bt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=bt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?H.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=bt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):D.apply(o,g)})}function Et(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],f=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return H.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==a)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++)if(n=i.relative[e[f].type])h=[gt(yt(h),n)];else{n=i.filter[e[f].type].apply(null,e[f].matches);if(n[y]){r=++f;for(;r<s;r++)if(i.relative[e[r].type])break;return wt(f>1&&yt(h),f>1&&mt(e.slice(0,f-1)).replace(U,"$1"),n,f<r&&Et(e.slice(f,r)),r<s&&Et(e=e.slice(r)),r<s&&mt(e))}h.push(n)}return yt(h)}function St(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,f,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=a,T=u||o&&i.find.TAG("*",p&&f.parentNode||f),N=E+=x==null?1:Math.random()||.1;S&&(a=f!==c&&f,r=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,f,l)){h.push(d);break}S&&(E=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){v=0;while(m=t[v++])m(w,g,f,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=M.call(h));g=bt(g)}D.apply(h,g),S&&!u&&g.length>0&&y+t.length>1&&at.uniqueSort(h)}return S&&(E=N,a=x),w};return s?ot(u):u}function xt(e,t,n){var r=0,i=t.length;for(;r<i;r++)at(e,t[r],n);return n}function Tt(e,t,n,r){var s,o,a,f,l,c=vt(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&p&&i.relative[o[1].type]){t=(i.find.ID(a.matches[0].replace(tt,nt),t)||[])[0];if(!t)return n;e=e.slice(o.shift().value.length)}s=K.needsContext.test(e)?0:o.length;while(s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(tt,nt),X.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&mt(o);if(!e)return D.apply(n,r),n;break}}}return u(e,c)(r,t,!p,n,X.test(e)),n}function Nt(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w={},E=0,S=0,x=st(),T=st(),N=st(),C=!1,k=function(){return 0},L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.push,P=O.slice,H=O.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",I=F.replace("w","w#"),q="\\["+j+"*("+F+")"+j+"*(?:([*^$|!~]?=)"+j+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+I+")|)|)"+j+"*\\]",R=":("+F+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+q.replace(3,8)+")*)|.*)\\)|)",U=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),z=new RegExp("^"+j+"*,"+j+"*"),W=new RegExp("^"+j+"*([>+~]|"+j+")"+j+"*"),X=new RegExp(j+"*[+~]"),V=new RegExp("="+j+"*([^\\]'\"]*)"+j+"*\\]","g"),$=new RegExp(R),J=new RegExp("^"+I+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),"boolean":new RegExp("^(?:"+B+")$","i"),needsContext:new RegExp("^"+j+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+j+"*((?:-\\d)?\\d*)"+j+"*\\)|)(?=[^-]|$)","i")},Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,et=/'|\\/g,tt=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,nt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{D.apply(O=P.call(b.childNodes),b.childNodes),O[b.childNodes.length].nodeType}catch(rt){D={apply:O.length?function(e,t){_.apply(e,P.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}o=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=at.setDocument=function(e){var n=e?e.ownerDocument||e:b;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=!o(n),w.getElementsByTagName=ut(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),w.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),w.sortDetached=ut(function(e){return e.compareDocumentPosition(c.createElement("div"))&1}),w.getById=ut(function(e){return h.appendChild(e).id=y,!n.getElementsByName||!n.getElementsByName(y).length}),w.getById?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(tt,nt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(tt,nt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=w.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},i.find.CLASS=w.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&p)return t.getElementsByClassName(e)},v=[],d=[];if(w.qsa=it(n.querySelectorAll))ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+j+"*(?:value|"+B+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ut(function(e){var t=c.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+j+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(w.matchesSelector=it(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ut(function(e){w.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",R)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),g=it(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=h.compareDocumentPosition?function(e,t){if(e===t)return C=!0,0;var r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);if(r)return r&1||!w.sortDetached&&t.compareDocumentPosition(e)===r?e===n||g(b,e)?-1:t===n||g(b,t)?1:f?H.call(f,e)-H.call(f,t):0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(e===t)return C=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:f?H.call(f,e)-H.call(f,t):0;if(s===o)return ft(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?ft(u[i],a[i]):u[i]===b?-1:a[i]===b?1:0},c},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(V,"='$1']");if(w.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t)))try{var n=m.call(e,t);if(n||w.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return at(t,c,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},at.attr=function(e,n){(e.ownerDocument||e)!==c&&l(e);var r=i.attrHandle[n.toLowerCase()],s=r&&r(e,n,!p);return s===t?w.attributes||!p?e.getAttribute(n):(s=e.getAttributeNode(n))&&s.specified?s.value:null:s},at.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],r=0,i=0;C=!w.detectDuplicates,f=!w.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return e},s=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=at.selectors={cacheLength:50,createPseudo:ot,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(tt,nt),e[3]=(e[4]||e[5]||"").replace(tt,nt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return K.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&$.test(n)&&(t=vt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(tt,nt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+j+")"+e+"("+j+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){b&&((c[y]||(c[y]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[y]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?ot(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=H.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ot(function(e){var t=[],n=[],r=u(e.replace(U,"$1"));return r[y]?ot(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ot(function(e){return function(t){return at(e,t).length>0}}),contains:ot(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:ot(function(e){return J.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(tt,nt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return Y.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[n<0?n+t:n]}),even:dt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:dt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ht(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=pt(n);u=at.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=vt(e)),n=t.length;while(n--)s=Et(t[n]),s[y]?r.push(s):i.push(s);s=N(e,St(i,r))}return s},i.pseudos.nth=i.pseudos.eq,Nt.prototype=i.filters=i.pseudos,i.setFilters=new Nt,w.sortStable=y.split("").sort(k).join("")===y,l(),[0,0].sort(k),w.detectDuplicates=C,ut(function(e){e.innerHTML="<a href='#'></a>";if(e.firstChild.getAttribute("href")!=="#"){var t="type|href|height|width".split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=ct}}),ut(function(e){if(e.getAttribute("disabled")!=null){var t=B.split("|"),n=t.length;while(n--)i.attrHandle[t[n]]=lt}}),jQuery.find=at,jQuery.expr=at.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=at.uniqueSort,jQuery.text=at.getText,jQuery.isXMLDoc=at.isXML,jQuery.contains=at.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],u&&(!n||a)&&(r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))this.cache[i]=t;else for(r in t)s[r]=t[r]},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){return t===undefined||t&&typeof t=="string"&&n===undefined?this.get(e,t):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i=this.key(e),s=this.cache[i];if(t===undefined)this.cache[i]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):t in s?r=[t]:(r=jQuery.camelCase(t),r=r in s?[r]:r.match(core_rnotwhite)||[]),n=r.length;while(n--)delete s[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){delete this.cache[this.key(e)]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.substring(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),s.cur=i,i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\t\r\n]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=jQuery(this),u=t,a=e.match(core_rnotwhite)||[];while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i,s=jQuery(this);if(this.nodeType!==1)return;r?i=e.call(this,n,s.val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.boolean.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.boolean.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.boolean.source.match(/\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\[\.,]*$/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n,r,i=this.length;if(typeof e!="string")return t=this,this.pushStack(jQuery(e).filter(function(){for(r=0;r<i;r++)if(jQuery.contains(t[r],this))return!0}));n=[];for(r=0;r<i;r++)jQuery.find(e,this[r],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!e&&(typeof e=="string"?rneedsContext.test(e)?jQuery(e,this.context).index(this[0])>=0:jQuery.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return jQuery.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),e[0]==="p"&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.col=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.firstChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i=e.length,s=0,o=jQuery.event.special;for(;s<i;s++){n=e[s];if(jQuery.acceptData(n)){t=data_priv.access(n);if(t)for(r in t.events)o[r]?jQuery.event.remove(n,r):jQuery.removeEvent(n,r,t.handle)}data_user.discard(n),data_priv.discard(n)}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"text",async:!1,global:!1,success:jQuery.globalEval})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:isHidden(this))?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=rfxnum.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(jQuery.cssNumber[e]?"":"px");if(r!=="px"&&u){u=jQuery.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,jQuery.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);o.finish=function(){t.stop(!0)},(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)})(window),module.exports=window.jQuery},"spine/index":function(e,t,n){n.exports=t("./lib/spine")},"spine/lib/spine":function(e,t,n){(function(){var e,t,r,i,s,o,u,a,f,l,c,h,p=[].slice,d=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},v={}.hasOwnProperty,m=function(e,t){function r(){this.constructor=e}for(var n in t)v.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},g=function(e,t){return function(){return e.apply(t,arguments)}};r={bind:function(e,t){var n,r,i,s,o;r=e.split(" "),n=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(s=0,o=r.length;s<o;s++)i=r[s],n[i]||(n[i]=[]),n[i].push(t);return this},one:function(e,t){var n;return this.bind(e,n=function(){return this.unbind(e,n),t.apply(this,arguments)})},trigger:function(){var e,t,n,r,i,s,o;e=1<=arguments.length?p.call(arguments,0):[],n=e.shift(),r=this.hasOwnProperty("_callbacks")&&((o=this._callbacks)!=null?o[n]:void 0);if(!r)return;for(i=0,s=r.length;i<s;i++){t=r[i];if(t.apply(this,e)===!1)break}return!0},listenTo:function(e,t,n){return e.bind(t,n),this.listeningTo||(this.listeningTo=[]),this.listeningTo.push(e),this},listenToOnce:function(e,t,n){var r;return r=this.listeningToOnce||(this.listeningToOnce=[]),r.push(e),e.one(t,function(){var t;return t=r.indexOf(e),t!==-1&&r.splice(t,1),n.apply(this,arguments)}),this},stopListening:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,v;if(arguments.length===0){s=[],h=[this.listeningTo,this.listeningToOnce];for(o=0,f=h.length;o<f;o++){i=h[o];if(!i)continue;for(u=0,l=i.length;u<l;u++){e=i[u];if(d.call(s,e)>=0)continue;e.unbind(),s.push(e)}}return this.listeningTo=void 0,this.listeningToOnce=void 0}if(e){t&&e.unbind(t,n),t||e.unbind(),p=[this.listeningTo,this.listeningToOnce],v=[];for(a=0,c=p.length;a<c;a++){i=p[a];if(!i)continue;r=i.indexOf(e),r!==-1?v.push(i.splice(r,1)):v.push(void 0)}return v}},unbind:function(e,t){var n,r,i,s,o,u,a,f,l,c;if(arguments.length===0)return this._callbacks={},this;if(!e)return this;r=e.split(" ");for(u=0,f=r.length;u<f;u++){o=r[u],s=(c=this._callbacks)!=null?c[o]:void 0;if(!s)continue;if(!t){delete this._callbacks[o];continue}for(i=a=0,l=s.length;a<l;i=++a){n=s[i];if(n!==t)continue;s=s.slice(),s.splice(i,1),this._callbacks[o]=s;break}}return this}},r.on=r.bind,r.off=r.unbind,i={trace:!0,logPrefix:"(App)",log:function(){var e;e=1<=arguments.length?p.call(arguments,0):[];if(!this.trace)return;return this.logPrefix&&e.unshift(this.logPrefix),typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log.apply(console,e),this}},h=["included","extended"],o=function(){function e(){typeof this.init=="function"&&this.init.apply(this,arguments)}return e.include=function(e){var t,n,r;if(!e)throw new Error("include(obj) requires obj");for(t in e)n=e[t],d.call(h,t)<0&&(this.prototype[t]=n);return(r=e.included)!=null&&r.apply(this),this},e.extend=function(e){var t,n,r;if(!e)throw new Error("extend(obj) requires obj");for(t in e)n=e[t],d.call(h,t)<0&&(this[t]=n);return(r=e.extended)!=null&&r.apply(this),this},e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e}(),s=function(t){function n(e){n.__super__.constructor.apply(this,arguments),e&&this.load(e),this.cid=this.constructor.uid("c-")}return m(n,t),n.extend(r),n.records=[],n.irecords={},n.crecords={},n.attributes=[],n.configure=function(){var e,t;return t=arguments[0],e=2<=arguments.length?p.call(arguments,1):[],this.className=t,this.deleteAll(),e.length&&(this.attributes=e),this.attributes&&(this.attributes=c(this.attributes)),this.attributes||(this.attributes=[]),this.unbind(),this},n.toString=function(){return""+this.className+"("+this.attributes.join(", ")+")"},n.find=function(e){var t;t=this.exists(e);if(!t)throw new Error('"'+this.className+'" model could not find a record for the ID "'+e+'"');return t},n.exists=function(e){var t,n;return(t=(n=this.irecords[e])!=null?n:this.crecords[e])!=null?t.clone():void 0},n.refresh=function(e,t){var n,r,i,s,o;t==null&&(t={}),t.clear&&this.deleteAll(),r=this.fromJSON(e),f(r)||(r=[r]);for(s=0,o=r.length;s<o;s++)n=r[s],n.id&&this.irecords[n.id]?this.records[this.records.indexOf(this.irecords[n.id])]=n:(n.id||(n.id=n.cid),this.records.push(n)),this.irecords[n.id]=n,this.crecords[n.cid]=n;return this.sort(),i=this.cloneArray(r),this.trigger("refresh",this.cloneArray(r)),i},n.select=function(e){var t,n,r,i,s;i=this.records,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],e(t)&&s.push(t.clone());return s},n.findByAttribute=function(e,t){var n,r,i,s;s=this.records;for(r=0,i=s.length;r<i;r++){n=s[r];if(n[e]===t)return n.clone()}return null},n.findAllByAttribute=function(e,t){return this.select(function(n){return n[e]===t})},n.each=function(e){var t,n,r,i,s;i=this.records,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(e(t.clone()));return s},n.all=function(){return this.cloneArray(this.records)},n.first=function(){var e;return(e=this.records[0])!=null?e.clone():void 0},n.last=function(){var e;return(e=this.records[this.records.length-1])!=null?e.clone():void 0},n.count=function(){return this.records.length},n.deleteAll=function(){return this.records=[],this.irecords={},this.crecords={}},n.destroyAll=function(e){var t,n,r,i,s;i=this.records,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.destroy(e));return s},n.update=function(e,t,n){return this.find(e).updateAttributes(t,n)},n.create=function(e,t){var n;return n=new this(e),n.save(t)},n.destroy=function(e,t){return this.find(e).destroy(t)},n.change=function(e){return typeof e=="function"?this.bind("change",e):this.trigger.apply(this,["change"].concat(p.call(arguments)))},n.fetch=function(e){return typeof e=="function"?this.bind("fetch",e):this.trigger.apply(this,["fetch"].concat(p.call(arguments)))},n.toJSON=function(){return this.records},n.fromJSON=function(e){var t,n,r,i;if(!e)return;typeof e=="string"&&(e=JSON.parse(e));if(f(e)){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(new this(t));return i}return new this(e)},n.fromForm=function(){var e;return(e=new this).fromForm.apply(e,arguments)},n.sort=function(){return this.comparator&&this.records.sort(this.comparator),this.records},n.cloneArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t.clone());return i},n.idCounter=0,n.uid=function(e){var t;return e==null&&(e=""),t=e+this.idCounter++,this.exists(t)&&(t=this.uid(e)),t},n.prototype.isNew=function(){return!this.exists()},n.prototype.isValid=function(){return!this.validate()},n.prototype.validate=function(){},n.prototype.load=function(e){var t,n;e.id&&(this.id=e.id);for(t in e)n=e[t],e.hasOwnProperty(t)&&typeof this[t]=="function"?this[t](n):this[t]=n;return this},n.prototype.attributes=function(){var e,t,n,r,i;t={},i=this.constructor.attributes;for(n=0,r=i.length;n<r;n++)e=i[n],e in this&&(typeof this[e]=="function"?t[e]=this[e]():t[e]=this[e]);return this.id&&(t.id=this.id),t},n.prototype.eql=function(e){return!!(e&&e.constructor===this.constructor&&e.cid===this.cid||e.id&&e.id===this.id)},n.prototype.save=function(e){var t,n;e==null&&(e={});if(e.validate!==!1){t=this.validate();if(t)return this.trigger("error",t),!1}return this.trigger("beforeSave",e),n=this.isNew()?this.create(e):this.update(e),this.stripCloneAttrs(),this.trigger("save",e),n},n.prototype.stripCloneAttrs=function(){var e,t;if(this.hasOwnProperty("cid"))return;for(e in this){if(!v.call(this,e))continue;t=this[e],this.constructor.attributes.indexOf(e)>-1&&delete this[e]}return this},n.prototype.updateAttribute=function(e,t,n){var r;return r={},r[e]=t,this.updateAttributes(r,n)},n.prototype.updateAttributes=function(e,t){return this.load(e),this.save(t)},n.prototype.changeID=function(e){var t;return t=this.constructor.irecords,t[e]=t[this.id],delete t[this.id],this.id=e,this.save()},n.prototype.destroy=function(e){var t,n,r,i,s;e==null&&(e={}),this.trigger("beforeDestroy",e),r=this.constructor.records.slice(0);for(t=i=0,s=r.length;i<s;t=++i){n=r[t];if(!this.eql(n))continue;r.splice(t,1);break}return this.constructor.records=r,delete this.constructor.irecords[this.id],delete this.constructor.crecords[this.cid],this.destroyed=!0,this.trigger("destroy",e),this.trigger("change","destroy",e),this.listeningTo&&this.stopListening(),this.unbind(),this},n.prototype.dup=function(e){var t;return t=new this.constructor(this.attributes()),e===!1?t.cid=this.cid:delete t.id,t},n.prototype.clone=function(){return a(this)},n.prototype.reload=function(){var e;return this.isNew()?this:(e=this.constructor.find(this.id),this.load(e.attributes()),e)},n.prototype.toJSON=function(){return this.attributes()},n.prototype.toString=function(){return"<"+this.constructor.className+" ("+JSON.stringify(this)+")>"},n.prototype.fromForm=function(t){var n,r,i,s,o;r={},o=e(t).serializeArray();for(i=0,s=o.length;i<s;i++)n=o[i],r[n.name]=n.value;return this.load(r)},n.prototype.exists=function(){return this.constructor.exists(this.id)},n.prototype.update=function(e){var t,n;return this.trigger("beforeUpdate",e),n=this.constructor.irecords,n[this.id].load(this.attributes()),this.constructor.sort(),t=n[this.id].clone(),t.trigger("update",e),t.trigger("change","update",e),t},n.prototype.create=function(e){var t,n;return this.trigger("beforeCreate",e),this.id||(this.id=this.cid),n=this.dup(!1),this.constructor.records.push(n),this.constructor.irecords[this.id]=n,this.constructor.crecords[this.cid]=n,this.constructor.sort(),t=n.clone(),t.trigger("create",e),t.trigger("change","create",e),t},n.prototype.bind=function(e,t){var n,r,i,s,o,u,a=this;this.constructor.bind(e,n=function(e){if(e&&a.eql(e))return t.apply(a,arguments)}),u=e.split(" "),i=function(e){var r;return a.constructor.bind("unbind",r=function(i,s,o){if(i&&a.eql(i)){if(s&&s!==e)return;if(o&&o!==t)return;return a.constructor.unbind(e,n),a.constructor.unbind("unbind",r)}})};for(s=0,o=u.length;s<o;s++)r=u[s],i(r);return this},n.prototype.one=function(e,t){var n,r=this;return this.bind(e,n=function(){return r.unbind(e,n),t.apply(r,arguments)})},n.prototype.trigger=function(){var e,t;return e=1<=arguments.length?p.call(arguments,0):[],e.splice(1,0,this),(t=this.constructor).trigger.apply(t,e)},n.prototype.listenTo=function(e,t,n){return e.bind(t,n),this.listeningTo||(this.listeningTo=[]),this.listeningTo.push(e)},n.prototype.listenToOnce=function(e,t,n){var r,i,s=this;return i=this.listeningToOnce||(this.listeningToOnce=[]),i.push(e),e.bind(t,r=function(){var s;return s=i.indexOf(e),s!==-1&&i.splice(s,1),e.unbind(t,r),n.apply(e,arguments)})},n.prototype.stopListening=function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,v,m;if(arguments.length===0){s=[],h=[this.listeningTo,this.listeningToOnce];for(o=0,f=h.length;o<f;o++){i=h[o];if(!i)continue;p=this.listeningTo;for(u=0,l=p.length;u<l;u++){e=p[u];if(d.call(s,e)>=0)continue;e.unbind(),s.push(e)}}this.listeningTo=void 0,this.listeningToOnce=void 0;return}if(e){t||e.unbind(),t&&e.unbind(t,n),v=[this.listeningTo,this.listeningToOnce],m=[];for(a=0,c=v.length;a<c;a++){i=v[a];if(!i)continue;r=i.indexOf(e),r!==-1?m.push(i.splice(r,1)):m.push(void 0)}return m}},n.prototype.unbind=function(e,t){var n,r,i,s,o;if(arguments.length===0)return this.trigger("unbind");if(e){s=e.split(" "),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(this.trigger("unbind",n,t));return o}},n}(o),s.prototype.on=s.prototype.bind,s.prototype.off=s.prototype.unbind,t=function(t){function n(t){this.release=g(this.release,this);var r,i,s,o,u;this.options=t,u=this.options;for(i in u)o=u[i],this[i]=o;this.el||(this.el=document.createElement(this.tag)),this.el=e(this.el),this.$el=this.el,this.className&&this.el.addClass(this.className),this.attributes&&this.el.attr(this.attributes),this.events||(this.events=this.constructor.events),this.elements||(this.elements=this.constructor.elements),r=this;while(s=r.constructor.__super__)s.events&&(this.events=e.extend({},s.events,this.events)),s.elements&&(this.elements=e.extend({},s.elements,this.elements)),r=s;this.events&&this.delegateEvents(this.events),this.elements&&this.refreshElements(),n.__super__.constructor.apply(this,arguments)}return m(n,t),n.include(r),n.include(i),n.prototype.eventSplitter=/^(\S+)\s*(.*)$/,n.prototype.tag="div",n.prototype.release=function(){return this.trigger("release",this),this.el.remove(),this.unbind(),this.stopListening()},n.prototype.$=function(t){return e(t,this.el)},n.prototype.delegateEvents=function(e){var t,n,r,i,s,o,u=this;o=[];for(n in e){i=e[n];if(typeof i=="function")i=function(e){return function(){return e.apply(u,arguments),!0}}(i);else{if(!this[i])throw new Error(""+i+" doesn't exist");i=function(e){return function(){return u[e].apply(u,arguments),!0}}(i)}r=n.match(this.eventSplitter),t=r[1],s=r[2],s===""?o.push(this.el.bind(t,i)):o.push(this.el.delegate(s,t,i))}return o},n.prototype.refreshElements=function(){var e,t,n,r;n=this.elements,r=[];for(e in n)t=n[e],r.push(this[t]=this.$(e));return r},n.prototype.delay=function(e,t){return setTimeout(this.proxy(e),t||0)},n.prototype.html=function(e){return this.el.html(e.el||e),this.refreshElements(),this.el},n.prototype.append=function(){var e,t,n;return t=1<=arguments.length?p.call(arguments,0):[],t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(e.el||e);return i}(),(n=this.el).append.apply(n,t),this.refreshElements(),this.el},n.prototype.appendTo=function(e){return this.el.appendTo(e.el||e),this.refreshElements(),this.el},n.prototype.prepend=function(){var e,t,n;return t=1<=arguments.length?p.call(arguments,0):[],t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(e.el||e);return i}(),(n=this.el).prepend.apply(n,t),this.refreshElements(),this.el},n.prototype.replace=function(t){var n,r;return r=[this.el,e(t.el||t)],n=r[0],this.el=r[1],n.replaceWith(this.el),this.delegateEvents(this.events),this.refreshElements(),this.el},n}(o),e=(typeof window!="undefined"&&window!==null?window.jQuery:void 0)||(typeof window!="undefined"&&window!==null?window.Zepto:void 0)||function(e){return e},a=Object.create||function(e){var t;return t=function(){},t.prototype=e,new t},f=function(e){return Object.prototype.toString.call(e)==="[object Array]"},l=function(e){var t;if(!e)return!0;for(t in e)return!1;return!0},c=function(e){return Array.prototype.slice.call(e,0)},u=this.Spine={},typeof n!="undefined"&&n!==null&&(n.exports=u),u.version="1.1.0",u.isArray=f,u.isBlank=l,u.$=e,u.Events=r,u.Log=i,u.Module=o,u.Controller=t,u.Model=s,o.extend.call(u,r),o.create=o.sub=t.create=t.sub=s.sub=function(e,t){var n,r;return n=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return m(t,e),t}(this),e&&n.include(e),t&&n.extend(t),typeof n.unbind=="function"&&n.unbind(),n},s.setup=function(e,t){var n,r;return t==null&&(t=[]),n=function(e){function t(){return r=t.__super__.constructor.apply(this,arguments),r}return m(t,e),t}(this),n.configure.apply(n,[e].concat(p.call(t))),n},u.Class=o}).call(this)},"spine/lib/local":function(e,t,n){(function(){var e;e=this.Spine||t("spine"),e.Model.Local={extended:function(){return this.change(this.saveLocal),this.fetch(this.loadLocal)},saveLocal:function(){var e;return e=JSON.stringify(this),localStorage[this.className]=e},loadLocal:function(){var e;return e=localStorage[this.className],this.refresh(e||[],{clear:!0})}},typeof n!="undefined"&&n!==null&&(n.exports=e.Model.Local)}).call(this)},"spine/lib/ajax":function(e,t,n){(function(){var e,r,i,s,o,u,a,f,l,c,h=[].slice,p=function(e,t){return function(){return e.apply(t,arguments)}},d={}.hasOwnProperty,v=function(e,t){function r(){this.constructor=e}for(var n in t)d.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};c=this.Spine||t("spine"),e=c.$,a=c.Model,f=e({}),r={getURL:function(e){return(typeof e.url=="function"?e.url():void 0)||e.url},getScope:function(e){return(typeof e.scope=="function"?e.scope():void 0)||e.scope},generateURL:function(){var e,t,n,i,s;return n=arguments[0],e=2<=arguments.length?h.call(arguments,1):[],n.className?(t=n.className.toLowerCase()+"s",s=r.getScope(n)):(typeof n.constructor.url=="string"?t=n.constructor.url:t=n.constructor.className.toLowerCase()+"s",s=r.getScope(n)||r.getScope(n.constructor)),e.unshift(t),e.unshift(s),i=e.join("/"),i=i.replace(/(\/\/)/g,"/"),i=i.replace(/^\/|\/$/g,""),i.indexOf("../")!==0?a.host+"/"+i:i},enabled:!0,disable:function(e){var t;if(!this.enabled)return e();this.enabled=!1;try{return e()}catch(n){throw t=n,t}finally{this.enabled=!0}},queue:function(e){return e?f.queue(e):f.queue()},clearQueue:function(){return this.queue([])}},i=function(){function t(){}return t.prototype.defaults={dataType:"json",processData:!1,headers:{"X-Requested-With":"XMLHttpRequest"}},t.prototype.queue=r.queue,t.prototype.ajax=function(t,n){return e.ajax(this.ajaxSettings(t,n))},t.prototype.ajaxQueue=function(t,n){var i,s,o,u,a;return s=null,i=e.Deferred(),o=i.promise(),r.enabled?(a=this.ajaxSettings(t,n),u=function(t){return s=e.ajax(a).done(i.resolve).fail(i.reject).then(t,t)},o.abort=function(t){var n;return s?s.abort(t):(n=e.inArray(u,this.queue()),n>-1&&this.queue().splice(n,1),i.rejectWith(a.context||a,[o,t,""]),o)},this.queue(u),o):o},t.prototype.ajaxSettings=function(t,n){return e.extend({},this.defaults,n,t)},t}(),s=function(e){function t(e){this.model=e,this.failResponse=p(this.failResponse,this),this.recordsResponse=p(this.recordsResponse,this)}return v(t,e),t.prototype.find=function(e,t){var n;return n=new this.model({id:e}),this.ajaxQueue(t,{type:"GET",url:r.getURL(n)}).done(this.recordsResponse).fail(this.failResponse)},t.prototype.all=function(e){return this.ajaxQueue(e,{type:"GET",url:r.getURL(this.model)}).done(this.recordsResponse).fail(this.failResponse)},t.prototype.fetch=function(e,t){var n,r=this;return e==null&&(e={}),t==null&&(t={}),(n=e.id)?(delete e.id,this.find(n,e).done(function(e){return r.model.refresh(e,t)})):this.all(e).done(function(e){return r.model.refresh(e,t)})},t.prototype.recordsResponse=function(e,t,n){return this.model.trigger("ajaxSuccess",null,t,n)},t.prototype.failResponse=function(e,t,n){return this.model.trigger("ajaxError",null,e,t,n)},t}(i),l=function(e){function t(e){this.record=e,this.failResponse=p(this.failResponse,this),this.recordResponse=p(this.recordResponse,this),this.model=this.record.constructor}return v(t,e),t.prototype.reload=function(e,t){return this.ajaxQueue(e,{type:"GET",url:r.getURL(this.record)}).done(this.recordResponse(t)).fail(this.failResponse(t))},t.prototype.create=function(e,t){return this.ajaxQueue(e,{type:"POST",contentType:"application/json",data:JSON.stringify(this.record),url:r.getURL(this.model)}).done(this.recordResponse(t)).fail(this.failResponse(t))},t.prototype.update=function(e,t){return this.ajaxQueue(e,{type:"PUT",contentType:"application/json",data:JSON.stringify(this.record),url:r.getURL(this.record)}).done(this.recordResponse(t)).fail(this.failResponse(t))},t.prototype.destroy=function(e,t){return this.ajaxQueue(e,{type:"DELETE",url:r.getURL(this.record)}).done(this.recordResponse(t)).fail(this.failResponse(t))},t.prototype.recordResponse=function(e){var t=this;return e==null&&(e={}),function(n,i,s){var o,u;return c.isBlank(n)||t.record.destroyed?n=!1:n=t.model.fromJSON(n),r.disable(function(){if(n)return n.id&&t.record.id!==n.id&&t.record.changeID(n.id),t.record.updateAttributes(n.attributes())}),t.record.trigger("ajaxSuccess",n,i,s),(o=e.success)!=null&&o.apply(t.record),(u=e.done)!=null?u.apply(t.record):void 0}},t.prototype.failResponse=function(e){var t=this;return e==null&&(e={}),function(n,r,i){var s,o;return t.record.trigger("ajaxError",n,r,i),(s=e.error)!=null&&s.apply(t.record),(o=e.fail)!=null?o.apply(t.record):void 0}},t}(i),a.host="",u={ajax:function(){return new l(this)},url:function(){var e;return e=1<=arguments.length?h.call(arguments,0):[],e.unshift(encodeURIComponent(this.id)),r.generateURL.apply(r,[this].concat(h.call(e)))}},o={ajax:function(){return new s(this)},url:function(){var e;return e=1<=arguments.length?h.call(arguments,0):[],r.generateURL.apply(r,[this].concat(h.call(e)))}},a.Ajax={extended:function(){return this.fetch(this.ajaxFetch),this.change(this.ajaxChange),this.extend(o),this.include(u)},ajaxFetch:function(){var e;return(e=this.ajax()).fetch.apply(e,arguments)},ajaxChange:function(e,t,n){n==null&&(n={});if(n.ajax===!1)return;return e.ajax()[t](n.ajax,n)}},a.Ajax.Methods={extended:function(){return this.extend(o),this.include(u)}},r.defaults=i.prototype.defaults,c.Ajax=r,typeof n!="undefined"&&n!==null&&(n.exports=r)}).call(this)},"spine/lib/route":function(e,t,n){(function(){var e,r,i,s,o,u,a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},l=[].slice;r=this.Spine||t("spine"),e=r.$,s=/^#*/,o=/:([\w\d]+)/g,u=/\*([\w\d]+)/g,i=/[-[\]{}()+?.,\\^$|#\s]/g,r.Route=function(t){function a(e,t){var n;this.path=e,this.callback=t,this.names=[];if(typeof e=="string"){o.lastIndex=0;while((n=o.exec(e))!==null)this.names.push(n[1]);u.lastIndex=0;while((n=u.exec(e))!==null)this.names.push(n[1]);e=e.replace(i,"\\$&").replace(o,"([^/]*)").replace(u,"(.*?)"),this.route=new RegExp("^"+e+"$")}else this.route=e}var n;return f(a,t),a.extend(r.Events),a.historySupport=((n=window.history)!=null?n.pushState:void 0)!=null,a.routes=[],a.options={trigger:!0,history:!1,shim:!1,replace:!1},a.add=function(e,t){var n,r,i;if(typeof e!="object"||e instanceof RegExp)return this.routes.push(new this(e,t));i=[];for(n in e)r=e[n],i.push(this.add(n,r));return i},a.setup=function(t){t==null&&(t={}),this.options=e.extend({},this.options,t),this.options.history&&(this.history=this.historySupport&&this.options.history);if(this.options.shim)return;return this.history?e(window).bind("popstate",this.change):e(window).bind("hashchange",this.change),this.change()},a.unbind=function(){if(this.options.shim)return;return this.history?e(window).unbind("popstate",this.change):e(window).unbind("hashchange",this.change)},a.navigate=function(){var t,n,r,i;t=1<=arguments.length?l.call(arguments,0):[],r={},n=t[t.length-1],typeof n=="object"?r=t.pop():typeof n=="boolean"&&(r.trigger=t.pop()),r=e.extend({},this.options,r),i=t.join("/");if(this.path===i)return;this.path=i,this.trigger("navigate",this.path),r.trigger&&this.matchRoute(this.path,r);if(r.shim)return;return this.history&&r.replace?history.replaceState({},document.title,this.path):this.history?history.pushState({},document.title,this.path):window.location.hash=this.path},a.getPath=function(){var e;return this.history?(e=window.location.pathname,e.substr(0,1)!=="/"&&(e="/"+e)):(e=window.location.hash,e=e.replace(s,"")),e},a.getHost=function(){return""+window.location.protocol+"//"+window.location.host},a.change=function(){var e;e=this.getPath();if(e===this.path)return;return this.path=e,this.matchRoute(this.path)},a.matchRoute=function(e,t){var n,r,i,s;s=this.routes;for(r=0,i=s.length;r<i;r++){n=s[r];if(!n.match(e,t))continue;return this.trigger("change",n,e),n}},a.prototype.match=function(e,t){var n,r,i,s,o,u;t==null&&(t={}),r=this.route.exec(e);if(!r)return!1;t.match=r,s=r.slice(1);if(this.names.length)for(n=o=0,u=s.length;o<u;n=++o)i=s[n],t[this.names[n]]=i;return this.callback.call(null,t)!==!1},a}(r.Module),r.Route.change=r.Route.proxy(r.Route.change),r.Controller.include({route:function(e,t){return r.Route.add(e,this.proxy(t))},routes:function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.route(t,n));return r},navigate:function(){return r.Route.navigate.apply(r.Route,arguments)}}),typeof n!="undefined"&&n!==null&&(n.exports=r.Route)}).call(this)},"spine/lib/manager":function(e,t,n){(function(){var e,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},o=[].slice;r=this.Spine||t("spine"),e=r.$,r.Manager=function(e){function t(){this.controllers=[],this.bind("change",this.change),this.add.apply(this,arguments)}return s(t,e),t.include(r.Events),t.prototype.add=function(){var e,t,n,r,i;t=1<=arguments.length?o.call(arguments,0):[],i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(this.addOne(e));return i},t.prototype.addOne=function(e){var t=this;return e.bind("active",function(){var n;return n=1<=arguments.length?o.call(arguments,0):[],t.trigger.apply(t,["change",e].concat(o.call(n)))}),e.bind("release",function(){return t.controllers.splice(t.controllers.indexOf(e),1)}),this.controllers.push(e)},t.prototype.deactivate=function(){return this.trigger.apply(this,["change",!1].concat(o.call(arguments)))},t.prototype.change=function(){var e,t,n,r,i,s,u;n=arguments[0],e=2<=arguments.length?o.call(arguments,1):[],s=this.controllers,u=[];for(r=0,i=s.length;r<i;r++)t=s[r],t===n?u.push(t.activate.apply(t,e)):u.push(t.deactivate.apply(t,e));return u},t}(r.Module),r.Controller.include({active:function(){var e;return e=1<=arguments.length?o.call(arguments,0):[],typeof e[0]=="function"?this.bind("active",e[0]):(e.unshift("active"),this.trigger.apply(this,e)),this},isActive:function(){return this.el.hasClass("active")},activate:function(){return this.el.addClass("active"),this},deactivate:function(){return this.el.removeClass("active"),this}}),r.Stack=function(e){function t(){var e,n,i,s,o,u=this;t.__super__.constructor.apply(this,arguments),this.manager=new r.Manager,s=this.controllers;for(e in s){n=s[e];if(this[e]!=null)throw Error("'@"+e+"' already assigned - choose a different name");this[e]=new n({stack:this}),this.add(this[e])}o=this.routes,i=function(e,t){var n;return typeof t=="function"&&(n=t),n||(n=function(){var e;return(e=u[t]).active.apply(e,arguments)}),u.route(e,n)};for(e in o)n=o[e],i(e,n);this["default"]&&this[this["default"]].active()}return s(t,e),t.prototype.controllers={},t.prototype.routes={},t.prototype.className="spine stack",t.prototype.add=function(e){return this.manager.add(e),this.append(e)},t}(r.Controller),typeof n!="undefined"&&n!==null&&(n.exports=r.Manager),typeof n!="undefined"&&n!==null&&(n.exports.Stack=r.Stack)}).call(this)},"spine/lib/relation":function(exports,require,module){(function(){var Collection,Instance,Singleton,Spine,association,isArray,require,singularize,underscore,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Spine=this.Spine||require("spine"),isArray=Spine.isArray,require=this.require||function(value){return eval(value)},Collection=function(e){function t(e){var t,n;e==null&&(e={});for(t in e)n=e[t],this[t]=n}return __extends(t,e),t.prototype.all=function(){var e=this;return this.model.select(function(t){return e.associated(t)})},t.prototype.first=function(){return this.all()[0]},t.prototype.last=function(){var e;return e=this.all(),e[e.length-1]},t.prototype.count=function(){return this.all().length},t.prototype.find=function(e){var t,n=this;t=this.select(function(t){return""+t.id==""+e});if(!t[0])throw new Error('"'+this.model.className+'" model could not find a record for the ID "'+e+'"');return t[0]},t.prototype.findAllByAttribute=function(e,t){var n=this;return this.model.select(function(r){return n.associated(r)&&r[e]===t})},t.prototype.findByAttribute=function(e,t){return this.findAllByAttribute(e,t)[0]},t.prototype.select=function(e){var t=this;return this.model.select(function(n){return t.associated(n)&&e(n)})},t.prototype.refresh=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(e==null)return this;l=this.all();for(i=0,u=l.length;i<u;i++){r=l[i],delete this.model.irecords[r.id],c=this.model.records;for(t=s=0,a=c.length;s<a;t=++s){n=c[t];if(n.id!==r.id)continue;this.model.records.splice(t,1);break}}isArray(e)||(e=[e]);for(o=0,f=e.length;o<f;o++)r=e[o],r.newRecord=!1,r[this.fkey]=this.record.id;return this.model.refresh(e),this},t.prototype.create=function(e,t){return e[this.fkey]=this.record.id,this.model.create(e,t)},t.prototype.add=function(e,t){return e.updateAttribute(this.fkey,this.record.id,t)},t.prototype.remove=function(e,t){return e.updateAttribute(this.fkey,null,t)},t.prototype.associated=function(e){return e[this.fkey]===this.record.id},t}(Spine.Module),Instance=function(e){function t(e){var t,n;e==null&&(e={});for(t in e)n=e[t],this[t]=n}return __extends(t,e),t.prototype.exists=function(){return this.record[this.fkey]?this.model.exists(this.record[this.fkey]):!1},t.prototype.update=function(e){return e==null?this:(e instanceof this.model||(e=new this.model(e)),e.isNew()&&e.save(),this.record[this.fkey]=e&&e.id,this)},t}(Spine.Module),Singleton=function(e){function t(e){var t,n;e==null&&(e={});for(t in e)n=e[t],this[t]=n}return __extends(t,e),t.prototype.find=function(){return this.record.id&&this.model.findByAttribute(this.fkey,this.record.id)},t.prototype.update=function(e){return e==null?this:(e instanceof this.model||(e=this.model.fromJSON(e)),e[this.fkey]=this.record.id,e.save(),this)},t}(Spine.Module),singularize=function(e){return e.replace(/s$/,"")},underscore=function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},association=function(e,t,n,r,i){return typeof t=="string"&&(t=require(t)),new i({name:e,model:t,record:n,fkey:r})},Spine.Model.extend({hasMany:function(e,t,n){return n==null&&(n=""+underscore(this.className)+"_id"),this.prototype[e]=function(r){return association(e,t,this,n,Collection).refresh(r)}},belongsTo:function(e,t,n){return n==null&&(n=""+underscore(singularize(e))+"_id"),this.prototype[e]=function(r){return association(e,t,this,n,Instance).update(r).exists()},this.attributes.push(n)},hasOne:function(e,t,n){return n==null&&(n=""+underscore(this.className)+"_id"),this.prototype[e]=function(r){return association(e,t,this,n,Singleton).update(r).find()}}}),Spine.Collection=Collection,Spine.Singleton=Singleton,Spine.Instance=Instance}).call(this)},"controllers/drawings":function(e,t,n){(function(){var e,r,i,s,o,u,a,f,l,c,h=function(e,t){return function(){return e.apply(t,arguments)}},p={}.hasOwnProperty,d=function(e,t){function r(){this.constructor=e}for(var n in t)p.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};u=t("models/palette_specification"),i=t("models/drawing"),Spine.SubStack=t("lib/substack"),e=t("views/drawings/canvas_renderer"),l=t("controllers/toolbox"),a=t("controllers/selection"),r=t("models/commands/commander"),o=function(e){function n(){this.extractFormData=h(this.extractFormData,this),this["delete"]=h(this["delete"],this),this.create=h(this.create,this),this.render=h(this.render,this),n.__super__.constructor.apply(this,arguments),this.active(this.render),i.bind("fetch",this.render)}return d(n,e),n.prototype.events={"submit form":"create","click .delete":"delete"},n.prototype.render=function(){var e;return e={drawings:i.all(),palette_specs:u.all()},this.html(t("views/drawings/index")(e))},n.prototype.create=function(e){var t,n,r;return e.preventDefault(),t=this.extractFormData($(e.target)),n=i.create({name:t.name}),n&&n.save()?(r=u.find(t.palette_specification_id).instantiate(),r.drawing_id=n.id,r.save(),this.navigate("/drawings",n.id)):this.$("input#name").focus()},n.prototype["delete"]=function(e){var t,n;return t=this.$(e.currentTarget),n=t.data("id"),i.destroy(n),this.render()},n.prototype.extractFormData=function(e){var t,n,r,i,s;n={},s=e.serializeArray();for(r=0,i=s.length;r<i;r++)t=s[r],n[t.name]=t.value;return n},n}(Spine.Controller),f=function(n){function s(){this.change=h(this.change,this),s.__super__.constructor.apply(this,arguments),this.active(this.change)}return d(s,n),s.prototype.change=function(e){return this.commander=new r,this.item=i.find(e.id),this.item.clearSelection(),this.log("Palette: "+this.item.palette().id),this.render()},s.prototype.render=function(){this.html(t("views/drawings/show"));if(this.item)return new e({drawing:this.item,canvas:this.$("#drawing")[0]}),this.toolbox=new l({commander:this.commander,item:this.item,el:this.$("#toolbox")}),this.selection=new a({commander:this.commander,item:this.item,el:this.$("#selection")})},s.prototype.deactivate=function(){s.__super__.deactivate.apply(this,arguments);if(this.toolbox)return this.toolbox.release()},s}(Spine.Controller),s=function(e){function t(){return c=t.__super__.constructor.apply(this,arguments),c}return d(t,e),t.prototype.controllers={index:o,show:f},t.prototype.routes={"/drawings":"index","/drawings/:id":"show"},t.prototype["default"]="index",t}(Spine.SubStack),n.exports=s}).call(this)},"controllers/link_tool":function(e,t,n){(function(){var e,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=t("controllers/tool"),r=t("models/link"),e=t("models/commands/create_link"),i=function(t){function r(){return o=r.__super__.constructor.apply(this,arguments),o}var n;return a(r,t),r.prototype.parameters={shape:null},r.prototype.drafting=!1,r.prototype.timer=0,r.prototype.onMouseMove=function(e){},r.prototype.onMouseDown=function(e){if(this.parameters.shape&&this.hitTester.nodeAt(e.point))return this.drafting=!0,this.draftLink=new n(e.point)},r.prototype.onMouseDrag=function(e){var t;t=(new Date).getTime();if(t-this.timer>90){this.timer=t;if(this.drafting){this.draftLink.extendTo(e.point);if(this.hitTester.nodeAt(e.point))return this.changeSelectionTo(this.hitTester.nodeAt(e.point))}}},r.prototype.onMouseUp=function(t){var n;if(this.drafting)return this.hitTester.nodeAt(t.point)&&(n=this.draftLink.finalise(),this.parameters.sourceId=this.hitTester.nodeAt(n.firstSegment.point).id,this.parameters.targetId=this.hitTester.nodeAt(n.lastSegment.point).id,this.parameters.segments=n.segments,this.run(new e(this.drawing,this.parameters))),this.draftLink.remove(),this.clearSelection(),this.drafting=!1},n=function(){function e(e){this.path=new paper.Path([e]),this.path.layer.insertChild(0,this.path),this.path.strokeColor="black",this.path.dashArray=[10,4]}return e.prototype.extendTo=function(e){return this.path.add(e)},e.prototype.finalise=function(){return this.path.simplify(100),this.path},e.prototype.remove=function(){return this.path.remove()},e}(),r}(s),n.exports=i}).call(this)},"controllers/node_tool":function(e,t,n){(function(){var e,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=t("controllers/tool"),e=t("models/commands/create_node"),r=function(t){function n(){return s=n.__super__.constructor.apply(this,arguments),s}return u(n,t),n.prototype.parameters={shape:null},n.prototype.timer=0,n.prototype.onMouseDown=function(t){if(this.parameters.shape)return this.parameters.position=t.point,this.run(new e(this.drawing,this.parameters)),this.clearSelection()},n.prototype.onMouseMove=function(e){},n}(i),n.exports=r}).call(this)},"controllers/notations/eugenia_notation":function(e,t,n){(function(){var e,r;r=t("models/node_shape"),e=function(){function e(){}return e.prototype.reconstruct=function(e){return this.deserialise(this.serialise(e))},e.prototype.serialisePalette=function(e){return this.serialisePaletteHeader(e)+this.serialisePaletteBody(e)},e.prototype.serialisePaletteHeader=function(e){var t,n,r;return r=e.nodeShapes().all().concat(e.linkShapes().all()),t=function(){var e,t,i;i=[];for(e=0,t=r.length;e<t;e++)n=r[e],i.push("  val "+n.name+"[*] "+n.name.toLowerCase()+"s;");return i}().join("\n"),'@namespace(uri="yourlanguage", prefix="yourlanguage")\npackage yourlanguage;\n\n@gmf.diagram(foo="bar")\nclass Root {\n'+t+"\n}\n\nabstract class Element {}\n\n"},e.prototype.serialisePaletteBody=function(e){var t,n,r;return r=e.nodeShapes().all().concat(e.linkShapes().all()),t=function(){var e,t,i;i=[];for(e=0,t=r.length;e<t;e++)n=r[e],i.push(this.serialise(n));return i}.call(this),t.join("\n\n")},e.prototype.serialise=function(e){return e instanceof r?this.serialiseNode(e):this.serialiseLink(e)},e.prototype.serialiseNode=function(e){var t,n,r;return r="",e.elements&&e.elements.length>0&&(t=e.elements[0],t.borderColor&&(r&&(r+=", "),r+='border.color="'+this.serialiseColor(t.borderColor)+'"'),t.fillColor&&(r&&(r+=", "),r+='color="'+this.serialiseColor(t.fillColor)+'"'),t.figure&&(r&&(r+=", "),r+='figure="'+t.figure+'"'),t.size&&t.size.width&&t.size.height&&(r&&(r+=", "),r+='size="'+t.size.width+","+t.size.height+'"')),e.label?(n=e.label,n["for"]&&(r&&(r+=", "),r+='label="'+n["for"].join(",")+'"'),n.pattern&&(r&&(r+=", "),r+='label.pattern="'+n.pattern+'"'),n.placement&&(r&&(r+=", "),r+='label.placement="'+n.placement+'"'),n.length&&(r&&(r+=", "),r+='label.length="'+n.length+'"'),n.color&&(r&&(r+=", "),r+='label.color="'+this.serialiseColor(n.color)+'"')):(r&&(r+=", "),r+='label.placement="none"'),"@gmf.node("+r+")\nclass "+e.name+" extends Element {\n"+this.serialiseAttributes(e)+"\n}"},e.prototype.serialiseAttributes=function(e){var t;return e.properties?function(){var n,r,i,s;i=e.properties,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.serialiseAttribute(t));return s}.call(this).join("\n"):""},e.prototype.serialiseAttribute=function(e){return"  attr String[0..1] "+e+";"},e.prototype.serialiseLink=function(e){return e.style||(e.style="solid"),e.color||(e.color="black"),'@gmf.link(style="'+e.style+'", color="'+this.serialiseColor(e.color)+'", source="source", target="target")\nclass '+e.name+" {\n  ref Element[1] source;\n  ref Element[1] target;\n}"},e.prototype.serialiseColor=function(e){var t;return t=new paper.Color(e),""+t.red*255+","+t.green*255+","+t.blue*255},e.prototype.deserialise=function(e){return e.match(/@gmf.node/)?this.deserialiseNode(e):this.deserialiseLink(e)},e.prototype.deserialiseNode=function(e){var t,n,r,i,s,o;return r={},r.name=this.deserialiseName(e),r.properties=this.deserialiseAttributes(e),i=this.deserialiseProperties(e),n={},i.label&&(n["for"]=i.label.split(","),delete i.label),i["label.placement"]&&(n.placement=i["label.placement"],delete i["label.placement"]),i["label.pattern"]&&(n.pattern=i["label.pattern"],delete i["label.pattern"]),i["label.color"]&&(n.color=this.deserialiseColor(i["label.color"]),delete i["label.color"]),i["label.length"]&&(n.length=parseInt(i["label.length"]),delete i["label.length"]),i["border.color"]&&(i.borderColor=this.deserialiseColor(i["border.color"]),delete i["border.color"]),i.color&&(i.fillColor=this.deserialiseColor(i.color),delete i.color),i.size&&(o=i.size.split(",").slice(0,2),s=o[0],t=o[1],i.size={width:parseInt(s),height:parseInt(t)}),$.isEmptyObject(i)||(r.elements=[i]),$.isEmptyObject(n)||(r.label=n),r},e.prototype.deserialiseLink=function(e){var t;return t=this.deserialiseProperties(e),t.name=this.deserialiseName(e),t.color&&(t.color=this.deserialiseColor(t.color)),t.source&&delete t.source,t.target&&delete t.target,t},e.prototype.deserialiseColor=function(e){var t,n,r,i,s;return s=e.match("(\\d+),(\\d+),(\\d+)"),t=s[0],i=s[1],r=s[2],n=s[3],(new paper.Color(i/255,r/255,n/255)).toCssString()},e.prototype.deserialiseName=function(e){var t;return t=/class\s+(\w*)/,e.match(t)[1]},e.prototype.deserialiseAttributes=function(e){var t,n,r,i,s,o,u;n=/attr String\[0..1\] \w*;/g,t=/attr String\[0..1\] (\w*);/;if(e.match(n)){o=e.match(n),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],u.push(r.match(t)[1]);return u}},e.prototype.deserialiseProperties=function(e){var t,n,r,i,s,o,u,a,f,l,c;o={},r=/@gmf\.\w*\((.*)\)/,n=e.match(r)[1],l=n.split(", ");for(a=0,f=l.length;a<f;a++)i=l[a],s=/([^=]*)="([^"]*)"/,c=i.match(s).slice(1,3),t=c[0],u=c[1],o[t]=u;return o},e}(),n.exports=e}).call(this)},"controllers/notations/json_notation":function(e,t,n){(function(){var e;e=function(){function e(){}return e.prototype.serialiseNode=function(e){return JSON.stringify(e,null,2)},e.prototype.serialiseLink=function(e){return JSON.stringify(e,null,2)},e.prototype.deserialise=function(e){return JSON.parse(e)},e}(),n.exports=e}).call(this)},"controllers/palettes":function(e,t,n){(function(){var e,r,i,s,o,u,a,f,l,c,h,p,d,v,m=function(e,t){return function(){return e.apply(t,arguments)}},g={}.hasOwnProperty,y=function(e,t){function r(){this.constructor=e}for(var n in t)g.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};o=t("controllers/notations/json_notation"),s=t("controllers/notations/eugenia_notation"),Spine.SubStack=t("lib/substack"),i=t("models/drawing"),a=t("models/node_shape"),u=t("models/link_shape"),f=t("models/palette"),r=function(e){function n(){this.extractFormData=m(this.extractFormData,this),this.removeIds=m(this.removeIds,this),this.back=m(this.back,this),this.cancel=m(this.cancel,this),this["delete"]=m(this["delete"],this),this.define=m(this.define,this),this.example_link=m(this.example_link,this),this.example_node=m(this.example_node,this),this.example=m(this.example,this),this.item=m(this.item,this),this.safe=m(this.safe,this),this.serialise=m(this.serialise,this),this.changeNotation=m(this.changeNotation,this),this.currentNotation=m(this.currentNotation,this),n.__super__.constructor.apply(this,arguments),this.notations={json:new o,eugenia:new s},this.notation="json",this.active(this.change)}return y(n,e),n.prototype.events={"submit form":"define","click [data-notation]":"changeNotation","click #delete":"delete","click #cancel":"cancel"},n.prototype.currentNotation=function(){return this.notations[this.notation]},n.prototype.change=function(e){return this._item=null,this.params=e,this.type=this.params.type.slice(0,-1),this.palette=i.find(this.params.d_id).palette(),this.render()},n.prototype.changeNotation=function(e){return e.preventDefault(),this.notation=$(e.target).data("notation"),this.render()},n.prototype.render=function(){var e;return e={serialisation:this.serialise(this.item()),example:this.serialise(this.example()),verb:this.verb(),type:this.type,notation:this.notation},this.html(t("views/palettes/define")(e))},n.prototype.serialise=function(e){return this.type==="node"?this.currentNotation().serialiseNode(this.safe(e)):this.currentNotation().serialiseLink(this.safe(e))},n.prototype.safe=function(e){return this.removeIds(e.toJSON())},n.prototype.item=function(){return this.type==="node"?this._item!=null?this._item:this._item=this.node():this._item!=null?this._item:this._item=this.link()},n.prototype.example=function(){return this.type==="node"?this._example!=null?this._example:this._example=this.example_node():this._example!=null?this._example:this._example=this.example_link()},n.prototype.example_node=function(){return new a({name:"InitialState",elements:[{figure:"ellipse",size:{width:10,height:10},fillColor:"white",borderColor:"black"}]})},n.prototype.example_link=function(){return new u({name:"Link",color:"gray",style:"dash"})},n.prototype.define=function(e){var t,n,r;e.preventDefault(),n=this.extractFormData($(e.target));try{return r=this.removeIds(this.currentNotation().deserialise(n.definition)),this.item().updateAttributes(r).save(),this.back()}catch(i){return t=i,this.log(t.message)}},n.prototype["delete"]=function(e){return e.preventDefault(),this.item().destroy(),this.back()},n.prototype.cancel=function(e){return e.preventDefault(),this.back()},n.prototype.back=function(){return this.navigate("/drawings/"+this.params.d_id)},n.prototype.removeIds=function(e){return delete e.id,delete e.palette_id,e},n.prototype.extractFormData=function(e){var t,n,r,i,s;n={},s=e.serializeArray();for(r=0,i=s.length;r<i;r++)t=s[r],n[t.name]=t.value;return n},n}(Spine.Controller),e=function(e){function t(){return this.link=m(this.link,this),this.node=m(this.node,this),this.verb=m(this.verb,this),p=t.__super__.constructor.apply(this,arguments),p}return y(t,e),t.prototype.verb=function(){return"Create"},t.prototype.node=function(){return new a({name:"TheNode",elements:[{}],palette_id:this.palette.id})},t.prototype.link=function(){return new u({name:"TheLink",palette_id:this.palette.id})},t}(r),h=function(e){function t(){return this.link=m(this.link,this),this.node=m(this.node,this),this.verb=m(this.verb,this),d=t.__super__.constructor.apply(this,arguments),d}return y(t,e),t.prototype.verb=function(){return"Update"},t.prototype.node=function(){return this.palette.nodeShapes().find(this.params.id)},t.prototype.link=function(){return this.palette.linkShapes().find(this.params.id)},t}(r),c=function(e){function n(){this.change=m(this.change,this),n.__super__.constructor.apply(this,arguments),this.active(this.change)}return y(n,e),n.prototype.change=function(e){return this.item=i.find(e.d_id).palette(),this.render()},n.prototype.render=function(){var e;return e={eugenia:(new s).serialisePalette(this.item)},this.html(t("views/palettes/show")(e))},n}(Spine.Controller),l=function(t){function n(){return v=n.__super__.constructor.apply(this,arguments),v}return y(n,t),n.prototype.controllers={create:e,edit:h,show:c},n.prototype.routes={"/drawings/:d_id/palette":"show","/drawings/:d_id/:type/new":"create","/drawings/:d_id/:type/:id":"edit"},n}(Spine.SubStack),n.exports=l}).call(this)},"controllers/select_tool":function(e,t,n){(function(){var e,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=t("controllers/tool"),r=t("models/node"),e=t("models/commands/move_node"),i=function(t){function n(){return o=n.__super__.constructor.apply(this,arguments),o}return a(n,t),n.prototype.parameters={},n.prototype.timer=0,n.prototype.onMouseDown=function(e){return this.clearSelection(),this.select(this.hitTester.nodeOrLinkAt(e.point)),this.current=e.point,this.start=e.point},n.prototype.onMouseDrag=function(t){var n,i,s,o,u,a;n=(new Date).getTime();if(n-this.timer>100){this.timer=n,u=this.selection(),a=[];for(s=0,o=u.length;s<o;s++){i=u[s];if(!(i instanceof r))continue;this.run(new e(i,t.point.subtract(this.current)),{undoable:!1}),a.push(this.current=t.point)}return a}},n.prototype.onMouseUp=function(t){var n,i,s,o,u;o=this.selection(),u=[];for(i=0,s=o.length;i<s;i++)n=o[i],n instanceof r&&u.push(this.commander.add(new e(n,t.point.subtract(this.start))));return u},n}(s),n.exports=i}).call(this)},"controllers/selection":function(e,t,n){(function(){var e,r,i,s=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=t("spine"),e=t("models/commands/change_property"),r=function(n){function r(){this.updatePropertyValue=s(this.updatePropertyValue,this),this.render=s(this.render,this),r.__super__.constructor.apply(this,arguments),this.item.bind("update",this.render),this.render()}return u(r,n),r.prototype.events={"change input[data-property]":"updatePropertyValue"},r.prototype.render=function(){if(this.item)return this.selection=null,this.item.selection.length===1&&(this.selection=this.item.selection[0]),this.html(t("views/drawings/selection")(this.selection))},r.prototype.updatePropertyValue=function(t){var n,r;return r=$(t.target).data("property"),n=$(t.target).val(),this.commander.run(new e(this.selection,r,n))},r}(i.Controller),n.exports=r}).call(this)},"controllers/tool":function(e,t,n){(function(){var e,r,i,s,o,u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=t("models/node"),r=t("models/link"),e=t("models/commands/delete_element"),o=function(t){function n(e){n.__super__.constructor.apply(this,arguments),this.commander=e.commander,this.hitTester=e.hitTester,this.hitTester||(this.hitTester=new s),this.drawing=e.drawing}return a(n,t),n.prototype.setParameter=function(e,t){return this.parameters||(this.parameters={}),this.parameters[e]=t},n.prototype.run=function(e,t){return t==null&&(t={undoable:!0}),this.commander.run(e,t)},n.prototype.onKeyDown=function(t){var n,r,i,s;if(document.activeElement===document.body){if(t.key==="delete"){s=this.selection();for(r=0,i=s.length;r<i;r++)n=s[r],this.run(new e(this.drawing,n));return this.clearSelection()}if(t.key==="z")return this.commander.undo()}},n.prototype.changeSelectionTo=function(e){return this.clearSelection(),this.select(e)},n.prototype.clearSelection=function(){return this.drawing.clearSelection()},n.prototype.select=function(e){return this.drawing.select(e)},n.prototype.selection=function(){return this.drawing.selection},n}(paper.Tool),s=function(){function e(){}return e.prototype.nodeOrLinkAt=function(e){var t;return t=this.nodeAt(e),t||(t=this.linkAt(e)),t},e.prototype.linkAt=function(e){return this.xAt(e,r)},e.prototype.nodeAt=function(e){return this.xAt(e,i)},e.prototype.xAt=function(e,t){var n;n=paper.project.hitTest(e);if(n&&n.item.model instanceof t)return n.item.model},e}(),n.exports=o}).call(this)},"controllers/toolbox":function(e,t,n){(function(){var e,r,i,s,o,u,a,f=function(e,t){return function(){return e.apply(t,arguments)}},l={}.hasOwnProperty,c=function(e,t){function r(){this.constructor=e}for(var n in t)l.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};u=t("spine"),r=t("controllers/link_tool"),s=t("controllers/node_tool"),o=t("controllers/select_tool"),i=t("models/node_shape"),e=t("models/link_shape"),a=function(e){function n(){this.switchTo=f(this.switchTo,this),this.reactToToolSelection=f(this.reactToToolSelection,this),this.showEditor=f(this.showEditor,this),this.render=f(this.render,this),n.__super__.constructor.apply(this,arguments),this.render(),this.tools={node:new s({commander:this.commander,drawing:this.item}),select:new o({commander:this.commander,drawing:this.item}),link:new r({commander:this.commander,drawing:this.item})},this.switchTo("select")}return c(n,e),n.prototype.events={"click a[data-tool-name]":"reactToToolSelection","dblclick a":"showEditor"},n.prototype.render=function(){if(this.item)return this.html(t("views/drawings/toolbox")(this.item))},n.prototype.showEditor=function(e){var t,n;e.preventDefault(),t=$(e.currentTarget),n=t.data("toolName");if(n!=="select")return this.navigate("/drawings/"+this.item.id+"/"+n+"s/"+t.data("toolShape"))},n.prototype.reactToToolSelection=function(e){var t;return t=$(e.currentTarget),this.switchTo(t.data("toolName")),this.currentTool.setParameter("shape",t.data("toolShape")),$("li.active").removeClass("active"),t.parent().addClass("active"),e.preventDefault()},n.prototype.switchTo=function(e){if(!this.tools[e])throw"There is no tool named '"+e+"'";return this.currentTool=this.tools[e],this.currentTool.activate()},n}(u.Controller),n.exports=a}).call(this)},index:function(e,t,n){(function(){var e,r,i,s,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t)o.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};t("lib/setup"),t("lib/fetch_models"),s=t("spine"),r=t("controllers/drawings"),i=t("controllers/palettes"),e=function(e){function t(){t.__super__.constructor.apply(this,arguments),s.Route.setup(),this.navigate("/drawings")}return u(t,e),t.prototype.controllers={palettes:i,drawings:r},t.prototype.routes={"/drawings/:d_id/palette":"palettes","/drawings":"drawings"},t.prototype["default"]="drawings",t}(s.Stack),n.exports=e}).call(this)},"lib/bootstrap":function(e,t,n){!function(e){e(function(){"use strict";e.support.transition=function(){var e=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},n;for(n in t)if(e.style[n]!==undefined)return t[n]}();return e&&{end:e}}()})}(window.jQuery),!function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed").remove()}var n=e(this),r=n.attr("data-target"),i;r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),i=e(r),t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.on(e.support.transition.end,s):s()},e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("alert");i||r.data("alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e(function(){e("body").on("click.alert.data-api",t,n.prototype.close)})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.button.defaults,n)};t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text",r.resetText||n.data("resetText",n[i]()),n[i](r[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active"),this.$element.toggleClass("active")},e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.defaults={loadingText:"loading..."},e.fn.button.Constructor=t,e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=n,this.options.slide&&this.slide(this.options.slide),this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.prototype={cycle:function(t){return t||(this.paused=!1),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},to:function(t){var n=this.$element.find(".item.active"),r=n.parent().children(),i=r.index(n),s=this;if(t>r.length-1||t<0)return;return this.sliding?this.$element.one("slid",function(){s.to(t)}):i==t?this.pause().cycle():this.slide(t>i?"next":"prev",e(r[t]))},pause:function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle()),clearInterval(this.interval),this.interval=null,this},next:function(){if(this.sliding)return;return this.slide("next")},prev:function(){if(this.sliding)return;return this.slide("prev")},slide:function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this,f=e.Event("slide",{relatedTarget:i[0]});this.sliding=!0,s&&this.pause(),i=i.length?i:this.$element.find(".item")[u]();if(i.hasClass("active"))return;if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),this.$element.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid")},0)})}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid")}return s&&this.cycle(),this}},e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("carousel"),s=e.extend({},e.fn.carousel.defaults,typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.cycle()})},e.fn.carousel.defaults={interval:5e3,pause:"hover"},e.fn.carousel.Constructor=t,e(function(){e("body").on("click.carousel.data-api","[data-slide]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=!i.data("modal")&&e.extend({},i.data(),n.data());i.carousel(s),t.preventDefault()})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.collapse.defaults,n),this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.prototype={constructor:t,dimension:function(){var e=this.$element.hasClass("width");return e?"width":"height"},show:function(){var t,n,r,i;if(this.transitioning)return;t=this.dimension(),n=e.camelCase(["scroll",t].join("-")),r=this.$parent&&this.$parent.find("> .accordion-group > .in");if(r&&r.length){i=r.data("collapse");if(i&&i.transitioning)return;r.collapse("hide"),i||r.data("collapse",null)}this.$element[t](0),this.transition("addClass",e.Event("show"),"shown"),e.support.transition&&this.$element[t](this.$element[0][n])},hide:function(){var t;if(this.transitioning)return;t=this.dimension(),this.reset(this.$element[t]()),this.transition("removeClass",e.Event("hide"),"hidden"),this.$element[t](0)},reset:function(e){var t=this.dimension();return this.$element.removeClass("collapse")[t](e||"auto")[0].offsetWidth,this.$element[e!==null?"addClass":"removeClass"]("collapse"),this},transition:function(t,n,r){var i=this,s=function(){n.type=="show"&&i.reset(),i.transitioning=0,i.$element.trigger(r)};this.$element.trigger(n);if(n.isDefaultPrevented())return;this.transitioning=1,this.$element[t]("in"),e.support.transition&&this.$element.hasClass("collapse")?this.$element.one(e.support.transition.end,s):s()},toggle:function(){this[this.$element.hasClass("in")?"hide":"show"]()}},e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("collapse"),s=typeof n=="object"&&n;i||r.data("collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.defaults={toggle:!0},e.fn.collapse.Constructor=t,e(function(){e("body").on("click.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i).data("collapse")?"toggle":n.data();n[e(i).hasClass("in")?"addClass":"removeClass"]("collapsed"),e(i).collapse(s)})})}(window.jQuery),!function(e){"use strict";function r(){i(e(t)).removeClass("open")}function i(t){var n=t.attr("data-target"),r;return n||(n=t.attr("href"),n=n&&n.replace(/.*(?=#[^\s]*$)/,"")),r=e(n),r.length||(r=t.parent()),r}var t="[data-toggle=dropdown]",n=function(t){var n=e(t).on("click.dropdown.data-api",this.toggle);e("html").on("click.dropdown.data-api",function(){n.parent().removeClass("open")})};n.prototype={constructor:n,toggle:function(t){var n=e(this),s,o;if(n.is(".disabled, :disabled"))return;return s=i(n),o=s.hasClass("open"),r(),o||(s.toggleClass("open"),n.focus()),!1},keydown:function(t){var n,r,s,o,u,a;if(!/(38|40|27)/.test(t.keyCode))return;n=e(this),t.preventDefault(),t.stopPropagation();if(n.is(".disabled, :disabled"))return;o=i(n),u=o.hasClass("open");if(!u||u&&t.keyCode==27)return n.click();r=e("[role=menu] li:not(.divider) a",o);if(!r.length)return;a=r.index(r.filter(":focus")),t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<r.length-1&&a++,~a||(a=0),r.eq(a).focus()}},e.fn.dropdown=function(t){return this.each(function(){var r=e(this),i=r.data("dropdown");i||r.data("dropdown",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.dropdown.Constructor=n,e(function(){e("html").on("click.dropdown.data-api touchstart.dropdown.data-api",r),e("body").on("click.dropdown touchstart.dropdown.data-api",".dropdown",function(e){e.stopPropagation()}).on("click.dropdown.data-api touchstart.dropdown.data-api",t,n.prototype.toggle).on("keydown.dropdown.data-api touchstart.dropdown.data-api",t+", [role=menu]",n.prototype.keydown)})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t).delegate('[data-dismiss="modal"]',"click.dismiss.modal",e.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};t.prototype={constructor:t,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var t=this,n=e.Event("show");this.$element.trigger(n);if(this.isShown||n.isDefaultPrevented())return;e("body").addClass("modal-open"),this.isShown=!0,this.escape(),this.backdrop(function(){var n=e.support.transition&&t.$element.hasClass("fade");t.$element.parent().length||t.$element.appendTo(document.body),t.$element.show(),n&&t.$element[0].offsetWidth,t.$element.addClass("in").attr("aria-hidden",!1).focus(),t.enforceFocus(),n?t.$element.one(e.support.transition.end,function(){t.$element.trigger("shown")}):t.$element.trigger("shown")})},hide:function(t){t&&t.preventDefault();var n=this;t=e.Event("hide"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,e("body").removeClass("modal-open"),this.escape(),e(document).off("focusin.modal"),this.$element.removeClass("in").attr("aria-hidden",!0),e.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal()},enforceFocus:function(){var t=this;e(document).on("focusin.modal",function(e){t.$element[0]!==e.target&&!t.$element.has(e.target).length&&t.$element.focus()})},escape:function(){var e=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(t){t.which==27&&e.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var t=this,n=setTimeout(function(){t.$element.off(e.support.transition.end),t.hideModal()},500);this.$element.one(e.support.transition.end,function(){clearTimeout(n),t.hideModal()})},hideModal:function(e){this.$element.hide().trigger("hidden"),this.backdrop()},removeBackdrop:function(){this.$backdrop.remove(),this.$backdrop=null},backdrop:function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.options.backdrop!="static"&&this.$backdrop.click(e.proxy(this.hide,this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),i?this.$backdrop.one(e.support.transition.end,t):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,e.proxy(this.removeBackdrop,this)):this.removeBackdrop()):t&&t()}},e.fn.modal=function(n){return this.each(function(){var r=e(this),i=r.data("modal"),s=e.extend({},e.fn.modal.defaults,r.data(),typeof n=="object"&&n);i||r.data("modal",i=new t(this,s)),typeof n=="string"?i[n]():s.show&&i.show()})},e.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0},e.fn.modal.Constructor=t,e(function(){e("body").on("click.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s).one("hide",function(){n.focus()})})})}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("tooltip",e,t)};t.prototype={constructor:t,init:function(t,n,r){var i,s;this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.enabled=!0,this.options.trigger=="click"?this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this)):this.options.trigger!="manual"&&(i=this.options.trigger=="hover"?"mouseenter":"focus",s=this.options.trigger=="hover"?"mouseleave":"blur",this.$element.on(i+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(s+"."+this.type,this.options.selector,e.proxy(this.leave,this))),this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(t){return t=e.extend({},e.fn[this.type].defaults,t,this.$element.data()),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},enter:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);if(!n.options.delay||!n.options.delay.show)return n.show();clearTimeout(this.timeout),n.hoverState="in",this.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},leave:function(t){var n=e(t.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!n.options.delay||!n.options.delay.hide)return n.hide();n.hoverState="out",this.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},show:function(){var e,t,n,r,i,s,o;if(this.hasContent()&&this.enabled){e=this.tip(),this.setContent(),this.options.animation&&e.addClass("fade"),s=typeof this.options.placement=="function"?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,t=/in/.test(s),e.remove().css({top:0,left:0,display:"block"}).appendTo(t?this.$element:document.body),n=this.getPosition(t),r=e[0].offsetWidth,i=e[0].offsetHeight;switch(t?s.split(" ")[1]:s){case"bottom":o={top:n.top+n.height,left:n.left+n.width/2-r/2};break;case"top":o={top:n.top-i,left:n.left+n.width/2-r/2};break;case"left":o={top:n.top+n.height/2-i/2,left:n.left-r};break;case"right":o={top:n.top+n.height/2-i/2,left:n.left+n.width}}e.css(o).addClass(s).addClass("in")}},setContent:function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},hide:function(){function r(){var t=setTimeout(function(){n.off(e.support.transition.end).remove()},500);n.one(e.support.transition.end,function(){clearTimeout(t),n.remove()})}var t=this,n=this.tip();return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?r():n.remove(),this},fixTitle:function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").removeAttr("title")},hasContent:function(){return this.getTitle()},getPosition:function(t){return e.extend({},t?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTitle:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},tip:function(){return this.$tip=this.$tip||e(this.options.template)},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass("in")?"hide":"show"]()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}},e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("tooltip"),s=typeof n=="object"&&n;i||r.data("tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover",title:"",delay:0,html:!0}}(window.jQuery),!function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:t,setContent:function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content > *")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var e,t=this.$element,n=this.options;return e=t.attr("data-content")||(typeof n.content=="function"?n.content.call(t[0]):n.content),e},tip:function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}}),e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("popover"),s=typeof n=="object"&&n;i||r.data("popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.defaults=e.extend({},e.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"><p></p></div></div></div>'})}(window.jQuery),!function(e){"use strict";function t(t,n){var r=e.proxy(this.process,this),i=e(t).is("body")?e(window):e(t),s;this.options=e.extend({},e.fn.scrollspy.defaults,n),this.$scrollElement=i.on("scroll.scroll-spy.data-api",r),this.selector=(this.options.target||(s=e(t).attr("href"))&&s.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.$body=e("body"),this.refresh(),this.process()}t.prototype={constructor:t,refresh:function(){var t=this,n;this.offsets=e([]),this.targets=e([]),n=this.$body.find(this.selector).map(function(){var t=e(this),n=t.data("target")||t.attr("href"),r=/^#\w/.test(n)&&e(n);return r&&r.length&&[[r.position().top,n]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},process:function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},activate:function(t){var n,r;this.activeTarget=t,e(this.selector).parent(".active").removeClass("active"),r=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',n=e(r).parent("li").addClass("active"),n.parent(".dropdown-menu").length&&(n=n.closest("li.dropdown").addClass("active")),n.trigger("activate")}},e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("scrollspy"),s=typeof n=="object"&&n;i||r.data("scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.defaults={offset:10},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype={constructor:t,show:function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.attr("data-target"),i,s,o;r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;i=n.find(".active a").last()[0],o=e.Event("show",{relatedTarget:i}),t.trigger(o);if(o.isDefaultPrevented())return;s=e(r),this.activate(t.parent("li"),n),this.activate(s,s.parent(),function(){t.trigger({type:"shown",relatedTarget:i})})},activate:function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o):o(),i.removeClass("in")}},e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("tab");i||r.data("tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e(function(){e("body").on("click.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.$element=e(t),this.options=e.extend({},e.fn.typeahead.defaults,n),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.$menu=e(this.options.menu).appendTo("body"),this.source=this.options.source,this.shown=!1,this.listen()};t.prototype={constructor:t,select:function(){var e=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(e)).change(),this.hide()},updater:function(e){return e},show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({top:t.top+t.height,left:t.left}),this.$menu.show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(t){var n;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(n=e.isFunction(this.source)?this.source(this.query,e.proxy(this.process,this)):this.source,n?this.process(n):this)},process:function(t){var n=this;return t=e.grep(t,function(e){return n.matcher(e)}),t=this.sorter(t),t.length?this.render(t.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(e){return~e.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){var t=[],n=[],r=[],i;while(i=e.shift())i.toLowerCase().indexOf(this.query.toLowerCase())?~i.indexOf(this.query)?n.push(i):r.push(i):t.push(i);return t.concat(n,r)},highlighter:function(e){var t=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return e.replace(new RegExp("("+t+")","ig"),function(e,t){return"<strong>"+t+"</strong>"})},render:function(t){var n=this;return t=e(t).map(function(t,r){return t=e(n.options.item).attr("data-value",r),t.find("a").html(n.highlighter(r)),t[0]}),t.first().addClass("active"),this.$menu.html(t),this},next:function(t){var n=this.$menu.find(".active").removeClass("active"),r=n.next();r.length||(r=e(this.$menu.find("li")[0])),r.addClass("active")},prev:function(e){var t=this.$menu.find(".active").removeClass("active"),n=t.prev();n.length||(n=this.$menu.find("li").last()),n.addClass("active")},listen:function(){this.$element.on("blur",e.proxy(this.blur,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)),(e.browser.webkit||e.browser.msie)&&this.$element.on("keydown",e.proxy(this.keydown,this)),this.$menu.on("click",e.proxy(this.click,this)).on("mouseenter","li",e.proxy(this.mouseenter,this))},move:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},keydown:function(t){this.suppressKeyPressRepeat=!~e.inArray(t.keyCode,[40,38,9,13,27]),this.move(t)},keypress:function(e){if(this.suppressKeyPressRepeat)return;this.move(e)},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}e.stopPropagation(),e.preventDefault()},blur:function(e){var t=this;setTimeout(function(){t.hide()},150)},click:function(e){e.stopPropagation(),e.preventDefault(),this.select()},mouseenter:function(t){this.$menu.find(".active").removeClass("active"),e(t.currentTarget).addClass("active")}},e.fn.typeahead=function(n){return this.each(function(){var r=e(this),i=r.data("typeahead"),s=typeof n=="object"&&n;i||r.data("typeahead",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:1},e.fn.typeahead.Constructor=t,e(function(){e("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(t){var n=e(this);if(n.data("typeahead"))return;t.preventDefault(),n.typeahead(n.data())})})}(window.jQuery),!function(e){"use strict";var t=function(t,n){this.options=e.extend({},e.fn.affix.defaults,n),this.$window=e(window).on("scroll.affix.data-api",e.proxy(this.checkPosition,this)),this.$element=e(t),this.checkPosition()};t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var t=e(document).height(),n=this.$window.scrollTop(),r=this.$element.offset(),i=this.options.offset,s=i.bottom,o=i.top,u="affix affix-top affix-bottom",a;typeof i!="object"&&(s=o=i),typeof o=="function"&&(o=i.top()),typeof s=="function"&&(s=i.bottom()),a=this.unpin!=null&&n+this.unpin<=r.top?!1:s!=null&&r.top+this.$element.height()>=t-s?"bottom":o!=null&&n<=o?"top":!1;if(this.affixed===a)return;this.affixed=a,this.unpin=a=="bottom"?r.top-n:null,this.$element.removeClass(u).addClass("affix"+(a?"-"+a:""))},e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("affix"),s=typeof n=="object"&&n;i||r.data("affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.defaults={offset:0},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(window.jQuery)},"lib/fetch_models":function(e,t,n){(function(){var e,n,r,i,s,o;e=t("spine"),i=["palette_specification","palette","link_shape","node_shape","drawing","node","link"];for(s=0,o=i.length;s<o;s++)r=i[s],n=t("models/"+r),r!=="palette_specification"&&n.extend(e.Model.Realtime),r==="palette_specification"&&n.fetch()}).call(this)},"lib/setup":function(e,t,n){(function(){t("json2ify"),t("es5-shimify"),t("jqueryify"),t("lib/bootstrap"),t("spine"),t("spine/lib/local"),t("spine/lib/ajax"),t("spine/lib/manager"),t("spine/lib/route"),t("spine/lib/relation"),t("models/realtime")}).call(this)},"lib/substack":function(e,t,n){(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};Spine.SubStack=function(e){function n(){var e,t,r,i,s=this;i=this.routes,r=function(e,t){return s.routes[e]=function(){var e;return s.active(),(e=s[t]).active.apply(e,arguments)}};for(e in i)t=i[e],r(e,t);n.__super__.constructor.apply(this,arguments)}return t(n,e),n}(Spine.Stack),n.exports=Spine.SubStack}).call(this)},"models/commands/change_property":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n,r){this.element=e,this.property=n,this.newValue=r,this.undo=t(this.undo,this),this.run=t(this.run,this)}return e.prototype.run=function(){return this.oldValue=this.element.getPropertyValue(this.property),this.element.setPropertyValue(this.property,this.newValue)},e.prototype.undo=function(){return this.element.setPropertyValue(this.property,this.oldValue)},e}(),n.exports=e}).call(this)},"models/commands/commander":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.undo=t(this.undo,this),this.run=t(this.run,this),this.add=t(this.add,this),this.history=[]}return e.prototype.add=function(e){return this.history.push(e)},e.prototype.run=function(e,t){return t==null&&(t={undoable:!0}),t.undoable&&this.add(e),e.run()},e.prototype.undo=function(){if(this.history.length)return this.history.pop().undo()},e}(),n.exports=e}).call(this)},"models/commands/create_link":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n){this.drawing=e,this.parameters=n,this.undo=t(this.undo,this),this.run=t(this.run,this)}return e.prototype.run=function(){return this.link=this.drawing.addLink(this.parameters)},e.prototype.undo=function(){return this.link.destroy()},e}(),n.exports=e}).call(this)},"models/commands/create_node":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n){this.drawing=e,this.parameters=n,this.undo=t(this.undo,this),this.run=t(this.run,this)}return e.prototype.run=function(){return this.node=this.drawing.addNode(this.parameters)},e.prototype.undo=function(){return this.node.destroy()},e}(),n.exports=e}).call(this)},"models/commands/delete_element":function(e,t,n){(function(){var e,r,i,s,o=function(e,t){return function(){return e.apply(t,arguments)}};i=t("models/commands/delete_node"),r=t("models/commands/delete_link"),s=t("models/node"),e=function(){function e(e,t){this.undo=o(this.undo,this),this.run=o(this.run,this),t instanceof s?this.delegate=new i(e,t):this.delegate=new r(e,t)}return e.prototype.run=function(){return this.delegate.run()},e.prototype.undo=function(){return this.delegate.undo()},e}(),n.exports=e}).call(this)},"models/commands/delete_link":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n){this.drawing=e,this.link=n,this.rebase=t(this.rebase,this),this.undo=t(this.undo,this),this.run=t(this.run,this)}return e.prototype.run=function(){return this.memento=this.link.destroy()},e.prototype.undo=function(){return this.drawing.addLink(this.memento)},e.prototype.rebase=function(e,t){this.memento.sourceId===e&&(this.memento.sourceId=t);if(this.memento.targetId===e)return this.memento.targetId=t},e}(),n.exports=e}).call(this)},"models/commands/delete_node":function(e,t,n){(function(){var e,r,i=function(e,t){return function(){return e.apply(t,arguments)}};e=t("models/commands/delete_link"),r=function(){function t(e,t){this.drawing=e,this.node=t,this.undoDeleteLinks=i(this.undoDeleteLinks,this),this.runDeleteLinks=i(this.runDeleteLinks,this),this.undo=i(this.undo,this),this.run=i(this.run,this)}return t.prototype.run=function(){return this.runDeleteLinks(),this.nodeMemento=this.node.destroy()},t.prototype.undo=function(){var e;return e=this.node.id,this.node=this.drawing.addNode(this.nodeMemento),this.undoDeleteLinks(e,this.node.id)},t.prototype.runDeleteLinks=function(){var t,n,r,i,s,o;this.linkCommands=[],s=this.node.links(),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],t=new e(this.drawing,n),t.run(),o.push(this.linkCommands.push(t));return o},t.prototype.undoDeleteLinks=function(e,t){var n,r,i,s,o;s=this.linkCommands,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],n.rebase(e,t),o.push(n.undo());return o},t}(),n.exports=r}).call(this)},"models/commands/logging_commander":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e){this.delegate=e,this.log=t(this.log,this),this.undo=t(this.undo,this),this.run=t(this.run,this),this.add=t(this.add,this)}return e.prototype.add=function(e){return this.delegate.add(e)},e.prototype.run=function(e,t){return t==null&&(t={undoable:!0}),this.delegate.run(e,t),this.log("Run",e)},e.prototype.undo=function(e){return this.delegate.undo(e),this.log("Undo",e)},e.prototype.log=function(e,t){return console.log(e+": "+JSON.stringify(t))},e}(),n.exports=e}).call(this)},"models/commands/move_node":function(e,t,n){(function(){var e,r,i=function(e,t){return function(){return e.apply(t,arguments)}};r=t("models/point"),e=function(){function e(e,t){this.node=e,this.undo=i(this.undo,this),this.run=i(this.run,this),this.offset=new r(t.x,t.y)}return e.prototype.run=function(){return this.node.moveBy(this.offset)},e.prototype.undo=function(){return this.node.moveBy(this.offset.invert())},e}(),n.exports=e}).call(this)},"models/drawing":function(e,t,n){(function(){var e,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("spine"),e=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.selection||(this.selection=[]),this.bind("destroy",this.destroyChildren),this.bind("selectionChanged",this.updateCanvas)}return s(t,e),t.configure("Drawing","name","selection","cache"),t.hasOne("palette","models/palette"),t.hasMany("nodes","models/node"),t.hasMany("links","models/link"),t.prototype.select=function(e){if(e)return this.selection.push(e),this.save(),this.trigger("selectionChanged")},t.prototype.clearSelection=function(){return this.selection=[],this.save(),this.trigger("selectionChanged")},t.prototype.validate=function(){if(!this.name)return"Name is required"},t.prototype.destroyChildren=function(){var e,t,n,r,i,s,o,u;o=this.nodes().all();for(n=0,i=o.length;n<i;n++)t=o[n],t.destroy();u=this.links().all();for(r=0,s=u.length;r<s;r++)e=u[r],e.destroy();if(this.palette())return this.palette().destroy()},t.prototype.addNode=function(e){return this.nodes().create(e)},t.prototype.addLink=function(e){return this.links().create(e)},t.prototype.updateCanvas=function(){var e,t,n,r,i;if(paper.project){paper.project.activeLayer.selected=!1,r=this.selection!=null,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.select(paper.project.activeLayer));return i}},t}(r.Model),n.exports=e}).call(this)},"models/link":function(e,t,n){(function(){var e,r,i,s,o,u=function(e,t){return function(){return e.apply(t,arguments)}},a={}.hasOwnProperty,f=function(e,t){function r(){this.constructor=e}for(var n in t)a.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};o=t("spine"),i=t("models/moves_path"),s=t("models/simplifies_segments"),r=t("models/link_shape"),e=function(e){function t(e){this.toSegments=u(this.toSegments,this),this.destroy=u(this.destroy,this),this.select=u(this.select,this),this.toPath=u(this.toPath,this),this.paperId=u(this.paperId,this),this.reconnectTo=u(this.reconnectTo,this),this.updateSegments=u(this.updateSegments,this);var n,r;t.__super__.constructor.apply(this,arguments);for(n in e)r=e[n],this.k=r;e&&this.updateSegments(e.segments)}return f(t,e),t.configure("Link","sourceId","targetId","segments","shape"),t.belongsTo("drawing","models/drawing"),t.prototype.select=function(){return this.drawing().select(this)},t.prototype.updateSegments=function(e){return this.segments=(new s)["for"](e)},t.prototype.reconnectTo=function(e,t){var n;return n=new i(this.toPath(),t),e===this.sourceId&&n.moveStart(),e===this.targetId&&n.moveEnd(),this.updateSegments(n.finalise()),this.save()},t.prototype.paperId=function(){return"link"+this.id},t.prototype.toPath=function(){var e,t;return t=r.find(this.shape),e=t.draw(this.toSegments()),e.name=this.paperId(),e},t.prototype.select=function(e){return e.children[this.paperId()].selected=!0},t.prototype.destroy=function(e){var n,r;return e==null&&(e={}),n=t.__super__.destroy.call(this,e),r={sourceId:n.sourceId,targetId:n.targetId,segments:n.segments,shape:n.shape}},t.prototype.toSegments=function(){var e,t,n,r,i;r=this.segments,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(new paper.Segment(e.point,e.handleIn,e.handleOut));return i},t}(o.Model),n.exports=e}).call(this)},"models/link_shape":function(e,t,n){(function(){var e,r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("spine"),e=function(e){function n(e){this.draw=i(this.draw,this),this.displayName=i(this.displayName,this),n.__super__.constructor.apply(this,arguments),this.bind("destroy",this.destroyLinks)}return o(n,e),n.configure("LinkShape","name","color","style"),n.belongsTo("palette","models/palette"),n.prototype.displayName=function(){return this.name.charAt(0).toUpperCase()+this.name.slice(1)},n.prototype.draw=function(e){var t;return t=new paper.Path(e),t.strokeColor=this.color,this.style==="dash"&&(t.dashArray=[4,4]),t},n.prototype.destroyLinks=function(){var e,n,r,i,s;i=t("models/link").findAllByAttribute("shape",this.id),s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e.destroy());return s},n}(r.Model),n.exports=e}).call(this)},"models/moves_path":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e,n){this.finalise=t(this.finalise,this),this.moveEnd=t(this.moveEnd,this),this.moveStart=t(this.moveStart,this),this.path=e,this.offset=n}return e.prototype.moveStart=function(){return this.path.firstSegment.point.x+=this.offset.x,this.path.firstSegment.point.y+=this.offset.y},e.prototype.moveEnd=function(){return this.path.lastSegment.point.x+=this.offset.x,this.path.lastSegment.point.y+=this.offset.y},e.prototype.finalise=function(){return this.path.removeSegments(1,this.path.segments.size-2),this.path.simplify(100),this.path.remove(),this.path.segments},e}(),n.exports=e}).call(this)},"models/node":function(e,t,n){(function(){var e,r,i,s,o=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=t("spine"),e=t("models/link"),i=t("models/node_shape"),r=function(t){function n(e){this.nodeShape=o(this.nodeShape,this),this.destroy=o(this.destroy,this),this.select=o(this.select,this),this.toPath=o(this.toPath,this),this.paperId=o(this.paperId,this),this.moveBy=o(this.moveBy,this),this.links=o(this.links,this);var t,r;n.__super__.constructor.apply(this,arguments);for(t in e)r=e[t],this.k=r;this.initialisePropertyValues()}return a(n,t),n.configure("Node","shape","position","propertyValues"),n.belongsTo("drawing","models/drawing"),n.prototype.initialisePropertyValues=function(){return this.nodeShape()&&(this.propertyValues||(this.propertyValues=this.nodeShape().defaultPropertyValues())),this.propertyValues||(this.propertyValues={})},n.prototype.setPropertyValue=function(e,t){return this.propertyValues[e]=t,this.save()},n.prototype.getPropertyValue=function(e){return this.propertyValues[e]},n.prototype.links=function(){var t=this;return e.select(function(e){return e.sourceId===t.id||e.targetId===t.id})},n.prototype.moveBy=function(e){var t,n,r,i;this.position=e.add(this.position),i=this.links();for(n=0,r=i.length;n<r;n++)t=i[n],t.reconnectTo(this.id,e);return this.save()},n.prototype.paperId=function(){return"node"+this.id},n.prototype.toPath=function(){var e;return e=this.nodeShape().draw(this),e.name=this.paperId(),e},n.prototype.select=function(e){return e.children[this.paperId()].selected=!0},n.prototype.destroy=function(e){var t,r;return e==null&&(e={}),t=n.__super__.destroy.call(this,e),r={shape:t.shape,position:t.position}},n.prototype.nodeShape=function(){if(this.shape&&i.exists(this.shape))return i.find(this.shape)},n}(s.Model),n.exports=r}).call(this)},"models/node_shape":function(e,t,n){(function(){var e,r,i,s,o=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty,a=function(e,t){function r(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=t("spine"),r=function(){function e(e){this.definition=e,this.definition&&this.definition.placement!=="none"?(this.definition["for"]instanceof Array||(this.definition["for"]=[this.definition["for"]]),this.definition.pattern||(this.definition.pattern=this.default_pattern())):this.definition={placement:"none"}}return e.prototype.default_pattern=function(){var e,t,n,r,i,s;return n=function(){s=[];for(var e=0,t=this.definition["for"].length-1;0<=t?e<=t:e>=t;0<=t?e++:e--)s.push(e);return s}.apply(this),e=function(){var e,r,i;i=[];for(e=0,r=n.length;e<r;e++)t=n[e],i.push("{"+t+"}");return i}(),e.join(",")},e.prototype.draw=function(e,t){var n,r;return r=new paper.Group(t),this.definition.placement!=="none"&&(n=this.positionFor(t),r.addChild(this.createText(e,n))),r},e.prototype.positionFor=function(e){return this.definition.placement==="external"?e.bounds.bottomCenter.add([0,20]):e.position.add([0,5])},e.prototype.createText=function(e,t){var n;return n=new paper.PointText(t),n.justification="center",n.fillColor=this.definition.color,n.content=this.contentFor(e),n},e.prototype.contentFor=function(e){var t,n,r,i,s,o;t=this.definition.pattern;for(n=s=0,o=this.definition["for"].length-1;0<=o?s<=o:s>=o;n=0<=o?++s:--s)r=RegExp("\\{"+n+"\\}","g"),i=e.getPropertyValue(this.definition["for"][n]),t=t.replace(r,i);return this.trimText(t)},e.prototype.trimText=function(e){return e?e.length>this.definition.length?e.substring(0,this.definition.length-3).trim()+"...":e:""},e}(),e=function(){function e(e){this.createPath=o(this.createPath,this),this.createElement=o(this.createElement,this),this.elements=e}return e.prototype.draw=function(e){var t,n;return t=function(){var t,r,i,s;i=this.elements,s=[];for(t=0,r=i.length;t<r;t++)n=i[t],s.push(this.createElement(n,e.position));return s}.call(this),new paper.Group(t)},e.prototype.createElement=function(e,t){var n;return e.x||(e.x=0),e.y||(e.y=0),n=this.createPath(e.figure,e.size),n.position=(new paper.Point(t)).add(e.x,e.y),n.fillColor=e.fillColor,n.strokeColor=e.borderColor,n},e.prototype.createPath=function(e,t){var n;switch(e){case"rounded":return n=new paper.Rectangle(0,0,t.width,t.height),new paper.Path.RoundRectangle(n,new paper.Size(10,10));case"ellipse":return n=new paper.Rectangle(0,0,t.width*2,t.height*2),new paper.Path.Oval(n);case"rectangle":return new paper.Path.Rectangle(0,0,t.width,t.height)}},e}(),i=function(n){function i(e){this.draw=o(this.draw,this),this.displayName=o(this.displayName,this),this.defaultPropertyValues=o(this.defaultPropertyValues,this),this.createDelegates=o(this.createDelegates,this),i.__super__.constructor.apply(this,arguments),this.createDelegates(),this.bind("update",this.createDelegates),this.bind("destroy",this.destroyNodes)}return a(i,n),i.configure("NodeShape","name","properties","label","elements"),i.belongsTo("palette","models/palette"),i.prototype.createDelegates=function(){return this._elements=new e(this.elements),this._label=new r(this.label)},i.prototype.defaultPropertyValues=function(){var e,t,n,r,i;e={};if(this.properties){i=this.properties;for(n=0,r=i.length;n<r;n++)t=i[n],e[t]=""}return e},i.prototype.displayName=function(){return this.name.charAt(0).toUpperCase()+this.name.slice(1)},i.prototype.draw=function(e){return this._label.draw(e,this._elements.draw(e))},i.prototype.destroyNodes=function(){var e,n,r,i,s;i=t("models/node").findAllByAttribute("shape",this.id),s=[];for(n=0,r=i.length;n<r;n++)e=i[n],s.push(e.destroy());return s},i}(s.Model),n.exports=i}).call(this)},"models/palette":function(e,t,n){(function(){var e,r,i={}.hasOwnProperty,s=function(e,t){function r(){this.constructor=e}for(var n in t)i.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=t("spine"),e=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.bind("destroy",this.destroyChildren)}return s(t,e),t.configure("Palette"),t.hasMany("nodeShapes","models/node_shape"),t.hasMany("linkShapes","models/link_shape"),t.belongsTo("drawing","models/drawing"),t.prototype.destroyChildren=function(){var e,t,n,r,i,s,o,u,a;o=this.nodeShapes().all();for(n=0,i=o.length;n<i;n++)t=o[n],t.destroy();u=this.linkShapes().all(),a=[];for(r=0,s=u.length;r<s;r++)e=u[r],a.push(e.destroy());return a},t}(r.Model),n.exports=e}).call(this)},"models/palette_specification":function(e,t,n){(function(){var e,r,i,s,o,u,a=function(e,t){return function(){return e.apply(t,arguments)}},f={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var n in t)f.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};s=t("spine"),e=t("models/palette"),o=function(){function e(){}return e.create=function(){return r.create({name:"State Machine",json:this.json()}).save()},e.json=function(){return'{      "name": "State Machine",      "nodeShapes": [        {          "name": "State",          "properties": ["name", "recurrent"],          "label" : {            "for" : "name",            "color" : "green",            "placement" : "internal",            "length" : 15          },          "elements": [            {              "figure": "rounded",              "size": {"width": 100, "height": 50},              "fillColor": "white",              "borderColor": "black"            }          ]        },        {          "name": "Initial",          "properties": ["name"],          "elements": [            {              "figure": "ellipse",              "size": {"width": 10, "height": 10},              "fillColor": "black",              "borderColor": "black"            }          ]        },        {          "name": "Final",          "properties": ["name"],          "elements": [            {              "figure": "ellipse",              "size": {"width": 10, "height": 10},              "fillColor": "white",              "borderColor": "black"            },            {              "figure": "ellipse",              "size": {"width": 7, "height": 7},              "fillColor": "black",              "borderColor": "black"            }          ]        }      ],      "linkShapes": [        {          "name": "Transition",          "color": "black",          "style": "solid"        },        {          "name": "Dependency",          "color": "gray",          "style": "dash"        }      ]    }'},e}(),i=function(){function e(){}return e.create=function(){return r.create({name:"Petri net",json:this.json()}).save()},e.json=function(){return'{      "name": "Petri net",      "nodeShapes": [        {          "name": "Net",          "elements": [            {              "figure": "ellipse",              "size": {"width": 30, "height": 30},              "fillColor": "white",              "borderColor": "black"            }          ]        },        {          "name": "Arc",          "elements": [            {              "figure": "rectangle",              "size": {"width": 10, "height": 50},              "fillColor": "black",              "borderColor": "black"            }          ]        }      ],      "linkShapes": [        {          "name": "Transition",          "color": "black",          "style": "solid"        }      ]    }'},e}(),r=function(t){function n(){return this.instantiate=a(this.instantiate,this),u=n.__super__.constructor.apply(this,arguments),u}return l(n,t),n.configure("PaletteSpecification","name","json"),n.fetch=function(){return o.create(),i.create()},n.prototype.instantiate=function(){var t,n,r,i,s,o,u,a,f,l;t=JSON.parse(this.json),i=e.create().save();if(t.nodeShapes){f=t.nodeShapes;for(s=0,u=f.length;s<u;s++)r=f[s],i.nodeShapes().create(r).save()}if(t.linkShapes){l=t.linkShapes;for(o=0,a=l.length;o<a;o++)n=l[o],i.linkShapes().create(n).save()}return i},n}(s.Model),n.exports=r}).call(this)},"models/point":function(e,t,n){(function(){var e;e=function(){function e(e,t){this.x=e,this.y=t}return e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(e){return add(-e)},e.prototype.invert=function(){return new e(-this.x,-this.y)},e}(),n.exports=e}).call(this)},"models/realtime":function(e,t,n){(function(){var e;e=t("models/rtc"),Spine.Model.Realtime={extended:function(){var t=this;return this.bind("update",e.updateJSON),this.bind("create",e.createJSON),this.bind("destroy",e.deleteJSON),Spine.Model.bind("Model:fileLoad",function(e){return t.loadModelMap(e)}),Spine.Model.bind("Model:fileUpdate",function(e){return t.modelMapUpdate(e)}),this.idCounter=Math.random()},loadModelMap:function(e){var t,n,r;return console.log("load map "+this.className),r=e.get(this.className),n="",r&&(n=r.values().toString()),t="["+n+"]",this.refresh(t||[],{clear:!0}),this.fetch()},modelMapUpdate:function(t){var n,r,i,s,o,u;return this.unbind("update",e.updateJSON),this.unbind("destroy",e.deleteJSON),this.unbind("create",e.createJSON),console.log("modelMapUpdate"),r=t.property,n=r.lastIndexOf(this.className,0)===0,n&&(u=this.fromJSON(t.oldValue),o=this.fromJSON(t.newValue),o?this.exists(o.id)?(s=this.find(o.id),i=s.attributes().selection,i!=null&&o.updateAttribute("selection",i),s.updateAttributes(o.attributes())):(console.log("create"),console.log(o.attributes()),this.create(o.attributes())):(s=this.find(u.id),console.log("null delete "+(s!=null)),s.destroy())),this.bind("update",e.updateJSON),this.bind("create",e.createJSON),this.bind("destroy",e.deleteJSON)}},typeof n!="undefined"&&n!==null&&(n.exports=Spine.Model.Realtime)}).call(this)},"models/rtc":function(e,t,n){function u(){realtimeLoader=new w.RealtimeLoader(realTimeOptions),realtimeLoader.start(a)}function f(e){console.log("initializeModel");var t=e.createMap();e.getRoot().set("modelsMap",t)}function l(e){console.log("onFileLoaded");var t=e.getModel().getRoot().get("modelsMap");t.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,m);var n=t.keys();for(var i in n){var s=t.get(n[i]);s.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,g)}r=e,Spine.Model.trigger("Model:fileLoad",t),y(),b()}Spine=t("spine"),CREATE_SELECTOR="#createDoc",OPEN_SELECTOR="#openDoc",AUTH_BUTTON="authorizeButton",SHARE_SELECTOR="#share",realTimeOptions={appID:"465627783329",clientId:"465627783329-5rt9n9o1m3oum4i1o9quvhe5641u182f.apps.googleusercontent.com",authButtonElementId:AUTH_BUTTON,initializeModel:f,autoCreate:!1,defaultTitle:"Contacts_Map",onFileLoaded:l};var r=null,i=null,s=0,o=function(e){if(e.action==google.picker.Action.PICKED){var t=e.docs[0].id;w.redirectTo(t,realtimeLoader.authorizer.userId)}},a=function(){$(SHARE_SELECTOR).click(h),$(OPEN_SELECTOR).click(c),$(CREATE_SELECTOR).click(function(){var e=prompt("New file name:","");realtimeLoader.createNewFileAndRedirect(e)})},c=function(){var e=gapi.auth.getToken().access_token,t=new google.picker.View(google.picker.ViewId.DOCS),n=(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).setAppId(realTimeOptions.appId).setOAuthToken(e).addView(t).setCallback(o).build();n.setVisible(!0)},h=function(){window.open("https://drive.google.com/#recent")},p=function(e){var t=r.getModel().getRoot().get("modelsMap"),n=t.get(this.className);n.delete(this.className+e.id)},d=function(e){var t=r.getModel().getRoot().get("modelsMap");if(t.has(this.className)){var n=t.get(this.className);n.set(this.className+e.id,JSON.stringify(e))}else{var n=r.getModel().createMap();t.set(this.className,n),n.set(this.className+e.id,JSON.stringify(e)),n.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,g)}},v=function(e){var t=(new Date).getTime();s=t,console.log("updateJSON ");var n=r.getModel().getRoot().get("modelsMap");if(n.has(this.className)){var i=n.get(this.className);i.set(this.className+e.id,JSON.stringify(e))}else{alert("********UPDATEJSON - ELSE********");var i=r.getModel().createMap();i.set(this.className+e.id,JSON.stringify(e)),i.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,g),n.set(this.className,i)}},m=function(e){var t=e.isLocal;if(!t){var n=r.getModel().getRoot().get("modelsMap"),i=n.get(e.property);i.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,g)}},g=function(e){var t=e.isLocal;t||Spine.Model.trigger("Model:fileUpdate",e)},y=function(){r.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_JOINED,b),r.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_LEFT,b)},b=function(){if(!document.getElementById("collaborators")&&document.getElementsByClassName){var e=document.getElementsByClassName("brand")[0],t=document.createElement("span");t.id="collaborators",t.style.position="absolute",t.style.right="15px",e.appendChild(t)}var t=document.getElementById("collaborators");if(t){var n=r.getCollaborators();t.innerHTML="";if(n.length>1){var s=document.createElement("span");s.style.horizontalAlign="left",t.appendChild(s);for(var o=0;o<n.length;o+=1){var u=n[o];if(!u.isMe){var a=document.createElement("img");a.src=u.photoUrl,a.alt=u.displayName,a.title=u.displayName,a.style.backgroundColor=u.color,a.style.marginLeft="5px",a.style.height="25px",a.style.width="25px",a.style.paddingBottom="5px",t.appendChild(a)}else i=u.userId}}else if(n.length==1){var u=n[0];u.isMe&&(i=u.userId)}}};window.onload=u,e.updateJSON=v,e.deleteJSON=p,e.createJSON=d,"use strict";var w=w||{};w.INSTALL_SCOPE="https://www.googleapis.com/auth/drive.install",w.FILE_SCOPE="https://www.googleapis.com/auth/drive.file",w.OPENID_SCOPE="openid",w.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",w.getParams=function(){var e={},t=window.location.search;if(t){var n=t.slice(1).split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");e[i[0]]=unescape(i[1])}}return e},w.params=w.getParams(),w.getOption=function(e,t,n){var r=e[t]==undefined?n:e[t];return r==undefined&&console.error(t+" should be present in the options."),r},w.Authorizer=function(e){this.clientId=w.getOption(e,"clientId"),this.userId=w.params.userId,this.authButton=document.getElementById(w.getOption(e,"authButtonElementId"))},w.Authorizer.prototype.start=function(e){var t=this;gapi.load("auth:client,drive-realtime,drive-share",function(){t.authorize(e)})},w.Authorizer.prototype.authorize=function(e){var t=this.clientId,n=this.userId,r=this,i=function(t){t&&!t.error?(r.authButton.disabled=!0,r.fetchUserId(e)):(r.authButton.disabled=!1,r.authButton.onclick=s)},s=function(){gapi.auth.authorize({client_id:t,scope:[w.INSTALL_SCOPE,w.FILE_SCOPE,w.OPENID_SCOPE],user_id:n,immediate:!1},i)};gapi.auth.authorize({client_id:t,scope:[w.INSTALL_SCOPE,w.FILE_SCOPE,w.OPENID_SCOPE],user_id:n,immediate:!0},i)},w.Authorizer.prototype.fetchUserId=function(e){var t=this;gapi.client.load("oauth2","v2",function(){gapi.client.oauth2.userinfo.get().execute(function(n){n.id&&(t.userId=n.id),e&&e()})})},w.createRealtimeFile=function(e,t){gapi.client.load("drive","v2",function(){gapi.client.drive.files.insert({resource:{mimeType:w.REALTIME_MIMETYPE,title:e}}).execute(t)})},w.getFileMetadata=function(e,t){gapi.client.load("drive","v2",function(){gapi.client.drive.files.get({fileId:id}).execute(t)})},w.parseState=function(e){try{var t=JSON.parse(e);return t}catch(n){return null}},w.redirectTo=function(e,t){var n=[];e&&n.push("fileId="+e),t&&n.push("userId="+t),window.location.href=n.length==0?"/":"?"+n.join("&")},w.RealtimeLoader=function(e){this.onFileLoaded=w.getOption(e,"onFileLoaded"),this.initializeModel=w.getOption(e,"initializeModel"),this.registerTypes=w.getOption(e,"registerTypes",function(){}),this.autoCreate=w.getOption(e,"autoCreate",!1),this.defaultTitle=w.getOption(e,"defaultTitle","New Realtime File"),this.authorizer=new w.Authorizer(e)},w.RealtimeLoader.prototype.start=function(e){var t=this;this.authorizer.start(function(){t.registerTypes&&t.registerTypes(),e&&e(),t.load()})},w.RealtimeLoader.prototype.load=function(){var e=w.params.fileId,t=this.authorizer.userId,n=w.params.state,r=this.authorizer,i=function(e){e.type==gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED?r.authorize():e.type==gapi.drive.realtime.ErrorType.CLIENT_ERROR?(alert("An Error happened: "+e.message),window.location.href="/"):e.type==gapi.drive.realtime.ErrorType.NOT_FOUND&&(alert("The file was not found. It does not exist or you do not have read access to the file."),window.location.href="/")};if(e){gapi.drive.realtime.load(e,this.onFileLoaded,this.initializeModel,i);return}if(n){var s=w.parseState(n);if(s.action=="open"){e=s.ids[0],t=s.userId,w.redirectTo(e,t);return}}this.autoCreate&&this.createNewFileAndRedirect()},w.RealtimeLoader.prototype.createNewFileAndRedirect=function(e){var t=this;w.createRealtimeFile(e,function(e){e.id?w.redirectTo(e.id,t.authorizer.userId):(console.error("Error creating file."),console.error(e))})}},"models/simplifies_segments":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this["for"]=t(this["for"],this)}return e.prototype["for"]=function(e){var t,n,r,i;if(e){i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(this.simplified(t));return i}},e.prototype.simplified=function(e){return{point:{x:e.point.x,y:e.point.y},handleIn:{x:e.handleIn.x,y:e.handleIn.y},handleOut:{x:e.handleOut.x,y:e.handleOut.y}}},e}(),n.exports=e}).call(this)},"views/drawings/canvas_renderer":function(e,t,n){(function(){var e,r,i,s=function(e,t){return function(){return e.apply(t,arguments)}};r=t("models/link"),i=t("models/node"),e=function(){function e(e){this.updateDrawingCache=s(this.updateDrawingCache,this),this.renderOne=s(this.renderOne,this),this.addOne=s(this.addOne,this),this.addAll=s(this.addAll,this),this.bindToChangeEvents=s(this.bindToChangeEvents,this),this.canvas=e.canvas,this.drawing=e.drawing,paper.setup(this.canvas),this.bindToChangeEvents(),this.addAll(i),this.addAll(r)}return e.prototype.bindToChangeEvents=function(){var e=this;return i.bind("refresh",function(){return e.addAll(i)}),r.bind("refresh",function(){return e.addAll(r)}),i.bind("create",this.addOne),r.bind("create",this.addOne)},e.prototype.addAll=function(e){var t,n,r,i,s;t=e.className.toLowerCase()+"s",r=this.drawing[t]().all(),console.log("adding all "+r.length+" "+e.className+"s");for(i=0,s=r.length;i<s;i++)n=r[i],this.renderOne(n);return this.updateDrawingCache()},e.prototype.addOne=function(e){return this.renderOne(e),this.updateDrawingCache()},e.prototype.renderOne=function(e){var n;return n=t("views/drawings/"+e.constructor.className.toLowerCase()+"_renderer"),n?(new n(e)).render():console.warn("no renderer attached for "+e)},e.prototype.updateDrawingCache=function(){return this.drawing.cache=this.canvas.toDataURL(),this.drawing.save()},e}(),n.exports=e}).call(this)},"views/drawings/element_renderer":function(e,t,n){(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(e){this.remove=t(this.remove,this),this.draw=t(this.draw,this),this.linkElementToModel=t(this.linkElementToModel,this),this.render=t(this.render,this),this.item=e,this.item.bind("update",this.render),this.item.bind("destroy",this.remove)}return e.prototype.render=function(){var e;return e=this.el,this.draw(),this.linkElementToModel(this.el),e&&(this.el.selected=e.selected,e.remove()),paper.view.draw()},e.prototype.linkElementToModel=function(e){var t,n,r,i,s;e.model=this.item;if(e.children){i=e.children,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(this.linkElementToModel(t));return s}},e.prototype.draw=function(){throw"No draw method has been defined for: "+this.item},e.prototype.remove=function(){return this.el.remove()},e}(),n.exports=e}).call(this)},"views/drawings/index":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i,s,o,u,a,f,l;t.push('<div class="hero-unit">\n  <div class="row-fluid">\n    <div class="span6">\n      <h2>Rapidly design graphical DSLs</h2>\n      <p>\n         EuGENia Live allows you to quickly build a\n         graphical editor for a domain-specific language.\n         You can use your DSL in the browser, or export and\n         generate more powerful DSL tools that integrate with the\n         Eclipse development environment.\n      </p>\n      <p>\n        <a class="btn btn-medium" target="_blank" href="http://www.di.univaq.it/diruscio/sites/XM2012/xm2012_submission_6.pdf">Workshop Paper &raquo;</a>\n      	<a class="btn btn-medium" target="_blank" href="https://speakerdeck.com/louismrose/eugenia-live-a-flexible-graphical-modelling-tool">Presentation &raquo;</a>\n      	<a class="btn btn-medium" target="_blank" href="https://github.com/louismrose/eugenia-live/"  >Source &raquo;</a>\n      </p>\n    </div>\n    <div class="span5 offset1" style="padding-top: 1em;">\n      <div id="showcase" class="carousel slide">\n        <div class="carousel-inner">\n          <div class="active item">\n            <img src="./img/example_dsl.png" style="" />\n            <!-- <div class="carousel-caption">\n                          <h4>Build a DSL for seating plans...</h4>\n                        </div> -->\n          </div>\n          <div class="item"><img src="http://placekitten.com/g/400/250" /></div>\n          <div class="item"><img src="http://placekitten.com/g/400/250" /></div>\n        </div>\n        <!-- <a class="carousel-control left" href="#showcase" data-slide="prev">&lsaquo;</a>\n                <a class="carousel-control right" href="#showcase" data-slide="next">&rsaquo;</a> -->\n      </div>\n    </div>\n  </div>\n</div>\n\n<div class="row-fluid">\n  <ul class="thumbnails">  \n    <li class="span4">\n      <div class="well" style="background-color: #dcdcdc;">\n        <form>\n		      <legend>Create a new drawing</legend>\n          <label>Name:</label>\n          <input id="name" name="name" type="text" class="span12" required>\n          <label class="select">Palette:</label>\n          <select id="palette" name="palette_specification_id" class="span12">\n            '),f=this.palette_specs;for(s=0,u=f.length;s<u;s++)i=f[s],t.push('\n              <option value="'),t.push(r(i.id)),t.push('">'),t.push(r(i.name)),t.push("</option>\n            ");t.push('\n          </select>\n          <button id="new" class="btn btn-primary" type="submit" style="margin-top: 1.5em;">Go</button>\n          <a href="#" style="margin-top: 1.5em;" class="btn btn-link popover-test" rel="popover" data-trigger="hover" data-placement="right" data-content="Your drawings are stored by your browser. They won\'t be available from other computers, or from other web browsers on the same computer." data-original-title="Local Storage">Where are drawings stored?</a>\n        </form>\n      </div>\n    </li>\n  \n    '),l=this.drawings;for(n=o=0,a=l.length;o<a;n=++o)e=l[n],t.push('\n    <li class="span4 well">\n      <div style="margin-bottom: 10px;">\n        <h3 style="margin-top: 0;">'),t.push(r(e.name)),t.push('</h3>\n      </div>\n      <div>\n        <a href="#/drawings/'),t.push(r(e.id)),t.push('">\n          <img src="'),t.push(r(e.cache)),t.push('" style="background-color: white; border: 1px solid #ddd">\n        </a>\n      </div>\n      <div style="margin-top: 10px; text-align: right;">\n        <button class="btn btn-danger delete" data-id="'),t.push(r(e.id)),t.push('" style="display:inline;">Delete</button>\n      </div>\n    </li>\n    '),(n+2)%3===0&&t.push('\n  </ul>\n</div>\n<div class="row-fluid">\n  <ul class="thumbnails">\n    '),t.push("\n");t.push("\n  </ul>\n</div>")}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r},"views/drawings/link_renderer":function(e,t,n){(function(){var e,r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=t("views/drawings/element_renderer"),r=function(e){function t(e){this.draw=i(this.draw,this),t.__super__.constructor.call(this,e)}return o(t,e),t.prototype.draw=function(){return this.el=this.item.toPath(),paper.project.activeLayer.insertChild(0,this.el)},t}(e),n.exports=r}).call(this)},"views/drawings/node_renderer":function(e,t,n){(function(){var e,r,i=function(e,t){return function(){return e.apply(t,arguments)}},s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=t("views/drawings/element_renderer"),r=function(e){function t(e){this.draw=i(this.draw,this),t.__super__.constructor.call(this,e)}return o(t,e),t.prototype.draw=function(){return this.el=this.item.toPath()},t}(e),n.exports=r}).call(this)},"views/drawings/selection":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i;if(!$.isEmptyObject(this.propertyValues)){t.push('\n  <table class="table table-bordered">\n    <thead>\n      <tr>\n        <th>Property</th>\n        <th>Value</th>\n      </tr>\n    </thead>\n    <tbody>\n      '),i=this.propertyValues;for(e in i)n=i[e],t.push('\n      <tr>\n        <td style="vertical-align:middle">'),t.push(r(e)),t.push('</td>\n        <td><input type="text" data-property="'),t.push(r(e)),t.push('" value="'),t.push(r(n)),t.push('" style="margin-bottom: 0"></td>\n      </tr>\n      ');t.push("\n    </tbody>\n  </table>\n")}}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r},"views/drawings/show":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){t.push('<div class="row-fluid">\n  <div id="toolbox" class="span2">\n    \n  </div>\n  <div class="span10">\n    <div id="canvas" style="height:400px">\n      <canvas id="drawing" width="1000" height="400"></canvas>\n    </div>\n\n    <div id="selection" class="well">\n    </div>\n  </div>\n</div>')}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r},"views/drawings/toolbox":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){var e,n,i,s,o,u,a,f;t.push('<div id="toolbox" class="well">\n\n  <ul class="nav nav-list">\n    <li class="nav-header">Built-in</li>\n    <li class="active"><a href="#" data-tool-name="select">Select</i></a></li>\n  \n    <li class="nav-header">Nodes</li>\n    '),a=this.palette().nodeShapes().all();for(i=0,o=a.length;i<o;i++)n=a[i],t.push('\n      <li><a href="#" data-tool-name="node" data-tool-shape="'),t.push(r(n.id)),t.push('">'),t.push(r(n.displayName())),t.push("</a></li>\n    ");t.push('\n    <li><a href="#/drawings/'),t.push(r(this.id)),t.push('/nodes/new">New...</a></li>\n  \n    <li class="nav-header">Links</li>\n    '),f=this.palette().linkShapes().all();for(s=0,u=f.length;s<u;s++)e=f[s],t.push('\n      <li><a href="#" data-tool-name="link" data-tool-shape="'),t.push(r(e.id)),t.push('">'),t.push(r(e.displayName())),t.push("</a></li>\n    ");t.push('\n      <li><a href="#/drawings/'),t.push(r(this.id)),t.push('/links/new">New...</a></li>\n  </ul>\n\n  <a id="palette-export" class="btn btn-primary" href="#/drawings/'),t.push(r(this.id)),t.push('/palette">\n    <i class="icon-download icon-white"></i> Export palette\n  </a>\n</div>')}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r},"views/palettes/define":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){t.push('<div class="row-fluid">\n  <form>\n    <legend>'),t.push(r(this.verb)),t.push(" "),t.push(r(this.type)),t.push('\n      <ul class="nav nav-pills" style="display: inline; float: right;">\n        <li class="'),this.notation==="json"&&t.push(r("active")),t.push('">\n          <a data-notation="json" href="#">JSON</a>\n        </li>\n        <li class="'),this.notation==="eugenia"&&t.push(r("active")),t.push('">\n          <a data-notation="eugenia" href="#">EuGENia</a>\n        </li>\n      </ul>\n    </legend>\n    <fieldset>\n      <div class="row-fluid">\n        <div class="span6" style="padding-left: 20px">\n          <label for="definition">Definition</label>\n          <textarea class="input-xlarge" style="width: 90%;" id="definition" name="definition" rows="12" required>'),t.push(r(this.serialisation)),t.push('</textarea>\n        </div>\n        <div class="span6" style="padding-right: 20px">\n          <p class="help-block">\n			For example:\n			<pre>'),t.push(r(this.example)),t.push('</pre>\n          </p>\n        </div>\n      </div>\n      <div class="form-actions" style="padding-left: 20px;">\n        <button type="submit" class="btn btn-primary">'),t.push(r(this.verb)),t.push(" "),t.push(r(this.type)),t.push('</button>\n		<button id="cancel" class="btn">Cancel</button>\n		'),this.verb==="Update"&&(t.push('\n		<button id="delete" class="btn btn-danger" style="float:right;">Delete '),t.push(r(this.type)),t.push("</button>\n		")),t.push("	\n      </div>\n    </fieldset>\n  </form>\n</div>")}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r},"views/palettes/show":function(e,t,n){var r=function(e){e||(e={});var t=[],n=function(e){var n=t,r;return t=[],e.call(this),r=t.join(""),t=n,i(r)},r=function(e){return e&&e.ecoSafe?e:typeof e!="undefined"&&e!=null?o(e):""},i,s=e.safe,o=e.escape;return i=e.safe=function(e){if(e&&e.ecoSafe)return e;if(typeof e=="undefined"||e==null)e="";var t=new String(e);return t.ecoSafe=!0,t},o||(o=e.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}),function(){(function(){t.push('<div class="page-header">\n  <h1>Export your palette&nbsp;&nbsp;<small>Generate an Eclipse-based editor</small></h1>\n</div>\n\n<div class="row-fluid">\n  <div class="span8">\n    <p>\n      Follow the instructions below to generate a graphical editor from\n      your EuGENia Live palette. The generated editor will integrate \n      with the Eclipse IDE. You\'ll be able to extend your editor with lots\n      of features that EuGENia Live doesn\'t yet support, such as: \n      <a href="http://epsilonblog.wordpress.com/2008/01/18/model-refactoring-in-gmf-based-editors-with-ewl/">wizards</a> and <a href="http://www.eclipse.org/epsilon/doc/articles/evl-gmf-integration/">validation</a> using Epsilon or automatic layout using\n      <a href="http://www.informatik.uni-kiel.de/en/rtsys/kieler/">KIELER</a>.\n    </p>\n    \n    <ol class="instructions">\n      <li>\n        <strong>Install Epsilon, EuGENia and Emfatic</strong> by following <a href="http://www.eclipse.org/epsilon/download/" target="_blank">these instructions</a>.\n      </li>\n      \n      <li>\n        <strong>Copy the following Emfatic code to the clipboard</strong>\n        <pre>'),t.push(r(this.eugenia)),t.push('</pre>\n      </li>\n      \n      <li>\n        <strong>Create a new EuGENia project</strong>\n        <ol>\n          <li>Start Eclipse</li>\n          <li>Select File -&gt; New -&gt; Project... and select Java Project. Give the project a name, and use the default options.</li>\n          <li>Select File -&gt; New -&gt; Other... and select Emfatic file. Select your project as the container, and give the file a name. </li>\n          <li>Open the Emfatic file and replace its contents with the Emfatic code shown above.</li>\n          <li>Save the Emfatic file.</li>\n          <li>Right-click the Emfatic file and select Eugenia -&gt; Generate GMF Editor.</li>\n        </ol>\n      </li>\n      \n      <li>\n        <strong>Use the generated GMF editor</strong>\n        <ol>\n          <li>Select Run -&gt; Run Configurations... and create a new\nEclipse Application run configuration.</li>\n         <li>Use the following VM arguments: <pre>-XX:PermSize=64M -XX:MaxPermSize=128M -Xms512M -Xmx1024M</pre></li>\n         <li>Click Run</li>\n         <li>In the new Eclipse instance, use the File -&gt; New menu to create a new diagram with your GMF editor. The resulting editor will look similar to the one shown below.</li>\n        </ol>\n        <img src="http://www.eclipse.org/epsilon/doc/articles/eugenia-gmf-tutorial/Filesystemscreenshot2.png"/>\n      </li>\n      \n      <li>\n        <strong>Learn more about EuGENia</strong> by reading <a href="http://www.eclipse.org/epsilon/doc/eugenia/">the documentation</a>.\n      </li>\n    </ol>\n  </div>\n</div>')}).call(this)}.call(e),e.safe=s,e.escape=o,t.join("")};n.exports=r}}),jade.rethrow=function(t,n,r){throw t}